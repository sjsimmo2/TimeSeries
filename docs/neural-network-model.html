<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Neural Network Model | Time Series 1</title>
  <meta name="description" content="Chapter 8 Neural Network Model | Time Series 1" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Neural Network Model | Time Series 1" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Neural Network Model | Time Series 1" />
  
  
  

<meta name="author" content="by Dr. Susan Simmons" />


<meta name="date" content="2023-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="prophet.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TimeSeries</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series 1</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#time-series-decomposition"><i class="fa fa-check"></i><b>2.1</b> Time series decomposition</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#python-code-and-results-for-time-series-plot"><i class="fa fa-check"></i><b>2.2</b> Python code and results for Time Series plot</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#sas-code-for-time-series-plot-and-decomposition"><i class="fa fa-check"></i><b>2.3</b> SAS code for time series plot and decomposition</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#self-study"><i class="fa fa-check"></i><b>2.4</b> Self-study</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>3</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.1</b> Simple Exponential Smoothing</a></li>
<li class="chapter" data-level="3.2" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-esm"><i class="fa fa-check"></i><b>3.2</b> Holt ESM</a></li>
<li class="chapter" data-level="3.3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-winters"><i class="fa fa-check"></i><b>3.3</b> Holt-Winters</a></li>
<li class="chapter" data-level="3.4" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#evaluating-forecasts"><i class="fa fa-check"></i><b>3.4</b> Evaluating forecasts</a></li>
<li class="chapter" data-level="3.5" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#ets"><i class="fa fa-check"></i><b>3.5</b> ETS</a></li>
<li class="chapter" data-level="3.6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#python-code-for-exponential-smoothing"><i class="fa fa-check"></i><b>3.6</b> Python Code for Exponential Smoothing</a></li>
<li class="chapter" data-level="3.7" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#sas-code-for-exponential-smoothing-models"><i class="fa fa-check"></i><b>3.7</b> SAS Code for Exponential Smoothing Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#correlation-functions"><i class="fa fa-check"></i><b>4.2</b> Correlation Functions</a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#autoregressive-models-ar"><i class="fa fa-check"></i><b>4.3</b> AutoRegressive Models (AR)</a></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#moving-average-model-ma"><i class="fa fa-check"></i><b>4.4</b> Moving Average model (MA)</a></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#white-noise"><i class="fa fa-check"></i><b>4.5</b> White noise</a></li>
<li class="chapter" data-level="4.6" data-path="arima.html"><a href="arima.html#trending-series"><i class="fa fa-check"></i><b>4.6</b> Trending Series</a></li>
<li class="chapter" data-level="4.7" data-path="arima.html"><a href="arima.html#fitting-arima-models"><i class="fa fa-check"></i><b>4.7</b> Fitting ARIMA models</a></li>
<li class="chapter" data-level="4.8" data-path="arima.html"><a href="arima.html#python-code-for-armaarima-models"><i class="fa fa-check"></i><b>4.8</b> Python Code for ARMA/ARIMA models</a></li>
<li class="chapter" data-level="4.9" data-path="arima.html"><a href="arima.html#sas-code-for-armaarima"><i class="fa fa-check"></i><b>4.9</b> SAS Code for ARMA/ARIMA</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seasonality.html"><a href="seasonality.html"><i class="fa fa-check"></i><b>5</b> Seasonality</a>
<ul>
<li class="chapter" data-level="5.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-unit-root-testing"><i class="fa fa-check"></i><b>5.1</b> Seasonal Unit Root Testing</a></li>
<li class="chapter" data-level="5.2" data-path="seasonality.html"><a href="seasonality.html#deterministic-solutions"><i class="fa fa-check"></i><b>5.2</b> Deterministic Solutions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-dummy-variables"><i class="fa fa-check"></i><b>5.2.1</b> Seasonal Dummy Variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="seasonality.html"><a href="seasonality.html#fourier-transforms"><i class="fa fa-check"></i><b>5.2.2</b> Fourier Transforms</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="seasonality.html"><a href="seasonality.html#stochastic-solutions"><i class="fa fa-check"></i><b>5.3</b> Stochastic Solutions</a></li>
<li class="chapter" data-level="5.4" data-path="seasonality.html"><a href="seasonality.html#seasonal-arima-modeling"><i class="fa fa-check"></i><b>5.4</b> Seasonal ARIMA Modeling</a></li>
<li class="chapter" data-level="5.5" data-path="seasonality.html"><a href="seasonality.html#python-code-for-seasonality"><i class="fa fa-check"></i><b>5.5</b> Python Code for Seasonality</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="seasonality.html"><a href="seasonality.html#seasonality-1"><i class="fa fa-check"></i><b>5.5.1</b> Seasonality</a></li>
<li class="chapter" data-level="5.5.2" data-path="seasonality.html"><a href="seasonality.html#deterministic-solutions-1"><i class="fa fa-check"></i><b>5.5.2</b> Deterministic Solutions</a></li>
<li class="chapter" data-level="5.5.3" data-path="seasonality.html"><a href="seasonality.html#stochastic-solution"><i class="fa fa-check"></i><b>5.5.3</b> Stochastic Solution</a></li>
<li class="chapter" data-level="5.5.4" data-path="seasonality.html"><a href="seasonality.html#seasonal-arima"><i class="fa fa-check"></i><b>5.5.4</b> Seasonal ARIMA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html"><i class="fa fa-check"></i><b>6</b> Dynamic Regression Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#intervention-variables"><i class="fa fa-check"></i><b>6.1</b> Intervention Variables</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#predictor-variables"><i class="fa fa-check"></i><b>6.2</b> Predictor Variables</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#python-code-for-dynamic-regression-models"><i class="fa fa-check"></i><b>6.3</b> Python Code for Dynamic Regression Models</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#intervention-variables-1"><i class="fa fa-check"></i><b>6.3.1</b> Intervention Variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#predictor-variables-1"><i class="fa fa-check"></i><b>6.3.2</b> Predictor Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="prophet.html"><a href="prophet.html"><i class="fa fa-check"></i><b>7</b> Prophet</a>
<ul>
<li class="chapter" data-level="7.1" data-path="prophet.html"><a href="prophet.html#python-code-for-prophet"><i class="fa fa-check"></i><b>7.1</b> Python Code for Prophet</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="prophet.html"><a href="prophet.html#model-structure"><i class="fa fa-check"></i><b>7.1.1</b> Model Structure</a></li>
<li class="chapter" data-level="7.1.2" data-path="prophet.html"><a href="prophet.html#forecasting"><i class="fa fa-check"></i><b>7.1.2</b> Forecasting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="neural-network-model.html"><a href="neural-network-model.html"><i class="fa fa-check"></i><b>8</b> Neural Network Model</a>
<ul>
<li class="chapter" data-level="8.1" data-path="neural-network-model.html"><a href="neural-network-model.html#python-code-for-neural-networks"><i class="fa fa-check"></i><b>8.1</b> Python Code for Neural Networks</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="neural-network-model.html"><a href="neural-network-model.html#ar-neural-networks"><i class="fa fa-check"></i><b>8.1.1</b> AR Neural Networks</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="neural-network-model" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Neural Network Model<a href="neural-network-model.html#neural-network-model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Neural network models are models based on mathematical models of how brains function. They are organized in a network of neurons through layers. The input variables are considered the neurons in the bottom layer. The output variable is the final neuron in the top layer. The layers in between, called hidden layers, transform the input variables through non-linear methods to try and best model the output variable.</p>
<p>From one layer to the next, the neurons from the previous layer are inputs into each neuron of the next layer all linear combined with weights (coefficients). Inside each of the hidden layer neurons, the linear combination of inputs is transformed with a non-linear function. Typically, this function is the logit function, but could be a variety of non-linear transformations. This is then output from each neuron to go into the next hidden layer. The top layer is just a linear combination of all of the transformations of the neurons from the previous hidden layer.</p>
<p>In autoregressive neural networks the bottom layer (input variables) also contains lags of the target variable as possible inputs. The number of lags to include is typically done through trial and error. We can approach this problem similar to ARIMA modeling with correlation plots and automatic selection techniques. However, there are no MA terms in this autoregressive neural networks. For seasonal data we typically include all lags up through one season unless correlation plots say you only need specific ones. We do however need to make our data stationary first since we are dealing with lagged terms of the target variable.</p>
<p>To build an autoregressive neural network in R, we use the nnetar function. This function cannot take differences of your data so we need to input our differenced training data. The p = and P = options specify the number of normal and seasonal autoregressive lags respectively. From there we just use the forecast function from the forecast package to forecast the next 12 time periods (h = 12 option).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="neural-network-model.html#cb1-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb1-2"><a href="neural-network-model.html#cb1-2" tabindex="-1"></a>NN.Model <span class="ot">&lt;-</span> <span class="fu">nnetar</span>(<span class="fu">diff</span>(training, <span class="dv">12</span>), <span class="at">p =</span> <span class="dv">2</span>, <span class="at">P =</span> <span class="dv">3</span>)</span>
<span id="cb1-3"><a href="neural-network-model.html#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="neural-network-model.html#cb1-4" tabindex="-1"></a>NN.Forecast <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">forecast</span>(NN.Model, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb1-5"><a href="neural-network-model.html#cb1-5" tabindex="-1"></a><span class="fu">plot</span>(NN.Forecast)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>However, the <code>nnetar</code> function only forecasts the input. Since our input was the differences, the function forecasts the differences, not the original data. The <code>for</code> loop in the code just calculates the forecasts of the actual data based on these differences. Essentially, to get the first month’s forecast, we just add the first forecasted difference to the last data point in our training dataset. Lastly, we can calculate the MAE and MAPE from these forecasts.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="neural-network-model.html#cb2-1" tabindex="-1"></a>Pass.Forecast <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">12</span>)</span>
<span id="cb2-2"><a href="neural-network-model.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="neural-network-model.html#cb2-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>){</span>
<span id="cb2-4"><a href="neural-network-model.html#cb2-4" tabindex="-1"></a>  Pass.Forecast[i] <span class="ot">&lt;-</span> training[<span class="fu">length</span>(training) <span class="sc">-</span> <span class="dv">12</span> <span class="sc">+</span> i] <span class="sc">+</span> forecast<span class="sc">::</span><span class="fu">forecast</span>(NN.Model, <span class="at">h =</span> <span class="dv">24</span>)<span class="sc">$</span>mean[i]</span>
<span id="cb2-5"><a href="neural-network-model.html#cb2-5" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="neural-network-model.html#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="neural-network-model.html#cb2-7" tabindex="-1"></a>Pass.Forecast <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pass.Forecast, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2007</span>, <span class="dv">4</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb2-8"><a href="neural-network-model.html#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="neural-network-model.html#cb2-9" tabindex="-1"></a><span class="fu">plot</span>(training, <span class="at">main =</span> <span class="st">&quot;US Airline Passengers ARIMA Model Forecasts&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Passengers (Thousands)&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1990</span>, <span class="dv">2009</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">30000</span>,<span class="dv">80000</span>))</span>
<span id="cb2-10"><a href="neural-network-model.html#cb2-10" tabindex="-1"></a><span class="fu">lines</span>(Pass.Forecast, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb2-11"><a href="neural-network-model.html#cb2-11" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">2007.25</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="neural-network-model.html#cb3-1" tabindex="-1"></a><span class="co"># Calculate prediction errors from forecast</span></span>
<span id="cb3-2"><a href="neural-network-model.html#cb3-2" tabindex="-1"></a>NN.error <span class="ot">&lt;-</span> test <span class="sc">-</span> Pass.Forecast</span>
<span id="cb3-3"><a href="neural-network-model.html#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="neural-network-model.html#cb3-4" tabindex="-1"></a><span class="co"># Calculate prediction error statistics (MAE and MAPE)</span></span>
<span id="cb3-5"><a href="neural-network-model.html#cb3-5" tabindex="-1"></a>NN.MAE <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(NN.error))</span>
<span id="cb3-6"><a href="neural-network-model.html#cb3-6" tabindex="-1"></a>NN.MAPE <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(NN.error)<span class="sc">/</span><span class="fu">abs</span>(test))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb3-7"><a href="neural-network-model.html#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="neural-network-model.html#cb3-8" tabindex="-1"></a>NN.MAE</span></code></pre></div>
<pre><code>## [1] 1087.973</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="neural-network-model.html#cb5-1" tabindex="-1"></a>NN.MAPE</span></code></pre></div>
<pre><code>## [1] 1.66796</code></pre>
<p>Finally, we have a model that beats the original exponential smoothing model’s forecasts! Before any problem begins, we do not know which algorithm will win so we try them all.</p>
<div id="python-code-for-neural-networks" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Python Code for Neural Networks<a href="neural-network-model.html#python-code-for-neural-networks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ar-neural-networks" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> AR Neural Networks<a href="neural-network-model.html#ar-neural-networks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="neural-network-model.html#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="neural-network-model.html#cb7-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-3"><a href="neural-network-model.html#cb7-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-4"><a href="neural-network-model.html#cb7-4" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-5"><a href="neural-network-model.html#cb7-5" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb7-6"><a href="neural-network-model.html#cb7-6" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics <span class="im">import</span> tsaplots</span>
<span id="cb7-7"><a href="neural-network-model.html#cb7-7" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics <span class="im">import</span> tsaplots</span>
<span id="cb7-8"><a href="neural-network-model.html#cb7-8" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb7-9"><a href="neural-network-model.html#cb7-9" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> STL</span>
<span id="cb7-10"><a href="neural-network-model.html#cb7-10" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima_model <span class="im">import</span> ARMA</span>
<span id="cb7-11"><a href="neural-network-model.html#cb7-11" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima_model <span class="im">import</span> ARIMA</span>
<span id="cb7-12"><a href="neural-network-model.html#cb7-12" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.statespace.sarimax <span class="im">import</span> SARIMAX</span>
<span id="cb7-13"><a href="neural-network-model.html#cb7-13" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.holtwinters <span class="im">import</span> SimpleExpSmoothing, Holt, ExponentialSmoothing</span>
<span id="cb7-14"><a href="neural-network-model.html#cb7-14" tabindex="-1"></a><span class="im">import</span> pmdarima <span class="im">as</span> pm</span>
<span id="cb7-15"><a href="neural-network-model.html#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="neural-network-model.html#cb7-16" tabindex="-1"></a>usair <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/usairlines.csv&quot;</span>)</span>
<span id="cb7-17"><a href="neural-network-model.html#cb7-17" tabindex="-1"></a>df<span class="op">=</span>pd.date_range(start<span class="op">=</span><span class="st">&#39;1/1/1990&#39;</span>, end<span class="op">=</span><span class="st">&#39;3/1/2008&#39;</span>, freq<span class="op">=</span><span class="st">&#39;MS&#39;</span>)</span>
<span id="cb7-18"><a href="neural-network-model.html#cb7-18" tabindex="-1"></a>usair.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb7-19"><a href="neural-network-model.html#cb7-19" tabindex="-1"></a></span>
<span id="cb7-20"><a href="neural-network-model.html#cb7-20" tabindex="-1"></a>training <span class="op">=</span> usair.head(<span class="dv">207</span>)</span>
<span id="cb7-21"><a href="neural-network-model.html#cb7-21" tabindex="-1"></a>test <span class="op">=</span> usair.tail(<span class="dv">12</span>)</span>
<span id="cb7-22"><a href="neural-network-model.html#cb7-22" tabindex="-1"></a></span>
<span id="cb7-23"><a href="neural-network-model.html#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="neural-network-model.html#cb7-24" tabindex="-1"></a>usair[<span class="st">&#39;diff&#39;</span>] <span class="op">=</span> usair[<span class="st">&#39;Passengers&#39;</span>] <span class="op">-</span> usair[<span class="st">&#39;Passengers&#39;</span>].shift(<span class="dv">12</span>)</span>
<span id="cb7-25"><a href="neural-network-model.html#cb7-25" tabindex="-1"></a>usair[<span class="st">&#39;L1&#39;</span>] <span class="op">=</span> usair[<span class="st">&#39;diff&#39;</span>].shift()</span>
<span id="cb7-26"><a href="neural-network-model.html#cb7-26" tabindex="-1"></a>usair[<span class="st">&#39;L2&#39;</span>] <span class="op">=</span> usair[<span class="st">&#39;diff&#39;</span>].shift(<span class="dv">2</span>)</span>
<span id="cb7-27"><a href="neural-network-model.html#cb7-27" tabindex="-1"></a>usair[<span class="st">&#39;L12&#39;</span>] <span class="op">=</span> usair[<span class="st">&#39;diff&#39;</span>].shift(<span class="dv">12</span>)</span>
<span id="cb7-28"><a href="neural-network-model.html#cb7-28" tabindex="-1"></a>usair[<span class="st">&#39;L24&#39;</span>] <span class="op">=</span> usair[<span class="st">&#39;diff&#39;</span>].shift(<span class="dv">24</span>)</span>
<span id="cb7-29"><a href="neural-network-model.html#cb7-29" tabindex="-1"></a>usair[<span class="st">&#39;L36&#39;</span>] <span class="op">=</span> usair[<span class="st">&#39;diff&#39;</span>].shift(<span class="dv">36</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="neural-network-model.html#cb8-1" tabindex="-1"></a>training <span class="op">=</span> usair.head(<span class="dv">207</span>)</span>
<span id="cb8-2"><a href="neural-network-model.html#cb8-2" tabindex="-1"></a>test <span class="op">=</span> usair.tail(<span class="dv">12</span>)</span>
<span id="cb8-3"><a href="neural-network-model.html#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="neural-network-model.html#cb8-4" tabindex="-1"></a>plt.cla()</span>
<span id="cb8-5"><a href="neural-network-model.html#cb8-5" tabindex="-1"></a>plt.plot(training[<span class="st">&quot;diff&quot;</span>].dropna())</span>
<span id="cb8-6"><a href="neural-network-model.html#cb8-6" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Date&quot;</span>)</span>
<span id="cb8-7"><a href="neural-network-model.html#cb8-7" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Passengers&quot;</span>)</span>
<span id="cb8-8"><a href="neural-network-model.html#cb8-8" tabindex="-1"></a>plt.title(<span class="st">&quot;Seasonal Difference in Airline Passengers&quot;</span>)</span>
<span id="cb8-9"><a href="neural-network-model.html#cb8-9" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="neural-network-model.html#cb9-1" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPRegressor</span>
<span id="cb9-2"><a href="neural-network-model.html#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="neural-network-model.html#cb9-3" tabindex="-1"></a>X <span class="op">=</span> training.drop([<span class="st">&#39;Month&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Passengers&#39;</span>, <span class="st">&#39;diff&#39;</span>], axis <span class="op">=</span> <span class="dv">1</span>).tail(<span class="dv">159</span>)</span>
<span id="cb9-4"><a href="neural-network-model.html#cb9-4" tabindex="-1"></a>y <span class="op">=</span> training[<span class="st">&#39;diff&#39;</span>].tail(<span class="dv">159</span>)</span>
<span id="cb9-5"><a href="neural-network-model.html#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="neural-network-model.html#cb9-6" tabindex="-1"></a>NN_air <span class="op">=</span> MLPRegressor(hidden_layer_sizes <span class="op">=</span> (<span class="dv">3</span>,), random_state<span class="op">=</span><span class="dv">123</span>, max_iter <span class="op">=</span> <span class="dv">100000</span>).fit(X, y)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="neural-network-model.html#cb10-1" tabindex="-1"></a>X_test <span class="op">=</span> test.drop([<span class="st">&#39;Month&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Passengers&#39;</span>, <span class="st">&#39;diff&#39;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb10-2"><a href="neural-network-model.html#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="neural-network-model.html#cb10-3" tabindex="-1"></a>test[<span class="st">&#39;NN_pred&#39;</span>] <span class="op">=</span> NN_air.predict(X_test)</span></code></pre></div>
<pre><code>## &lt;string&gt;:1: SettingWithCopyWarning: 
## A value is trying to be set on a copy of a slice from a DataFrame.
## Try using .loc[row_indexer,col_indexer] = value instead
## 
## See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="neural-network-model.html#cb12-1" tabindex="-1"></a>training2 <span class="op">=</span> training.tail(<span class="dv">12</span>)</span>
<span id="cb12-2"><a href="neural-network-model.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="neural-network-model.html#cb12-3" tabindex="-1"></a>training2[<span class="st">&#39;NN_pred&#39;</span>] <span class="op">=</span> NN_air.predict(X_test)</span></code></pre></div>
<pre><code>## &lt;string&gt;:1: SettingWithCopyWarning: 
## A value is trying to be set on a copy of a slice from a DataFrame.
## Try using .loc[row_indexer,col_indexer] = value instead
## 
## See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="neural-network-model.html#cb14-1" tabindex="-1"></a>Pass_pred <span class="op">=</span> training2[<span class="st">&#39;NN_pred&#39;</span>] <span class="op">+</span> training2[<span class="st">&#39;Passengers&#39;</span>]</span>
<span id="cb14-2"><a href="neural-network-model.html#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="neural-network-model.html#cb14-3" tabindex="-1"></a>Pass_pred.index <span class="op">=</span> pd.to_datetime(pd.date_range(start<span class="op">=</span><span class="st">&#39;4/1/2007&#39;</span>, end<span class="op">=</span><span class="st">&#39;3/1/2008&#39;</span>, freq<span class="op">=</span><span class="st">&#39;MS&#39;</span>))</span>
<span id="cb14-4"><a href="neural-network-model.html#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="neural-network-model.html#cb14-5" tabindex="-1"></a>test[<span class="st">&#39;Pass_pred&#39;</span>] <span class="op">=</span> Pass_pred</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="neural-network-model.html#cb15-1" tabindex="-1"></a>error6 <span class="op">=</span> test[<span class="st">&#39;Passengers&#39;</span>] <span class="op">-</span> test[<span class="st">&#39;Pass_pred&#39;</span>]</span>
<span id="cb15-2"><a href="neural-network-model.html#cb15-2" tabindex="-1"></a>MAPE6 <span class="op">=</span> np.mean(<span class="bu">abs</span>(error6)<span class="op">/</span>test[<span class="st">&#39;Passengers&#39;</span>])<span class="op">*</span><span class="dv">100</span></span>
<span id="cb15-3"><a href="neural-network-model.html#cb15-3" tabindex="-1"></a>MAPE6</span></code></pre></div>
<pre><code>## 1.3761273058280752</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="neural-network-model.html#cb17-1" tabindex="-1"></a>plt.cla()</span>
<span id="cb17-2"><a href="neural-network-model.html#cb17-2" tabindex="-1"></a>fcast5 <span class="op">=</span> test[<span class="st">&#39;Pass_pred&#39;</span>]</span>
<span id="cb17-3"><a href="neural-network-model.html#cb17-3" tabindex="-1"></a>ax <span class="op">=</span> training[<span class="st">&quot;Passengers&quot;</span>].plot(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb17-4"><a href="neural-network-model.html#cb17-4" tabindex="-1"></a>fcast5.plot(ax <span class="op">=</span> ax,color <span class="op">=</span> <span class="st">&quot;orange&quot;</span>)</span>
<span id="cb17-5"><a href="neural-network-model.html#cb17-5" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-3.png" width="1152" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="prophet.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sjsimmo2/TimeSeries/edit/master/07-NeuralNetwork.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sjsimmo2/TimeSeries/blob/master/07-NeuralNetwork.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
