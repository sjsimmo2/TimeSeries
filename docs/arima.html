<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 ARIMA | Time Series 1 and 2</title>
  <meta name="description" content="Chapter 4 ARIMA | Time Series 1 and 2" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 ARIMA | Time Series 1 and 2" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 ARIMA | Time Series 1 and 2" />
  
  
  

<meta name="author" content="by Dr. Susan Simmons and Dr. Aric LaBarr" />


<meta name="date" content="2024-09-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exponential-smoothing.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TimeSeries</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#other-plots"><i class="fa fa-check"></i><b>2.1</b> Other plots</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#time-series-decomposition"><i class="fa fa-check"></i><b>2.2</b> Time series decomposition</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#stl-features"><i class="fa fa-check"></i><b>2.3</b> STL features</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#missing-values"><i class="fa fa-check"></i><b>2.4</b> Missing values</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#python-code-and-results-for-time-series-plot"><i class="fa fa-check"></i><b>2.5</b> Python code and results for Time Series plot</a></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#sas-code-for-time-series-plot-and-decomposition"><i class="fa fa-check"></i><b>2.6</b> SAS code for time series plot and decomposition</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>3</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.1</b> Simple Exponential Smoothing</a></li>
<li class="chapter" data-level="3.2" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-esm"><i class="fa fa-check"></i><b>3.2</b> Holt ESM</a></li>
<li class="chapter" data-level="3.3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-winters"><i class="fa fa-check"></i><b>3.3</b> Holt-Winters</a></li>
<li class="chapter" data-level="3.4" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#comparing-forecasts"><i class="fa fa-check"></i><b>3.4</b> Comparing forecasts</a></li>
<li class="chapter" data-level="3.5" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#ets"><i class="fa fa-check"></i><b>3.5</b> ETS</a></li>
<li class="chapter" data-level="3.6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#python-code-for-exponential-smoothing"><i class="fa fa-check"></i><b>3.6</b> Python Code for Exponential Smoothing</a></li>
<li class="chapter" data-level="3.7" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#sas-code-for-exponential-smoothing-models"><i class="fa fa-check"></i><b>3.7</b> SAS Code for Exponential Smoothing Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#correlation-functions"><i class="fa fa-check"></i><b>4.2</b> Correlation Functions</a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#autoregressive-models-ar"><i class="fa fa-check"></i><b>4.3</b> AutoRegressive Models (AR)</a></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#moving-average-model-ma"><i class="fa fa-check"></i><b>4.4</b> Moving Average model (MA)</a></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#white-noise"><i class="fa fa-check"></i><b>4.5</b> White noise</a></li>
<li class="chapter" data-level="4.6" data-path="arima.html"><a href="arima.html#examples"><i class="fa fa-check"></i><b>4.6</b> Examples</a></li>
<li class="chapter" data-level="4.7" data-path="arima.html"><a href="arima.html#forecasting"><i class="fa fa-check"></i><b>4.7</b> Forecasting</a></li>
<li class="chapter" data-level="4.8" data-path="arima.html"><a href="arima.html#trend"><i class="fa fa-check"></i><b>4.8</b> Trend</a></li>
<li class="chapter" data-level="4.9" data-path="arima.html"><a href="arima.html#python-code-for-armaarima-models"><i class="fa fa-check"></i><b>4.9</b> Python Code for ARMA/ARIMA models</a></li>
<li class="chapter" data-level="4.10" data-path="arima.html"><a href="arima.html#sas-code-for-armaarima"><i class="fa fa-check"></i><b>4.10</b> SAS Code for ARMA/ARIMA</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1 and 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="arima" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> ARIMA<a href="arima.html#arima" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We will not be getting into ARIMA. This chapter is fairly long and covers many different concepts in ARIMA.</p>
<div id="stationarity" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Stationarity<a href="arima.html#stationarity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we can try to model the dependency structure (the AR and MA terms), we must first have a stationary series! The ADF test is one of the most well-known and accepted test for testing stationarity. However, others have also been proposed. Within this document, we will be using the KPSS test.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="arima.html#cb1-1" tabindex="-1"></a>Quotes.ts<span class="ot">&lt;-</span>Quotes <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2002-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2005-04-01&#39;</span>),<span class="at">by=</span><span class="st">&#39;months&#39;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="arima.html#cb1-2" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span>
<span id="cb1-3"><a href="arima.html#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="arima.html#cb1-4" tabindex="-1"></a>Quotes_train<span class="ot">&lt;-</span>Quotes.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">2005</span>)</span>
<span id="cb1-5"><a href="arima.html#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="arima.html#cb1-6" tabindex="-1"></a><span class="fu">autoplot</span>(Quotes_train,Quotes)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Monthly Stock quotes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Quotes&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/plot-1.png" width="672" /></p>
<p>The following code looks into stationarity.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="arima.html#cb2-1" tabindex="-1"></a><span class="co"># Perform the KPSS test </span></span>
<span id="cb2-2"><a href="arima.html#cb2-2" tabindex="-1"></a>Quotes_train <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="arima.html#cb2-3" tabindex="-1"></a> <span class="fu">features</span>(Quotes, unitroot_kpss)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   kpss_stat kpss_pvalue
##       &lt;dbl&gt;       &lt;dbl&gt;
## 1     0.197         0.1</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="arima.html#cb4-1" tabindex="-1"></a>Quotes_train <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="arima.html#cb4-2" tabindex="-1"></a> <span class="fu">features</span>(Quotes, unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      0</code></pre>
</div>
<div id="correlation-functions" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Correlation Functions<a href="arima.html#correlation-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Acf and the Pacf in R will calculate the autocorrelation (up to the lag you specify) and the partial autocorrelation, respectively.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="arima.html#cb6-1" tabindex="-1"></a><span class="fu">ggAcf</span>(Quotes_train<span class="sc">$</span>Quotes,<span class="at">lag=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-1.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="arima.html#cb7-1" tabindex="-1"></a><span class="fu">ggPacf</span>(Quotes_train<span class="sc">$</span>Quotes,<span class="at">lag=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-2.png" width="672" /></p>
<p>Since the Hurricane data set needs a difference to be stationary, we will first create the difference column and explore the correlations in that variable.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="arima.html#cb8-1" tabindex="-1"></a>Hurricane.ts<span class="ot">&lt;-</span> hurricane <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>Year)</span>
<span id="cb8-2"><a href="arima.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="arima.html#cb8-3" tabindex="-1"></a>Hurricane_train <span class="ot">&lt;-</span>Hurricane.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&lt;</span><span class="dv">2000</span>)</span>
<span id="cb8-4"><a href="arima.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="arima.html#cb8-5" tabindex="-1"></a><span class="fu">autoplot</span>(Hurricane_train,MeanVMax)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Yearly Mean Velocity for Hurricanes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;MPH&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="arima.html#cb9-1" tabindex="-1"></a>Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">features</span>(MeanVMax,unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      1</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="arima.html#cb11-1" tabindex="-1"></a>Hurricane_train <span class="ot">&lt;-</span> Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mean_diff=</span><span class="fu">difference</span>(MeanVMax))</span>
<span id="cb11-2"><a href="arima.html#cb11-2" tabindex="-1"></a>Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">features</span>(mean_diff,unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      0</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="arima.html#cb13-1" tabindex="-1"></a><span class="fu">autoplot</span>(Hurricane_train,mean_diff)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Differenced Mean Max Velocity&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Difference&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
</div>
<div id="autoregressive-models-ar" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> AutoRegressive Models (AR)<a href="arima.html#autoregressive-models-ar" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>AutoRegressive (AR) models involve modeling the lags of Y. We can write an autoregressive model as</p>
<p><span class="math display">\[ Y_{t} = c + \phi_{1}Y_{t-1}+\phi_{2}Y_{t-2}+...\phi_{p}Y_{t-p}+\epsilon_{t} \]</span>
Where there are <em>p</em> lags of <em>Y</em>. Below is the code to fit an AR(2) model. The <em>order</em> in the <em>Arima</em> function needs the p,d,q values (p=# of AR terms, d=how many differences should be taken and q=# of MA terms).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="arima.html#cb15-1" tabindex="-1"></a><span class="fu">ggAcf</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">731</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="arima.html#cb16-1" tabindex="-1"></a><span class="fu">ggPacf</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">731</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-2.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="arima.html#cb17-1" tabindex="-1"></a>Y<span class="fl">.1</span> <span class="ot">&lt;-</span><span class="fu">data.frame</span>(Y)</span>
<span id="cb17-2"><a href="arima.html#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="arima.html#cb17-3" tabindex="-1"></a>Y.ts<span class="ot">&lt;-</span>Y<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2000-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2002-09-26&#39;</span>),<span class="at">by=</span><span class="st">&#39;day&#39;</span>))  <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>date)</span>
<span id="cb17-4"><a href="arima.html#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="arima.html#cb17-5" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> Y.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">2002</span>)</span>
<span id="cb17-6"><a href="arima.html#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="arima.html#cb17-7" tabindex="-1"></a><span class="fu">autoplot</span>(Y_train,Y)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Simulated Daily series&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-3.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="arima.html#cb18-1" tabindex="-1"></a>Y.ARIMA <span class="ot">&lt;-</span> Y_train <span class="sc">%&gt;%</span> <span class="fu">model</span>(<span class="fu">ARIMA</span>(Y<span class="sc">~</span><span class="fu">pdq</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb18-2"><a href="arima.html#cb18-2" tabindex="-1"></a><span class="fu">report</span>(Y.ARIMA)</span></code></pre></div>
<pre><code>## Series: Y 
## Model: ARIMA(2,0,0) 
## 
## Coefficients:
##          ar1      ar2
##       0.6399  -0.3838
## s.e.  0.0342   0.0342
## 
## sigma^2 estimated as 93.75:  log likelihood=-2696.14
## AIC=5398.28   AICc=5398.32   BIC=5412.07</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="arima.html#cb20-1" tabindex="-1"></a>Y.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-4.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="arima.html#cb21-1" tabindex="-1"></a>Y.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-5.png" width="672" /></p>
</div>
<div id="moving-average-model-ma" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Moving Average model (MA)<a href="arima.html#moving-average-model-ma" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Moving average (MA) models involve modeling the lags of the error. We can write a moving average model as</p>
<p><span class="math display">\[ Y_{t} = c - \theta_{1}\epsilon_{t-1}-\theta_{2}\epsilon_{t-2}-...\theta_{q}\epsilon_{t-q}+\epsilon_{t} \]</span>
Where there are <em>q</em> lags of <span class="math inline">\(\epsilon\)</span>. Below is code to fit an MA(2) model.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="arima.html#cb22-1" tabindex="-1"></a><span class="fu">ggAcf</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">74</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-1.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="arima.html#cb23-1" tabindex="-1"></a><span class="fu">ggPacf</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">74</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-2.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="arima.html#cb24-1" tabindex="-1"></a>x<span class="fl">.1</span> <span class="ot">&lt;-</span><span class="fu">data.frame</span>(x)</span>
<span id="cb24-2"><a href="arima.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="arima.html#cb24-3" tabindex="-1"></a>x.ts<span class="ot">&lt;-</span>x<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2000-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2000-4-9&#39;</span>),<span class="at">by=</span><span class="st">&#39;day&#39;</span>))  <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>date)</span>
<span id="cb24-4"><a href="arima.html#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="arima.html#cb24-5" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> x.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="st">&#39;2000-3-15&#39;</span>)</span>
<span id="cb24-6"><a href="arima.html#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="arima.html#cb24-7" tabindex="-1"></a><span class="fu">autoplot</span>(x_train,x)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Simulated Daily series&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-3.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="arima.html#cb25-1" tabindex="-1"></a>x.ARIMA <span class="ot">&lt;-</span> x_train <span class="sc">%&gt;%</span> <span class="fu">model</span>(<span class="fu">ARIMA</span>(x<span class="sc">~</span><span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="sc">+</span><span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb25-2"><a href="arima.html#cb25-2" tabindex="-1"></a><span class="fu">report</span>(x.ARIMA)</span></code></pre></div>
<pre><code>## Series: x 
## Model: ARIMA(0,0,2) 
## 
## Coefficients:
##           ma1     ma2
##       -0.2585  0.4874
## s.e.   0.1031  0.1063
## 
## sigma^2 estimated as 0.2299:  log likelihood=-49.88
## AIC=105.77   AICc=106.11   BIC=112.68</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="arima.html#cb27-1" tabindex="-1"></a>x.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-4.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="arima.html#cb28-1" tabindex="-1"></a>x.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-5.png" width="672" /></p>
</div>
<div id="white-noise" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> White noise<a href="arima.html#white-noise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For residuals to exhibit white noise, they must be “independent” and normally distributed with mean 0 and constant variance. You already know how to assess normality and constant variance, however, we need to focus on assessing “independence”. We can assess if there is significant dependence through the Ljung-Box test (or graphically through ACF and PACF plots). The hypotheses being tested are</p>
<p><span class="math display">\[H_{0}:No\quad significant\quad autocorrelation\\
H_{A}:Significant\qquad autocorrletion \]</span></p>
<p>This should be assessed on a <em>stationary</em> time series. Looking at a stationary time series, going back 10 lags should be sufficient (this will be different when we get to seasonal models). Keep in mind that sample size does matter when assessing significance (adjust significance level accordingly).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="arima.html#cb29-1" tabindex="-1"></a><span class="do">### Before fitting model:</span></span>
<span id="cb29-2"><a href="arima.html#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="arima.html#cb29-3" tabindex="-1"></a><span class="fu">ljung_box</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">731</span>,], <span class="at">lag =</span> <span class="dv">10</span>, <span class="at">dof=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>##   lb_stat lb_pvalue 
##  217.3408    0.0000</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="arima.html#cb31-1" tabindex="-1"></a><span class="do">## Note: Y is a vector</span></span>
<span id="cb31-2"><a href="arima.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="arima.html#cb31-3" tabindex="-1"></a><span class="do">### After fitting model:</span></span>
<span id="cb31-4"><a href="arima.html#cb31-4" tabindex="-1"></a></span>
<span id="cb31-5"><a href="arima.html#cb31-5" tabindex="-1"></a><span class="fu">augment</span>(Y.ARIMA) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model                                 lb_stat lb_pvalue
##   &lt;chr&gt;                                    &lt;dbl&gt;     &lt;dbl&gt;
## 1 ARIMA(Y ~ pdq(2, 0, 0) + PDQ(0, 0, 0))    8.50     0.386</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="arima.html#cb33-1" tabindex="-1"></a><span class="do">## Note that dof has changed!!</span></span></code></pre></div>
</div>
<div id="examples" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Examples<a href="arima.html#examples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will now demonstrate these ideas on two different examples:</p>
<p>First example is the Quotes data set:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="arima.html#cb34-1" tabindex="-1"></a>Quotes.ts<span class="ot">&lt;-</span>Quotes <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2002-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2005-04-21&#39;</span>),<span class="at">by=</span><span class="st">&#39;months&#39;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="arima.html#cb34-2" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span>
<span id="cb34-3"><a href="arima.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="arima.html#cb34-4" tabindex="-1"></a>Quotes_train<span class="ot">&lt;-</span>Quotes.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">2005</span>)</span>
<span id="cb34-5"><a href="arima.html#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="arima.html#cb34-6" tabindex="-1"></a><span class="fu">autoplot</span>(Quotes_train,Quotes)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Monthly Stock quotes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Quotes&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="arima.html#cb35-1" tabindex="-1"></a>Quotes_train <span class="sc">%&gt;%</span> <span class="fu">gg_tsdisplay</span>(Quotes,<span class="at">plot_type =</span> <span class="st">&#39;partial&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<p>We will try AR(1), MA(1) and perform two automatic searches:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="arima.html#cb36-1" tabindex="-1"></a>quotes_model <span class="ot">&lt;-</span>Quotes_train <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="arima.html#cb36-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ar1 =</span> <span class="fu">ARIMA</span>(Quotes <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb36-3"><a href="arima.html#cb36-3" tabindex="-1"></a>        <span class="at">ma1 =</span> <span class="fu">ARIMA</span>(Quotes <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb36-4"><a href="arima.html#cb36-4" tabindex="-1"></a>        <span class="at">search1 =</span> <span class="fu">ARIMA</span>(Quotes),</span>
<span id="cb36-5"><a href="arima.html#cb36-5" tabindex="-1"></a>        <span class="at">search2 =</span> <span class="fu">ARIMA</span>(Quotes,<span class="at">stepwise =</span> F))</span>
<span id="cb36-6"><a href="arima.html#cb36-6" tabindex="-1"></a></span>
<span id="cb36-7"><a href="arima.html#cb36-7" tabindex="-1"></a>quotes_model2<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(quotes_model)</span>
<span id="cb36-8"><a href="arima.html#cb36-8" tabindex="-1"></a><span class="fu">t</span>(quotes_model2)</span></code></pre></div>
<pre><code>##         [,1]                
## ar1     ARIMA(1,0,0) w/ mean
## ma1     ARIMA(0,0,1) w/ mean
## search1 ARIMA(1,0,1) w/ mean
## search2 ARIMA(1,0,1) w/ mean</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="arima.html#cb38-1" tabindex="-1"></a><span class="fu">glance</span>(quotes_model) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 6
##   .model  sigma2 log_lik   AIC  AICc   BIC
##   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 search1   2.54   -66.8  142.  143.  148.
## 2 search2   2.54   -66.8  142.  143.  148.
## 3 ma1       2.75   -68.7  143.  144.  148.
## 4 ar1       2.79   -68.8  144.  144.  148.</code></pre>
<p>Choosing the search1 model, we will look at residuals for white noise (no spikes in correlation plots and not significant for the Ljung-Box test):</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="arima.html#cb40-1" tabindex="-1"></a>quotes_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="arima.html#cb41-1" tabindex="-1"></a>quotes_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="arima.html#cb42-1" tabindex="-1"></a>quotes_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-3.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="arima.html#cb43-1" tabindex="-1"></a><span class="fu">augment</span>(quotes_model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.model<span class="sc">==</span><span class="st">&#39;search1&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model  lb_stat lb_pvalue
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 search1    3.60     0.892</code></pre>
<p>Second example is the Hurricane data set (mean Maximum velocity):</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="arima.html#cb45-1" tabindex="-1"></a>Hurricane.ts<span class="ot">&lt;-</span> hurricane <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>Year)</span>
<span id="cb45-2"><a href="arima.html#cb45-2" tabindex="-1"></a></span>
<span id="cb45-3"><a href="arima.html#cb45-3" tabindex="-1"></a>Hurricane_train <span class="ot">&lt;-</span>Hurricane.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&lt;</span><span class="dv">2000</span>)</span>
<span id="cb45-4"><a href="arima.html#cb45-4" tabindex="-1"></a></span>
<span id="cb45-5"><a href="arima.html#cb45-5" tabindex="-1"></a><span class="fu">autoplot</span>(Hurricane_train,MeanVMax)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Yearly Mean Velocity for Hurricanes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;MPH&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="arima.html#cb46-1" tabindex="-1"></a>Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">features</span>(MeanVMax,unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      1</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="arima.html#cb48-1" tabindex="-1"></a>Hurricane_train <span class="ot">&lt;-</span> Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mean_diff=</span><span class="fu">difference</span>(MeanVMax))</span>
<span id="cb48-2"><a href="arima.html#cb48-2" tabindex="-1"></a></span>
<span id="cb48-3"><a href="arima.html#cb48-3" tabindex="-1"></a>Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">gg_tsdisplay</span>(mean_diff,<span class="at">plot_type =</span> <span class="st">&#39;partial&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="arima.html#cb51-1" tabindex="-1"></a>hurr_model <span class="ot">&lt;-</span>Hurricane_train <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="arima.html#cb51-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ar3 =</span> <span class="fu">ARIMA</span>(MeanVMax <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb51-3"><a href="arima.html#cb51-3" tabindex="-1"></a>        <span class="at">ma2 =</span> <span class="fu">ARIMA</span>(MeanVMax <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb51-4"><a href="arima.html#cb51-4" tabindex="-1"></a>        <span class="at">arima32 =</span> <span class="fu">ARIMA</span>(MeanVMax<span class="sc">~</span><span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb51-5"><a href="arima.html#cb51-5" tabindex="-1"></a>        <span class="at">search1 =</span> <span class="fu">ARIMA</span>(MeanVMax),</span>
<span id="cb51-6"><a href="arima.html#cb51-6" tabindex="-1"></a>        <span class="at">search2 =</span> <span class="fu">ARIMA</span>(MeanVMax,<span class="at">stepwise =</span> F))</span>
<span id="cb51-7"><a href="arima.html#cb51-7" tabindex="-1"></a></span>
<span id="cb51-8"><a href="arima.html#cb51-8" tabindex="-1"></a>hurr_model2<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(hurr_model)</span>
<span id="cb51-9"><a href="arima.html#cb51-9" tabindex="-1"></a><span class="fu">t</span>(hurr_model2)</span></code></pre></div>
<pre><code>##         [,1]                
## ar3     ARIMA(3,1,0)        
## ma2     ARIMA(0,1,2)        
## arima32 ARIMA(3,1,2)        
## search1 ARIMA(1,0,1) w/ mean
## search2 ARIMA(2,0,3) w/ mean</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="arima.html#cb53-1" tabindex="-1"></a><span class="fu">glance</span>(hurr_model) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
##   .model  sigma2 log_lik   AIC  AICc   BIC
##   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 arima32   94.6   -539. 1090. 1090. 1108.
## 2 ma2       97.4   -542. 1091. 1091. 1100.
## 3 search2   93.1   -540. 1094. 1095. 1115.
## 4 search1   96.3   -544. 1096. 1096. 1108.
## 5 ar3      108.    -549. 1106. 1106. 1118.</code></pre>
<p>Looking at the ACF and PACF on the residuals of MA(2) model.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="arima.html#cb55-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ma2) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="arima.html#cb56-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ma2) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="arima.html#cb57-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ma2) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite outside the scale range
## (`stat_bin()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<p>Looking at the ACF and PACF on the ARIMA(3,1,2) model and Ljung-Box test.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="arima.html#cb60-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(arima32) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="arima.html#cb61-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(arima32) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="arima.html#cb62-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(arima32) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite outside the scale range
## (`stat_bin()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-10-3.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="arima.html#cb65-1" tabindex="-1"></a><span class="fu">augment</span>(hurr_model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.model<span class="sc">==</span><span class="st">&#39;arima32&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model  lb_stat lb_pvalue
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 arima32    5.15     0.398</code></pre>
</div>
<div id="forecasting" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Forecasting<a href="arima.html#forecasting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now let’s forecast each of our models:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="arima.html#cb67-1" tabindex="-1"></a>quotes_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(Quotes_train)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="arima.html#cb68-1" tabindex="-1"></a>quotes_for<span class="ot">&lt;-</span>quotes_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">4</span>)</span>
<span id="cb68-2"><a href="arima.html#cb68-2" tabindex="-1"></a></span>
<span id="cb68-3"><a href="arima.html#cb68-3" tabindex="-1"></a>quotes_resid<span class="ot">&lt;-</span>Quotes<span class="sc">$</span>Quotes[<span class="dv">37</span><span class="sc">:</span><span class="dv">40</span>]<span class="sc">-</span>quotes_for<span class="sc">$</span>.mean</span>
<span id="cb68-4"><a href="arima.html#cb68-4" tabindex="-1"></a>MAPE<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(quotes_resid<span class="sc">/</span>Quotes<span class="sc">$</span>Quotes[<span class="dv">37</span><span class="sc">:</span><span class="dv">40</span>]))</span>
<span id="cb68-5"><a href="arima.html#cb68-5" tabindex="-1"></a>MAE<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(quotes_resid))</span>
<span id="cb68-6"><a href="arima.html#cb68-6" tabindex="-1"></a>MAPE</span></code></pre></div>
<pre><code>## [1] 0.2330841</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="arima.html#cb70-1" tabindex="-1"></a>MAE</span></code></pre></div>
<pre><code>## [1] 3.952702</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="arima.html#cb72-1" tabindex="-1"></a>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(arima32) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(Hurricane_train)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="arima.html#cb73-1" tabindex="-1"></a>hurr_for<span class="ot">&lt;-</span>hurr_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(arima32) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">8</span>)</span>
<span id="cb73-2"><a href="arima.html#cb73-2" tabindex="-1"></a></span>
<span id="cb73-3"><a href="arima.html#cb73-3" tabindex="-1"></a>hurr_resid<span class="ot">&lt;-</span>hurricane<span class="sc">$</span>MeanVMax[<span class="dv">150</span><span class="sc">:</span><span class="dv">157</span>]<span class="sc">-</span>hurr_for<span class="sc">$</span>.mean</span>
<span id="cb73-4"><a href="arima.html#cb73-4" tabindex="-1"></a>MAPE<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(hurr_resid<span class="sc">/</span>hurricane<span class="sc">$</span>MeanVMax[<span class="dv">150</span><span class="sc">:</span><span class="dv">157</span>]))</span>
<span id="cb73-5"><a href="arima.html#cb73-5" tabindex="-1"></a>MAE<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(hurr_resid))</span>
<span id="cb73-6"><a href="arima.html#cb73-6" tabindex="-1"></a>MAPE</span></code></pre></div>
<pre><code>## [1] 0.06067555</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="arima.html#cb75-1" tabindex="-1"></a>MAE</span></code></pre></div>
<pre><code>## [1] 5.986266</code></pre>
</div>
<div id="trend" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Trend<a href="arima.html#trend" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will now take a look at trending time series. We will use the Consume and Raleigh Housing prices index as two examples.</p>
<p>Consumer example using differences for trend:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="arima.html#cb77-1" tabindex="-1"></a>consume.ts<span class="ot">&lt;-</span> consume <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date2=</span><span class="fu">my</span>(date))<span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">yearmonth</span>(date2)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span>
<span id="cb77-2"><a href="arima.html#cb77-2" tabindex="-1"></a></span>
<span id="cb77-3"><a href="arima.html#cb77-3" tabindex="-1"></a>consume_train<span class="ot">&lt;-</span>consume.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(date2)<span class="sc">&lt;</span><span class="dv">1990</span>)</span>
<span id="cb77-4"><a href="arima.html#cb77-4" tabindex="-1"></a></span>
<span id="cb77-5"><a href="arima.html#cb77-5" tabindex="-1"></a><span class="fu">autoplot</span>(consume_train,Disposable_income)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Monthly Disposable Income&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Thousands of Dollars&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="arima.html#cb78-1" tabindex="-1"></a><span class="fu">ndiffs</span>(consume_train<span class="sc">$</span>Disposable_income)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="arima.html#cb80-1" tabindex="-1"></a>consume_train<span class="ot">&lt;-</span> consume_train <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="arima.html#cb80-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_diff =</span> <span class="fu">difference</span>(Disposable_income))</span>
<span id="cb80-3"><a href="arima.html#cb80-3" tabindex="-1"></a></span>
<span id="cb80-4"><a href="arima.html#cb80-4" tabindex="-1"></a><span class="fu">autoplot</span>(consume_train,income_diff)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Differenced Monthly Disposable Income&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Differences&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="arima.html#cb82-1" tabindex="-1"></a>consume_train <span class="sc">%&gt;%</span> <span class="fu">gg_tsdisplay</span>(income_diff,<span class="at">plot_type =</span> <span class="st">&#39;partial&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<p>Looking at the ACF and PACF, we will try a few models and also use an automatic search.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="arima.html#cb85-1" tabindex="-1"></a>consume_model <span class="ot">&lt;-</span>consume_train <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="arima.html#cb85-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">ar1 =</span> <span class="fu">ARIMA</span>(Disposable_income <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb85-3"><a href="arima.html#cb85-3" tabindex="-1"></a>        <span class="at">ma1 =</span> <span class="fu">ARIMA</span>(Disposable_income <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb85-4"><a href="arima.html#cb85-4" tabindex="-1"></a>        <span class="at">ar6 =</span> <span class="fu">ARIMA</span>(Disposable_income <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb85-5"><a href="arima.html#cb85-5" tabindex="-1"></a>        <span class="at">ma6 =</span> <span class="fu">ARIMA</span>(Disposable_income <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb85-6"><a href="arima.html#cb85-6" tabindex="-1"></a>        <span class="at">search1 =</span> <span class="fu">ARIMA</span>(Disposable_income),</span>
<span id="cb85-7"><a href="arima.html#cb85-7" tabindex="-1"></a>        <span class="at">search2 =</span> <span class="fu">ARIMA</span>(Disposable_income,<span class="at">stepwise =</span> F))</span>
<span id="cb85-8"><a href="arima.html#cb85-8" tabindex="-1"></a></span>
<span id="cb85-9"><a href="arima.html#cb85-9" tabindex="-1"></a>consume_model2<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(consume_model)</span>
<span id="cb85-10"><a href="arima.html#cb85-10" tabindex="-1"></a><span class="fu">t</span>(consume_model2)</span></code></pre></div>
<pre><code>##         [,1]                 
## ar1     ARIMA(1,1,0) w/ drift
## ma1     ARIMA(0,1,1) w/ drift
## ar6     ARIMA(6,1,0) w/ drift
## ma6     ARIMA(0,1,6)         
## search1 ARIMA(0,1,1) w/ drift
## search2 ARIMA(0,1,1) w/ drift</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="arima.html#cb87-1" tabindex="-1"></a><span class="fu">glance</span>(consume_model) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   .model  sigma2 log_lik   AIC  AICc   BIC
##   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 ma1       546.   -397.  799.  800.  807.
## 2 search1   546.   -397.  799.  800.  807.
## 3 search2   546.   -397.  799.  800.  807.
## 4 ar6       520.   -392.  800.  802.  820.
## 5 ar1       571.   -399.  803.  803.  811.
## 6 ma6       610.   -400.  814.  815.  831.</code></pre>
<p>Selecting the ARIMA(6,1,0) model. White noise looks good and forecast is good.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="arima.html#cb89-1" tabindex="-1"></a>consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ar6) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="arima.html#cb90-1" tabindex="-1"></a>consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ar6) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="arima.html#cb91-1" tabindex="-1"></a>consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ar6) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-3.png" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="arima.html#cb92-1" tabindex="-1"></a><span class="fu">augment</span>(consume_model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.model<span class="sc">==</span><span class="st">&#39;ar6&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model lb_stat lb_pvalue
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 ar6       3.21     0.523</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="arima.html#cb94-1" tabindex="-1"></a>pred_ar6 <span class="ot">&lt;-</span> consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ar6) <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="arima.html#cb94-2" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">6</span>)</span>
<span id="cb94-3"><a href="arima.html#cb94-3" tabindex="-1"></a></span>
<span id="cb94-4"><a href="arima.html#cb94-4" tabindex="-1"></a>error_ar6 <span class="ot">&lt;-</span> consume<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>] <span class="sc">-</span> pred_ar6<span class="sc">$</span>.mean</span>
<span id="cb94-5"><a href="arima.html#cb94-5" tabindex="-1"></a>MAPE_ar6 <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_ar6<span class="sc">/</span>consume<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>]))</span>
<span id="cb94-6"><a href="arima.html#cb94-6" tabindex="-1"></a>MAE_ar6 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_ar6))</span>
<span id="cb94-7"><a href="arima.html#cb94-7" tabindex="-1"></a></span>
<span id="cb94-8"><a href="arima.html#cb94-8" tabindex="-1"></a>consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ar6) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(consume_train)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-4.png" width="672" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="arima.html#cb95-1" tabindex="-1"></a>pred_ma1 <span class="ot">&lt;-</span> consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ma1) <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="arima.html#cb95-2" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">6</span>)</span>
<span id="cb95-3"><a href="arima.html#cb95-3" tabindex="-1"></a></span>
<span id="cb95-4"><a href="arima.html#cb95-4" tabindex="-1"></a>error_ma1 <span class="ot">&lt;-</span> consume<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>] <span class="sc">-</span> pred_ma1<span class="sc">$</span>.mean</span>
<span id="cb95-5"><a href="arima.html#cb95-5" tabindex="-1"></a>MAPE_ma1 <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_ma1<span class="sc">/</span>consume<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>]))</span>
<span id="cb95-6"><a href="arima.html#cb95-6" tabindex="-1"></a>MAE_ma1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_ma1))</span>
<span id="cb95-7"><a href="arima.html#cb95-7" tabindex="-1"></a></span>
<span id="cb95-8"><a href="arima.html#cb95-8" tabindex="-1"></a>consume_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(ma1) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(consume_train)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-5.png" width="672" /></p>
<p>Raleigh example using differences:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="arima.html#cb96-1" tabindex="-1"></a>Raleigh.ts<span class="ot">&lt;-</span> Raleigh <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quarter=</span><span class="fu">yearquarter</span>(DATE)) <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>quarter)</span>
<span id="cb96-2"><a href="arima.html#cb96-2" tabindex="-1"></a></span>
<span id="cb96-3"><a href="arima.html#cb96-3" tabindex="-1"></a>Raleigh_train <span class="ot">&lt;-</span>Raleigh.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(quarter <span class="sc">&lt;</span><span class="fu">yearquarter</span>(<span class="st">&quot;2023 Q1&quot;</span>))</span>
<span id="cb96-4"><a href="arima.html#cb96-4" tabindex="-1"></a></span>
<span id="cb96-5"><a href="arima.html#cb96-5" tabindex="-1"></a><span class="fu">autoplot</span>(Raleigh_train,price_index)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Quarterly Housing price Index for Raleigh-Cary&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Index&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="arima.html#cb97-1" tabindex="-1"></a>Raleigh_train <span class="sc">%&gt;%</span> <span class="fu">features</span>(price_index,unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      2</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="arima.html#cb99-1" tabindex="-1"></a>Raleigh_train <span class="ot">&lt;-</span> Raleigh_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diff_price=</span><span class="fu">difference</span>(<span class="fu">difference</span>(price_index)))</span>
<span id="cb99-2"><a href="arima.html#cb99-2" tabindex="-1"></a></span>
<span id="cb99-3"><a href="arima.html#cb99-3" tabindex="-1"></a>Raleigh_train <span class="sc">%&gt;%</span> <span class="fu">gg_tsdisplay</span>(diff_price,<span class="at">plot_type =</span> <span class="st">&#39;partial&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
<p>Now we will try a few models:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="arima.html#cb102-1" tabindex="-1"></a>Raleigh_model <span class="ot">&lt;-</span>Raleigh_train <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="arima.html#cb102-2" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb102-3"><a href="arima.html#cb102-3" tabindex="-1"></a>        <span class="at">ma5 =</span> <span class="fu">ARIMA</span>(price_index <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>)<span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">0</span>),</span>
<span id="cb102-4"><a href="arima.html#cb102-4" tabindex="-1"></a>        <span class="at">ar2 =</span> <span class="fu">ARIMA</span>(price_index <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>)<span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">0</span>),</span>
<span id="cb102-5"><a href="arima.html#cb102-5" tabindex="-1"></a>        <span class="at">ma2 =</span> <span class="fu">ARIMA</span>(price_index <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>)<span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">0</span>),</span>
<span id="cb102-6"><a href="arima.html#cb102-6" tabindex="-1"></a>        <span class="at">search1 =</span> <span class="fu">ARIMA</span>(price_index<span class="sc">~</span><span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb102-7"><a href="arima.html#cb102-7" tabindex="-1"></a>        <span class="at">search2 =</span> <span class="fu">ARIMA</span>(price_index,<span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-8"><a href="arima.html#cb102-8" tabindex="-1"></a>        )</span>
<span id="cb102-9"><a href="arima.html#cb102-9" tabindex="-1"></a></span>
<span id="cb102-10"><a href="arima.html#cb102-10" tabindex="-1"></a>Raleigh_model2<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Raleigh_model)</span>
<span id="cb102-11"><a href="arima.html#cb102-11" tabindex="-1"></a><span class="fu">t</span>(Raleigh_model2)</span></code></pre></div>
<pre><code>##         [,1]        
## ma5     ARIMA(0,2,5)
## ar2     ARIMA(2,2,0)
## ma2     ARIMA(0,2,2)
## search1 ARIMA(1,2,3)
## search2 ARIMA(0,2,5)</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="arima.html#cb104-1" tabindex="-1"></a><span class="fu">glance</span>(Raleigh_model) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
##   .model  sigma2 log_lik   AIC  AICc   BIC
##   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 ma5       7.65   -219.  451.  452.  466.
## 2 search2   7.65   -219.  451.  452.  466.
## 3 search1   8.36   -223.  455.  456.  468.
## 4 ar2       9.50   -229.  464.  464.  471.
## 5 ma2      10.1    -231.  468.  469.  476.</code></pre>
<p>Looking at residuals:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="arima.html#cb106-1" tabindex="-1"></a>Raleigh_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="arima.html#cb107-1" tabindex="-1"></a>Raleigh_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="arima.html#cb108-1" tabindex="-1"></a>Raleigh_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-3.png" width="672" /></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="arima.html#cb109-1" tabindex="-1"></a><span class="fu">augment</span>(Raleigh_model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.model<span class="sc">==</span><span class="st">&#39;search1&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model  lb_stat lb_pvalue
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 search1    7.76     0.257</code></pre>
<p>Forecasting chosen model onto the validatoin data set:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="arima.html#cb111-1" tabindex="-1"></a>pred_arima123 <span class="ot">&lt;-</span> Raleigh_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="arima.html#cb111-2" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>)</span>
<span id="cb111-3"><a href="arima.html#cb111-3" tabindex="-1"></a></span>
<span id="cb111-4"><a href="arima.html#cb111-4" tabindex="-1"></a>error_arima123 <span class="ot">&lt;-</span> Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>] <span class="sc">-</span> pred_arima123<span class="sc">$</span>.mean</span>
<span id="cb111-5"><a href="arima.html#cb111-5" tabindex="-1"></a>MAPE_arima123 <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_arima123<span class="sc">/</span>Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>]))</span>
<span id="cb111-6"><a href="arima.html#cb111-6" tabindex="-1"></a>MAE_arima123 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_arima123))</span>
<span id="cb111-7"><a href="arima.html#cb111-7" tabindex="-1"></a></span>
<span id="cb111-8"><a href="arima.html#cb111-8" tabindex="-1"></a>Raleigh_model <span class="sc">%&gt;%</span> <span class="fu">select</span>(search1) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(Raleigh_train)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="arima.html#cb112-1" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb112-2"><a href="arima.html#cb112-2" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">yearquarter</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>),</span>
<span id="cb112-3"><a href="arima.html#cb112-3" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2024-01-01&quot;</span>),</span>
<span id="cb112-4"><a href="arima.html#cb112-4" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>)),</span>
<span id="cb112-5"><a href="arima.html#cb112-5" tabindex="-1"></a>  <span class="at">value =</span> pred_arima123<span class="sc">$</span>.mean  </span>
<span id="cb112-6"><a href="arima.html#cb112-6" tabindex="-1"></a>)</span>
<span id="cb112-7"><a href="arima.html#cb112-7" tabindex="-1"></a></span>
<span id="cb112-8"><a href="arima.html#cb112-8" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb112-9"><a href="arima.html#cb112-9" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">yearquarter</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>),</span>
<span id="cb112-10"><a href="arima.html#cb112-10" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2024-01-01&quot;</span>),</span>
<span id="cb112-11"><a href="arima.html#cb112-11" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>)),</span>
<span id="cb112-12"><a href="arima.html#cb112-12" tabindex="-1"></a>  <span class="at">value =</span> Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>]  </span>
<span id="cb112-13"><a href="arima.html#cb112-13" tabindex="-1"></a>)</span>
<span id="cb112-14"><a href="arima.html#cb112-14" tabindex="-1"></a></span>
<span id="cb112-15"><a href="arima.html#cb112-15" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb112-16"><a href="arima.html#cb112-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> test_data, <span class="fu">aes</span>(<span class="at">x =</span> quarter, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-17"><a href="arima.html#cb112-17" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, <span class="fu">aes</span>(<span class="at">x =</span> quarter, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-18"><a href="arima.html#cb112-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Predicted versus Actual values&quot;</span>,</span>
<span id="cb112-19"><a href="arima.html#cb112-19" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Price Index&quot;</span>) <span class="sc">+</span></span>
<span id="cb112-20"><a href="arima.html#cb112-20" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Using the consumer data set and fitting a linear trend line:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="arima.html#cb113-1" tabindex="-1"></a>consume_linear <span class="ot">&lt;-</span>consume_train <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="arima.html#cb113-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">trend1 =</span> <span class="fu">ARIMA</span>(Disposable_income<span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb113-3"><a href="arima.html#cb113-3" tabindex="-1"></a>        )</span>
<span id="cb113-4"><a href="arima.html#cb113-4" tabindex="-1"></a><span class="fu">report</span>(consume_linear)</span></code></pre></div>
<pre><code>## Series: Disposable_income 
## Model: LM w/ ARIMA(0,0,0) errors 
## 
## Coefficients:
##       trend()  intercept
##        7.8743  2368.4594
## s.e.   0.1168     5.9841
## 
## sigma^2 estimated as 792.5:  log likelihood=-417.56
## AIC=841.12   AICc=841.41   BIC=848.56</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="arima.html#cb115-1" tabindex="-1"></a>fitted_values <span class="ot">&lt;-</span> <span class="fu">fitted</span>(consume_linear)</span>
<span id="cb115-2"><a href="arima.html#cb115-2" tabindex="-1"></a></span>
<span id="cb115-3"><a href="arima.html#cb115-3" tabindex="-1"></a><span class="co"># Plot the original data and fitted values</span></span>
<span id="cb115-4"><a href="arima.html#cb115-4" tabindex="-1"></a><span class="fu">autoplot</span>(consume_train, Disposable_income) <span class="sc">+</span></span>
<span id="cb115-5"><a href="arima.html#cb115-5" tabindex="-1"></a>  <span class="fu">autolayer</span>(fitted_values, .fitted, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-6"><a href="arima.html#cb115-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Fitted Values from Linear Regression Model for Disposable Income&quot;</span>,</span>
<span id="cb115-7"><a href="arima.html#cb115-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Dollars (000)&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-8"><a href="arima.html#cb115-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="arima.html#cb116-1" tabindex="-1"></a>consume_linear <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="arima.html#cb117-1" tabindex="-1"></a>consume_linear <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-3.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="arima.html#cb118-1" tabindex="-1"></a>consume_linear <span class="ot">&lt;-</span>consume_train <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="arima.html#cb118-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">trend1 =</span> <span class="fu">ARIMA</span>(Disposable_income<span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb118-3"><a href="arima.html#cb118-3" tabindex="-1"></a>        <span class="at">trend2 =</span> <span class="fu">ARIMA</span>(Disposable_income <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb118-4"><a href="arima.html#cb118-4" tabindex="-1"></a>        )</span>
<span id="cb118-5"><a href="arima.html#cb118-5" tabindex="-1"></a>consume_linear2<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(consume_linear)</span>
<span id="cb118-6"><a href="arima.html#cb118-6" tabindex="-1"></a><span class="fu">t</span>(consume_linear2)</span></code></pre></div>
<pre><code>##        [,1]                     
## trend1 LM w/ ARIMA(6,0,0) errors
## trend2 LM w/ ARIMA(1,0,0) errors</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="arima.html#cb120-1" tabindex="-1"></a><span class="fu">glance</span>(consume_linear) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   .model sigma2 log_lik   AIC  AICc   BIC
##   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 trend2   504.   -397.  803.  803.  813.
## 2 trend1   486.   -393.  805.  807.  827.</code></pre>
<p>Comparing the random walk with drift to the linear trend time series model for the consumer data set:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="arima.html#cb122-1" tabindex="-1"></a>consume_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend1) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="arima.html#cb123-1" tabindex="-1"></a>consume_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend1) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="arima.html#cb124-1" tabindex="-1"></a>consume_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend1) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-3.png" width="672" /></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="arima.html#cb125-1" tabindex="-1"></a><span class="fu">augment</span>(consume_linear) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.model<span class="sc">==</span><span class="st">&#39;trend1&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model lb_stat lb_pvalue
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 trend1    3.20     0.524</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="arima.html#cb127-1" tabindex="-1"></a>pred_lm <span class="ot">&lt;-</span> consume_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend1) <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="arima.html#cb127-2" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">6</span>)</span>
<span id="cb127-3"><a href="arima.html#cb127-3" tabindex="-1"></a></span>
<span id="cb127-4"><a href="arima.html#cb127-4" tabindex="-1"></a>consume_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend1) <span class="sc">%&gt;%</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(consume_train)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-4.png" width="672" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="arima.html#cb128-1" tabindex="-1"></a>error_lm <span class="ot">&lt;-</span> consume<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>] <span class="sc">-</span> pred_lm<span class="sc">$</span>.mean</span>
<span id="cb128-2"><a href="arima.html#cb128-2" tabindex="-1"></a>MAPE_lm <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_lm<span class="sc">/</span>consume<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>]))</span>
<span id="cb128-3"><a href="arima.html#cb128-3" tabindex="-1"></a>MAE_lm <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_lm))</span>
<span id="cb128-4"><a href="arima.html#cb128-4" tabindex="-1"></a></span>
<span id="cb128-5"><a href="arima.html#cb128-5" tabindex="-1"></a></span>
<span id="cb128-6"><a href="arima.html#cb128-6" tabindex="-1"></a>pred_rw <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb128-7"><a href="arima.html#cb128-7" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">yearmonth</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb128-8"><a href="arima.html#cb128-8" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-06-01&quot;</span>),</span>
<span id="cb128-9"><a href="arima.html#cb128-9" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)),</span>
<span id="cb128-10"><a href="arima.html#cb128-10" tabindex="-1"></a>  <span class="at">value =</span> pred_ar6<span class="sc">$</span>.mean  </span>
<span id="cb128-11"><a href="arima.html#cb128-11" tabindex="-1"></a>)</span>
<span id="cb128-12"><a href="arima.html#cb128-12" tabindex="-1"></a></span>
<span id="cb128-13"><a href="arima.html#cb128-13" tabindex="-1"></a>pred_lm2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb128-14"><a href="arima.html#cb128-14" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">yearmonth</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb128-15"><a href="arima.html#cb128-15" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-06-01&quot;</span>),</span>
<span id="cb128-16"><a href="arima.html#cb128-16" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)),</span>
<span id="cb128-17"><a href="arima.html#cb128-17" tabindex="-1"></a>  <span class="at">value =</span> pred_lm<span class="sc">$</span>.mean  </span>
<span id="cb128-18"><a href="arima.html#cb128-18" tabindex="-1"></a>)</span>
<span id="cb128-19"><a href="arima.html#cb128-19" tabindex="-1"></a></span>
<span id="cb128-20"><a href="arima.html#cb128-20" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb128-21"><a href="arima.html#cb128-21" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">yearmonth</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb128-22"><a href="arima.html#cb128-22" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-06-01&quot;</span>),</span>
<span id="cb128-23"><a href="arima.html#cb128-23" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)),</span>
<span id="cb128-24"><a href="arima.html#cb128-24" tabindex="-1"></a>  <span class="at">value =</span> consume.ts<span class="sc">$</span>Disposable_income[<span class="dv">89</span><span class="sc">:</span><span class="dv">94</span>]  </span>
<span id="cb128-25"><a href="arima.html#cb128-25" tabindex="-1"></a>)</span>
<span id="cb128-26"><a href="arima.html#cb128-26" tabindex="-1"></a></span>
<span id="cb128-27"><a href="arima.html#cb128-27" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb128-28"><a href="arima.html#cb128-28" tabindex="-1"></a>  test_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Actual&quot;</span>),</span>
<span id="cb128-29"><a href="arima.html#cb128-29" tabindex="-1"></a>  pred_rw <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Random Walk&quot;</span>),</span>
<span id="cb128-30"><a href="arima.html#cb128-30" tabindex="-1"></a>  pred_lm2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Linear Model&quot;</span>)</span>
<span id="cb128-31"><a href="arima.html#cb128-31" tabindex="-1"></a>)</span>
<span id="cb128-32"><a href="arima.html#cb128-32" tabindex="-1"></a></span>
<span id="cb128-33"><a href="arima.html#cb128-33" tabindex="-1"></a><span class="co"># Plot the data with a legend</span></span>
<span id="cb128-34"><a href="arima.html#cb128-34" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> value, <span class="at">color =</span> Line)) <span class="sc">+</span></span>
<span id="cb128-35"><a href="arima.html#cb128-35" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-36"><a href="arima.html#cb128-36" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Predicted versus Actual values&quot;</span>,</span>
<span id="cb128-37"><a href="arima.html#cb128-37" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Disposable Income (000)&quot;</span>,</span>
<span id="cb128-38"><a href="arima.html#cb128-38" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-39"><a href="arima.html#cb128-39" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-23-5.png" width="672" /></p>
<p>Fitting a trend line to the Raleigh data set:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="arima.html#cb129-1" tabindex="-1"></a>Raleigh_linear <span class="ot">&lt;-</span>Raleigh_train <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="arima.html#cb129-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">trend1 =</span> <span class="fu">ARIMA</span>(price_index<span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb129-3"><a href="arima.html#cb129-3" tabindex="-1"></a>    )</span>
<span id="cb129-4"><a href="arima.html#cb129-4" tabindex="-1"></a>Raleigh_linear <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="arima.html#cb130-1" tabindex="-1"></a>Raleigh_linear <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="arima.html#cb131-1" tabindex="-1"></a>Raleigh_linear <span class="ot">&lt;-</span>Raleigh_train <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="arima.html#cb131-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">trend1 =</span> <span class="fu">ARIMA</span>(price_index<span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb131-3"><a href="arima.html#cb131-3" tabindex="-1"></a>        <span class="at">trend2 =</span> <span class="fu">ARIMA</span>(price_index <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb131-4"><a href="arima.html#cb131-4" tabindex="-1"></a>        <span class="at">trend3 =</span> <span class="fu">ARIMA</span>(price_index <span class="sc">~</span> <span class="fu">trend</span>() <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="dv">1</span>,<span class="at">stepwise =</span> <span class="cn">FALSE</span>)</span>
<span id="cb131-5"><a href="arima.html#cb131-5" tabindex="-1"></a>    )</span>
<span id="cb131-6"><a href="arima.html#cb131-6" tabindex="-1"></a>Raleigh_linear2<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(Raleigh_linear)</span>
<span id="cb131-7"><a href="arima.html#cb131-7" tabindex="-1"></a><span class="fu">t</span>(Raleigh_linear2)</span></code></pre></div>
<pre><code>##        [,1]                     
## trend1 LM w/ ARIMA(2,0,0) errors
## trend2 LM w/ ARIMA(2,0,2) errors
## trend3 LM w/ ARIMA(1,0,4) errors</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="arima.html#cb133-1" tabindex="-1"></a><span class="fu">glance</span>(Raleigh_linear) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AICc) <span class="sc">%&gt;%</span> <span class="fu">select</span>(.model<span class="sc">:</span>BIC)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   .model sigma2 log_lik   AIC  AICc   BIC
##   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 trend3   7.45   -224.  465.  466.  485.
## 2 trend2   8.53   -230.  474.  475.  491.
## 3 trend1  10.5    -239.  488.  489.  501.</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="arima.html#cb135-1" tabindex="-1"></a>Raleigh_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend2) <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-3.png" width="672" /></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="arima.html#cb136-1" tabindex="-1"></a>Raleigh_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend2) <span class="sc">%&gt;%</span><span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-4.png" width="672" /></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="arima.html#cb137-1" tabindex="-1"></a><span class="fu">augment</span>(Raleigh_linear) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.model<span class="sc">==</span><span class="st">&#39;trend2&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model lb_stat lb_pvalue
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 trend2    9.50     0.147</code></pre>
<p>Comparing the Raleigh data set using a random walk with drift to the trend model:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="arima.html#cb139-1" tabindex="-1"></a>pred_lm <span class="ot">&lt;-</span> Raleigh_linear <span class="sc">%&gt;%</span> <span class="fu">select</span>(trend2) <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="arima.html#cb139-2" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>)</span>
<span id="cb139-3"><a href="arima.html#cb139-3" tabindex="-1"></a></span>
<span id="cb139-4"><a href="arima.html#cb139-4" tabindex="-1"></a>error_lm <span class="ot">&lt;-</span> Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>] <span class="sc">-</span> pred_lm<span class="sc">$</span>.mean</span>
<span id="cb139-5"><a href="arima.html#cb139-5" tabindex="-1"></a>MAPE_lm <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_lm<span class="sc">/</span>Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>]))</span>
<span id="cb139-6"><a href="arima.html#cb139-6" tabindex="-1"></a>MAE_lm <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_lm))</span>
<span id="cb139-7"><a href="arima.html#cb139-7" tabindex="-1"></a></span>
<span id="cb139-8"><a href="arima.html#cb139-8" tabindex="-1"></a></span>
<span id="cb139-9"><a href="arima.html#cb139-9" tabindex="-1"></a>pred_rw <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb139-10"><a href="arima.html#cb139-10" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">yearquarter</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>),</span>
<span id="cb139-11"><a href="arima.html#cb139-11" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2024-01-01&quot;</span>),</span>
<span id="cb139-12"><a href="arima.html#cb139-12" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>)),</span>
<span id="cb139-13"><a href="arima.html#cb139-13" tabindex="-1"></a>  <span class="at">value =</span> pred_arima123<span class="sc">$</span>.mean  </span>
<span id="cb139-14"><a href="arima.html#cb139-14" tabindex="-1"></a>)</span>
<span id="cb139-15"><a href="arima.html#cb139-15" tabindex="-1"></a></span>
<span id="cb139-16"><a href="arima.html#cb139-16" tabindex="-1"></a>pred_lm2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb139-17"><a href="arima.html#cb139-17" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">yearquarter</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>),</span>
<span id="cb139-18"><a href="arima.html#cb139-18" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2024-01-01&quot;</span>),</span>
<span id="cb139-19"><a href="arima.html#cb139-19" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>)),</span>
<span id="cb139-20"><a href="arima.html#cb139-20" tabindex="-1"></a>  <span class="at">value =</span> pred_lm<span class="sc">$</span>.mean  </span>
<span id="cb139-21"><a href="arima.html#cb139-21" tabindex="-1"></a>)</span>
<span id="cb139-22"><a href="arima.html#cb139-22" tabindex="-1"></a></span>
<span id="cb139-23"><a href="arima.html#cb139-23" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb139-24"><a href="arima.html#cb139-24" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">yearquarter</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>),</span>
<span id="cb139-25"><a href="arima.html#cb139-25" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2024-01-01&quot;</span>),</span>
<span id="cb139-26"><a href="arima.html#cb139-26" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>)),</span>
<span id="cb139-27"><a href="arima.html#cb139-27" tabindex="-1"></a>  <span class="at">value =</span> Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>]  </span>
<span id="cb139-28"><a href="arima.html#cb139-28" tabindex="-1"></a>)</span>
<span id="cb139-29"><a href="arima.html#cb139-29" tabindex="-1"></a></span>
<span id="cb139-30"><a href="arima.html#cb139-30" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb139-31"><a href="arima.html#cb139-31" tabindex="-1"></a>  test_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Actual&quot;</span>),</span>
<span id="cb139-32"><a href="arima.html#cb139-32" tabindex="-1"></a>  pred_rw <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Random Walk&quot;</span>),</span>
<span id="cb139-33"><a href="arima.html#cb139-33" tabindex="-1"></a>  pred_lm2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Linear Model&quot;</span>)</span>
<span id="cb139-34"><a href="arima.html#cb139-34" tabindex="-1"></a>)</span>
<span id="cb139-35"><a href="arima.html#cb139-35" tabindex="-1"></a></span>
<span id="cb139-36"><a href="arima.html#cb139-36" tabindex="-1"></a><span class="co"># Plot the data with a legend</span></span>
<span id="cb139-37"><a href="arima.html#cb139-37" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> quarter, <span class="at">y =</span> value, <span class="at">color =</span> Line)) <span class="sc">+</span></span>
<span id="cb139-38"><a href="arima.html#cb139-38" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-39"><a href="arima.html#cb139-39" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Predicted versus Actual values&quot;</span>,</span>
<span id="cb139-40"><a href="arima.html#cb139-40" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Raleigh Price Index&quot;</span>,</span>
<span id="cb139-41"><a href="arima.html#cb139-41" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-42"><a href="arima.html#cb139-42" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="arima.html#cb140-1" tabindex="-1"></a><span class="do">#### Fitting a Quadratic ARIMAX</span></span>
<span id="cb140-2"><a href="arima.html#cb140-2" tabindex="-1"></a></span>
<span id="cb140-3"><a href="arima.html#cb140-3" tabindex="-1"></a><span class="do">### First we need to create the x-variables</span></span>
<span id="cb140-4"><a href="arima.html#cb140-4" tabindex="-1"></a><span class="do">### I called them time and time2 (time is just a sequence from 1 to n and time2 is time squared)</span></span>
<span id="cb140-5"><a href="arima.html#cb140-5" tabindex="-1"></a>Raleigh2.ts <span class="ot">&lt;-</span> Raleigh.ts <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="at">time2=</span> time<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb140-6"><a href="arima.html#cb140-6" tabindex="-1"></a></span>
<span id="cb140-7"><a href="arima.html#cb140-7" tabindex="-1"></a></span>
<span id="cb140-8"><a href="arima.html#cb140-8" tabindex="-1"></a><span class="do">## Create training data set</span></span>
<span id="cb140-9"><a href="arima.html#cb140-9" tabindex="-1"></a>Raleigh_train2 <span class="ot">&lt;-</span>Raleigh2.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(quarter <span class="sc">&lt;</span><span class="fu">yearquarter</span>(<span class="st">&quot;2023 Q1&quot;</span>))</span>
<span id="cb140-10"><a href="arima.html#cb140-10" tabindex="-1"></a></span>
<span id="cb140-11"><a href="arima.html#cb140-11" tabindex="-1"></a></span>
<span id="cb140-12"><a href="arima.html#cb140-12" tabindex="-1"></a><span class="do">##Create linear model</span></span>
<span id="cb140-13"><a href="arima.html#cb140-13" tabindex="-1"></a>lm.raleigh<span class="ot">&lt;-</span><span class="fu">lm</span>(price_index<span class="sc">~</span>time<span class="sc">+</span>time2,<span class="at">data=</span>Raleigh_train2)</span>
<span id="cb140-14"><a href="arima.html#cb140-14" tabindex="-1"></a></span>
<span id="cb140-15"><a href="arima.html#cb140-15" tabindex="-1"></a></span>
<span id="cb140-16"><a href="arima.html#cb140-16" tabindex="-1"></a><span class="do">## Make sure residuals are stationary</span></span>
<span id="cb140-17"><a href="arima.html#cb140-17" tabindex="-1"></a><span class="fu">ndiffs</span>(<span class="fu">resid</span>(lm.raleigh))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="arima.html#cb142-1" tabindex="-1"></a><span class="do">### Look for AR and MA terms on the residuals</span></span>
<span id="cb142-2"><a href="arima.html#cb142-2" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">resid</span>(lm.raleigh))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="arima.html#cb143-1" tabindex="-1"></a><span class="fu">ggPacf</span>(<span class="fu">resid</span>(lm.raleigh))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="arima.html#cb144-1" tabindex="-1"></a><span class="do">## Put it all together in a model..notice that I have time and time2 in regression</span></span>
<span id="cb144-2"><a href="arima.html#cb144-2" tabindex="-1"></a></span>
<span id="cb144-3"><a href="arima.html#cb144-3" tabindex="-1"></a>fit <span class="ot">&lt;-</span> Raleigh_train2 <span class="sc">%&gt;%</span> <span class="fu">model</span>(<span class="fu">ARIMA</span>(price_index<span class="sc">~</span> time <span class="sc">+</span>time2 <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb144-4"><a href="arima.html#cb144-4" tabindex="-1"></a></span>
<span id="cb144-5"><a href="arima.html#cb144-5" tabindex="-1"></a><span class="do">### Do I have white noise for the residuals of this model?</span></span>
<span id="cb144-6"><a href="arima.html#cb144-6" tabindex="-1"></a>fit <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-3.png" width="672" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="arima.html#cb145-1" tabindex="-1"></a>fit <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>(<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-4.png" width="672" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="arima.html#cb146-1" tabindex="-1"></a><span class="do">## To forecast, we need to create a new data set with time and time2</span></span>
<span id="cb146-2"><a href="arima.html#cb146-2" tabindex="-1"></a><span class="do">## The training data ended at observation 92</span></span>
<span id="cb146-3"><a href="arima.html#cb146-3" tabindex="-1"></a>Raleigh_future<span class="ot">&lt;-</span> <span class="fu">new_data</span>(Raleigh_train2,<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">time=</span><span class="fu">seq</span>(<span class="dv">93</span>,<span class="dv">97</span>), <span class="at">time2=</span>time<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb146-4"><a href="arima.html#cb146-4" tabindex="-1"></a></span>
<span id="cb146-5"><a href="arima.html#cb146-5" tabindex="-1"></a><span class="do">## Now we can forecast and plot</span></span>
<span id="cb146-6"><a href="arima.html#cb146-6" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit,<span class="at">new_data=</span>Raleigh_future) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(Raleigh_train2)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-5.png" width="672" /></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="arima.html#cb147-1" tabindex="-1"></a><span class="do">## Save forecasts</span></span>
<span id="cb147-2"><a href="arima.html#cb147-2" tabindex="-1"></a>fit.quad<span class="ot">&lt;-</span>fabletools<span class="sc">::</span><span class="fu">forecast</span>(fit,<span class="at">new_data=</span>Raleigh_future) </span>
<span id="cb147-3"><a href="arima.html#cb147-3" tabindex="-1"></a></span>
<span id="cb147-4"><a href="arima.html#cb147-4" tabindex="-1"></a><span class="do">##Compare error and also look at plots</span></span>
<span id="cb147-5"><a href="arima.html#cb147-5" tabindex="-1"></a>error_lm <span class="ot">&lt;-</span> Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>] <span class="sc">-</span> pred_lm<span class="sc">$</span>.mean</span>
<span id="cb147-6"><a href="arima.html#cb147-6" tabindex="-1"></a>MAPE_lm <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_lm<span class="sc">/</span>Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>]))</span>
<span id="cb147-7"><a href="arima.html#cb147-7" tabindex="-1"></a>MAE_lm <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_lm))</span>
<span id="cb147-8"><a href="arima.html#cb147-8" tabindex="-1"></a></span>
<span id="cb147-9"><a href="arima.html#cb147-9" tabindex="-1"></a>error_quad <span class="ot">&lt;-</span>Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>] <span class="sc">-</span> fit.quad<span class="sc">$</span>.mean</span>
<span id="cb147-10"><a href="arima.html#cb147-10" tabindex="-1"></a>MAPE_quad <span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">abs</span>(error_quad<span class="sc">/</span>Raleigh.ts<span class="sc">$</span>price_index[<span class="dv">93</span><span class="sc">:</span><span class="dv">97</span>]))</span>
<span id="cb147-11"><a href="arima.html#cb147-11" tabindex="-1"></a>MAE_quad <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(error_quad))</span>
<span id="cb147-12"><a href="arima.html#cb147-12" tabindex="-1"></a></span>
<span id="cb147-13"><a href="arima.html#cb147-13" tabindex="-1"></a>MAPE_lm</span></code></pre></div>
<pre><code>## [1] 0.05431984</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="arima.html#cb149-1" tabindex="-1"></a>MAPE_quad</span></code></pre></div>
<pre><code>## [1] 0.03425431</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="arima.html#cb151-1" tabindex="-1"></a>MAE_lm</span></code></pre></div>
<pre><code>## [1] 18.82757</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="arima.html#cb153-1" tabindex="-1"></a>MAE_quad</span></code></pre></div>
<pre><code>## [1] 11.84002</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="arima.html#cb155-1" tabindex="-1"></a>pred_quad <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb155-2"><a href="arima.html#cb155-2" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">yearquarter</span>(<span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2023-01-01&quot;</span>),</span>
<span id="cb155-3"><a href="arima.html#cb155-3" tabindex="-1"></a>                                 <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2024-01-01&quot;</span>),</span>
<span id="cb155-4"><a href="arima.html#cb155-4" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>)),</span>
<span id="cb155-5"><a href="arima.html#cb155-5" tabindex="-1"></a>  <span class="at">value =</span> fit.quad<span class="sc">$</span>.mean  </span>
<span id="cb155-6"><a href="arima.html#cb155-6" tabindex="-1"></a>)</span>
<span id="cb155-7"><a href="arima.html#cb155-7" tabindex="-1"></a></span>
<span id="cb155-8"><a href="arima.html#cb155-8" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb155-9"><a href="arima.html#cb155-9" tabindex="-1"></a>  test_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Actual&quot;</span>),</span>
<span id="cb155-10"><a href="arima.html#cb155-10" tabindex="-1"></a>  pred_rw <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Random Walk&quot;</span>),</span>
<span id="cb155-11"><a href="arima.html#cb155-11" tabindex="-1"></a>  pred_lm2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Linear Model&quot;</span>),</span>
<span id="cb155-12"><a href="arima.html#cb155-12" tabindex="-1"></a>  pred_quad <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Line =</span> <span class="st">&quot;Quadratic&quot;</span>)</span>
<span id="cb155-13"><a href="arima.html#cb155-13" tabindex="-1"></a>)</span>
<span id="cb155-14"><a href="arima.html#cb155-14" tabindex="-1"></a></span>
<span id="cb155-15"><a href="arima.html#cb155-15" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> quarter, <span class="at">y =</span> value, <span class="at">color =</span> Line)) <span class="sc">+</span></span>
<span id="cb155-16"><a href="arima.html#cb155-16" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-17"><a href="arima.html#cb155-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Predicted versus Actual values&quot;</span>,</span>
<span id="cb155-18"><a href="arima.html#cb155-18" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Raleigh Price Index&quot;</span>,</span>
<span id="cb155-19"><a href="arima.html#cb155-19" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb155-20"><a href="arima.html#cb155-20" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-6.png" width="672" /></p>
</div>
<div id="python-code-for-armaarima-models" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Python Code for ARMA/ARIMA models<a href="arima.html#python-code-for-armaarima-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="arima.html#cb156-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb156-2"><a href="arima.html#cb156-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb156-3"><a href="arima.html#cb156-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb156-4"><a href="arima.html#cb156-4" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb156-5"><a href="arima.html#cb156-5" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb156-6"><a href="arima.html#cb156-6" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb156-7"><a href="arima.html#cb156-7" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb156-8"><a href="arima.html#cb156-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb156-9"><a href="arima.html#cb156-9" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb156-10"><a href="arima.html#cb156-10" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb156-11"><a href="arima.html#cb156-11" tabindex="-1"></a></span>
<span id="cb156-12"><a href="arima.html#cb156-12" tabindex="-1"></a>quotes<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">fpp_insurance.csv&quot;</span>)</span>
<span id="cb156-13"><a href="arima.html#cb156-13" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;2002-01-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;2005-05-01&#39;</span>, freq<span class="op">=</span><span class="st">&#39;ME&#39;</span>)</span>
<span id="cb156-14"><a href="arima.html#cb156-14" tabindex="-1"></a>quotes.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb156-15"><a href="arima.html#cb156-15" tabindex="-1"></a>y<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ar2.csv&quot;</span>)</span>
<span id="cb156-16"><a href="arima.html#cb156-16" tabindex="-1"></a>quotes_train <span class="op">=</span> quotes.head(<span class="dv">36</span>)</span>
<span id="cb156-17"><a href="arima.html#cb156-17" tabindex="-1"></a>y_train <span class="op">=</span> y.head(<span class="dv">731</span>)</span>
<span id="cb156-18"><a href="arima.html#cb156-18" tabindex="-1"></a></span>
<span id="cb156-19"><a href="arima.html#cb156-19" tabindex="-1"></a>result<span class="op">=</span>adfuller(quotes_train[<span class="st">&quot;Quotes&quot;</span>])</span>
<span id="cb156-20"><a href="arima.html#cb156-20" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;ADF p-value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<pre><code>## ADF p-value: 0.04236093395330459</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="arima.html#cb158-1" tabindex="-1"></a>plot_acf(quotes_train[<span class="st">&quot;Quotes&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb158-2"><a href="arima.html#cb158-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-1.png" width="672" /></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="arima.html#cb159-1" tabindex="-1"></a>plot_pacf(quotes_train[<span class="st">&quot;Quotes&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb159-2"><a href="arima.html#cb159-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-2.png" width="672" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="arima.html#cb160-1" tabindex="-1"></a><span class="co">### Using statsmodel...the older way of doing this..</span></span>
<span id="cb160-2"><a href="arima.html#cb160-2" tabindex="-1"></a></span>
<span id="cb160-3"><a href="arima.html#cb160-3" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y_train, order<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb160-4"><a href="arima.html#cb160-4" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb160-5"><a href="arima.html#cb160-5" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code></pre></div>
<pre><code>##                                SARIMAX Results                                
## ==============================================================================
## Dep. Variable:                      Y   No. Observations:                  731
## Model:                 ARIMA(2, 0, 0)   Log Likelihood               -2696.123
## Date:                Wed, 11 Sep 2024   AIC                           5400.247
## Time:                        16:32:27   BIC                           5418.625
## Sample:                             0   HQIC                          5407.337
##                                 - 731                                         
## Covariance Type:                  opg                                         
## ==============================================================================
##                  coef    std err          z      P&gt;|z|      [0.025      0.975]
## ------------------------------------------------------------------------------
## const         -0.0960      0.481     -0.199      0.842      -1.039       0.847
## ar.L1          0.6398      0.036     17.605      0.000       0.569       0.711
## ar.L2         -0.3838      0.035    -11.007      0.000      -0.452      -0.315
## sigma2        93.4961      4.803     19.466      0.000      84.083     102.910
## ===================================================================================
## Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 0.27
## Prob(Q):                              0.95   Prob(JB):                         0.88
## Heteroskedasticity (H):               0.93   Skew:                            -0.03
## Prob(H) (two-sided):                  0.58   Kurtosis:                         3.08
## ===================================================================================
## 
## Warnings:
## [1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="arima.html#cb162-1" tabindex="-1"></a>residuals <span class="op">=</span> DataFrame(model_fit.resid)</span>
<span id="cb162-2"><a href="arima.html#cb162-2" tabindex="-1"></a>residuals.plot()</span>
<span id="cb162-3"><a href="arima.html#cb162-3" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-3.png" width="672" /></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb163-1"><a href="arima.html#cb163-1" tabindex="-1"></a><span class="bu">print</span>(residuals.describe())</span></code></pre></div>
<pre><code>##                 0
## count  731.000000
## mean     0.001103
## std      9.685433
## min    -33.427139
## 25%     -6.456285
## 50%      0.257085
## 75%      6.333976
## max     30.312938</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb165-1"><a href="arima.html#cb165-1" tabindex="-1"></a>plot_acf(residuals,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb165-2"><a href="arima.html#cb165-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-4.png" width="672" /></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="arima.html#cb166-1" tabindex="-1"></a>plot_pacf(residuals,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb166-2"><a href="arima.html#cb166-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-5.png" width="672" /></p>
<p>Using ndiffs to see if we need to take a difference:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb167-1"><a href="arima.html#cb167-1" tabindex="-1"></a><span class="im">from</span> pmdarima.arima <span class="im">import</span> ndiffs</span>
<span id="cb167-2"><a href="arima.html#cb167-2" tabindex="-1"></a></span>
<span id="cb167-3"><a href="arima.html#cb167-3" tabindex="-1"></a>hurr <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/hurrican.csv&quot;</span>)</span>
<span id="cb167-4"><a href="arima.html#cb167-4" tabindex="-1"></a>hurr2 <span class="op">=</span> hurr.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb167-5"><a href="arima.html#cb167-5" tabindex="-1"></a>hurricane_train <span class="op">=</span>hurr2.head(<span class="dv">149</span>)</span>
<span id="cb167-6"><a href="arima.html#cb167-6" tabindex="-1"></a>hurricane_train</span></code></pre></div>
<pre><code>##      Date  Hurricanes  MinVMax  MaxVMax  MeanVMax  Year
## 0    1851           3     80.0    100.0      86.7  1851
## 1    1852           5     70.0    100.0      82.0  1852
## 2    1853           4     70.0    130.0      97.5  1853
## 3    1854           3     70.0    110.0      90.0  1854
## 4    1855           4     70.0    110.0      90.0  1855
## ..    ...         ...      ...      ...       ...   ...
## 146  1997           3     65.0    110.0      81.7  1997
## 147  1998          10     65.0    155.0      96.5  1998
## 148  1999           8     85.0    135.0     114.4  1999
## 149  2000           8     70.0    120.0      91.3  2000
## 150  2001           9     65.0    125.0      91.7  2001
## 
## [149 rows x 6 columns]</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb169-1"><a href="arima.html#cb169-1" tabindex="-1"></a>n_diffs <span class="op">=</span> ndiffs(hurricane_train[<span class="st">&quot;MeanVMax&quot;</span>])</span>
<span id="cb169-2"><a href="arima.html#cb169-2" tabindex="-1"></a><span class="bu">print</span>(n_diffs)</span></code></pre></div>
<pre><code>## 1</code></pre>
<p>Checking for white noise:
The first value in the Ljung-Box test is the test statistic and the second value is the p-value.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb171-1"><a href="arima.html#cb171-1" tabindex="-1"></a><span class="im">import</span> statsmodels.stats.diagnostic <span class="im">as</span> diag</span>
<span id="cb171-2"><a href="arima.html#cb171-2" tabindex="-1"></a></span>
<span id="cb171-3"><a href="arima.html#cb171-3" tabindex="-1"></a></span>
<span id="cb171-4"><a href="arima.html#cb171-4" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y_train, order<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb171-5"><a href="arima.html#cb171-5" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb171-6"><a href="arima.html#cb171-6" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code></pre></div>
<pre><code>##                                SARIMAX Results                                
## ==============================================================================
## Dep. Variable:                      Y   No. Observations:                  731
## Model:                 ARIMA(2, 0, 0)   Log Likelihood               -2696.123
## Date:                Wed, 11 Sep 2024   AIC                           5400.247
## Time:                        16:32:28   BIC                           5418.625
## Sample:                             0   HQIC                          5407.337
##                                 - 731                                         
## Covariance Type:                  opg                                         
## ==============================================================================
##                  coef    std err          z      P&gt;|z|      [0.025      0.975]
## ------------------------------------------------------------------------------
## const         -0.0960      0.481     -0.199      0.842      -1.039       0.847
## ar.L1          0.6398      0.036     17.605      0.000       0.569       0.711
## ar.L2         -0.3838      0.035    -11.007      0.000      -0.452      -0.315
## sigma2        93.4961      4.803     19.466      0.000      84.083     102.910
## ===================================================================================
## Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 0.27
## Prob(Q):                              0.95   Prob(JB):                         0.88
## Heteroskedasticity (H):               0.93   Skew:                            -0.03
## Prob(H) (two-sided):                  0.58   Kurtosis:                         3.08
## ===================================================================================
## 
## Warnings:
## [1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb173-1"><a href="arima.html#cb173-1" tabindex="-1"></a><span class="co"># Perform the Ljung-Box test</span></span>
<span id="cb173-2"><a href="arima.html#cb173-2" tabindex="-1"></a>lb_test <span class="op">=</span> diag.acorr_ljungbox(model_fit.resid, lags<span class="op">=</span>[<span class="dv">10</span>], model_df<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb173-3"><a href="arima.html#cb173-3" tabindex="-1"></a><span class="bu">print</span>(lb_test)</span></code></pre></div>
<pre><code>##      lb_stat  lb_pvalue
## 10  8.542081   0.382384</code></pre>
<p>Fitting ARIMA models.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="arima.html#cb175-1" tabindex="-1"></a><span class="co">## Fit AR(2) model to AR2 data set</span></span>
<span id="cb175-2"><a href="arima.html#cb175-2" tabindex="-1"></a></span>
<span id="cb175-3"><a href="arima.html#cb175-3" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb175-4"><a href="arima.html#cb175-4" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> ARIMA</span>
<span id="cb175-5"><a href="arima.html#cb175-5" tabindex="-1"></a></span>
<span id="cb175-6"><a href="arima.html#cb175-6" tabindex="-1"></a>y<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ar2.csv&quot;</span>)</span>
<span id="cb175-7"><a href="arima.html#cb175-7" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;2000-01-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;2002-09-26&#39;</span>, freq<span class="op">=</span><span class="st">&#39;D&#39;</span>)</span>
<span id="cb175-8"><a href="arima.html#cb175-8" tabindex="-1"></a>y.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb175-9"><a href="arima.html#cb175-9" tabindex="-1"></a></span>
<span id="cb175-10"><a href="arima.html#cb175-10" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: y.index, <span class="st">&#39;y&#39;</span>: y[<span class="st">&#39;Y&#39;</span>]}</span>
<span id="cb175-11"><a href="arima.html#cb175-11" tabindex="-1"></a>y_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb175-12"><a href="arima.html#cb175-12" tabindex="-1"></a>y_train <span class="op">=</span> y_sf.head(<span class="dv">731</span>)</span>
<span id="cb175-13"><a href="arima.html#cb175-13" tabindex="-1"></a>y_test <span class="op">=</span> y_sf.tail(<span class="dv">69</span>)</span>
<span id="cb175-14"><a href="arima.html#cb175-14" tabindex="-1"></a></span>
<span id="cb175-15"><a href="arima.html#cb175-15" tabindex="-1"></a></span>
<span id="cb175-16"><a href="arima.html#cb175-16" tabindex="-1"></a></span>
<span id="cb175-17"><a href="arima.html#cb175-17" tabindex="-1"></a>model_SD_ARIMA <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>))], freq <span class="op">=</span> <span class="st">&#39;D&#39;</span>)</span>
<span id="cb175-18"><a href="arima.html#cb175-18" tabindex="-1"></a>model_SD_ARIMA.fit(df <span class="op">=</span> y_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb177-1"><a href="arima.html#cb177-1" tabindex="-1"></a>model_SD_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (2, 0, 0, 0, 1, 0, 0)</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb179-1"><a href="arima.html#cb179-1" tabindex="-1"></a>model_SD_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.639764746870163, &#39;ar2&#39;: -0.38382211173759334, &#39;intercept&#39;: -0.09343978047884308}</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb181-1"><a href="arima.html#cb181-1" tabindex="-1"></a>model_SD_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 5400.246891714043</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="arima.html#cb183-1" tabindex="-1"></a><span class="co">### Fit MA(2) model to x</span></span>
<span id="cb183-2"><a href="arima.html#cb183-2" tabindex="-1"></a></span>
<span id="cb183-3"><a href="arima.html#cb183-3" tabindex="-1"></a>x<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">MA2.csv&quot;</span>)</span>
<span id="cb183-4"><a href="arima.html#cb183-4" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;2000-01-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;2000-04-09&#39;</span>, freq<span class="op">=</span><span class="st">&#39;D&#39;</span>)</span>
<span id="cb183-5"><a href="arima.html#cb183-5" tabindex="-1"></a>x.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb183-6"><a href="arima.html#cb183-6" tabindex="-1"></a></span>
<span id="cb183-7"><a href="arima.html#cb183-7" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: x.index, <span class="st">&#39;y&#39;</span>: x[<span class="st">&#39;x&#39;</span>]}</span>
<span id="cb183-8"><a href="arima.html#cb183-8" tabindex="-1"></a>x_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb183-9"><a href="arima.html#cb183-9" tabindex="-1"></a>x_train <span class="op">=</span> x_sf.head(<span class="dv">74</span>)</span>
<span id="cb183-10"><a href="arima.html#cb183-10" tabindex="-1"></a>x_test <span class="op">=</span> x_sf.tail(<span class="dv">26</span>)</span>
<span id="cb183-11"><a href="arima.html#cb183-11" tabindex="-1"></a></span>
<span id="cb183-12"><a href="arima.html#cb183-12" tabindex="-1"></a>model_MA2 <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>))], freq <span class="op">=</span> <span class="st">&#39;D&#39;</span>)</span>
<span id="cb183-13"><a href="arima.html#cb183-13" tabindex="-1"></a>model_MA2.fit(df <span class="op">=</span> x_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb185-1"><a href="arima.html#cb185-1" tabindex="-1"></a><span class="co">#### Note: when you get the &quot;ARMA&quot; values for the model, it is listed as:</span></span>
<span id="cb185-2"><a href="arima.html#cb185-2" tabindex="-1"></a><span class="co">###  p q P Q seasonlength d D</span></span>
<span id="cb185-3"><a href="arima.html#cb185-3" tabindex="-1"></a><span class="co">### when it is NOT considering seasonality, season length is set to 1.</span></span>
<span id="cb185-4"><a href="arima.html#cb185-4" tabindex="-1"></a></span>
<span id="cb185-5"><a href="arima.html#cb185-5" tabindex="-1"></a>model_MA2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (0, 2, 0, 0, 1, 0, 0)</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb187-1"><a href="arima.html#cb187-1" tabindex="-1"></a>model_MA2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ma1&#39;: -0.2619702995924874, &#39;ma2&#39;: 0.49786051180314495, &#39;intercept&#39;: 0.0011885524637603277}</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb189-1"><a href="arima.html#cb189-1" tabindex="-1"></a>model_MA2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 107.89060294675609</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="arima.html#cb191-1" tabindex="-1"></a>resid<span class="op">=</span>model_MA2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;residuals&quot;</span>)</span>
<span id="cb191-2"><a href="arima.html#cb191-2" tabindex="-1"></a></span>
<span id="cb191-3"><a href="arima.html#cb191-3" tabindex="-1"></a>plot_acf(resid,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb191-4"><a href="arima.html#cb191-4" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-28-11.png" width="672" /></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="arima.html#cb192-1" tabindex="-1"></a>plot_pacf(resid,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb192-2"><a href="arima.html#cb192-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-28-12.png" width="672" /></p>
<p>Using the Quotes data set for different models in ARIMA:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb193-1"><a href="arima.html#cb193-1" tabindex="-1"></a><span class="co">## Compare two different models plus automatic search on Quotes data set:</span></span>
<span id="cb193-2"><a href="arima.html#cb193-2" tabindex="-1"></a></span>
<span id="cb193-3"><a href="arima.html#cb193-3" tabindex="-1"></a></span>
<span id="cb193-4"><a href="arima.html#cb193-4" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> AutoARIMA</span>
<span id="cb193-5"><a href="arima.html#cb193-5" tabindex="-1"></a><span class="im">from</span> statsforecast.arima <span class="im">import</span> arima_string</span>
<span id="cb193-6"><a href="arima.html#cb193-6" tabindex="-1"></a></span>
<span id="cb193-7"><a href="arima.html#cb193-7" tabindex="-1"></a></span>
<span id="cb193-8"><a href="arima.html#cb193-8" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: quotes.index, <span class="st">&#39;y&#39;</span>: quotes[<span class="st">&#39;Quotes&#39;</span>]}</span>
<span id="cb193-9"><a href="arima.html#cb193-9" tabindex="-1"></a>quotes_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb193-10"><a href="arima.html#cb193-10" tabindex="-1"></a>quotes_train <span class="op">=</span> quotes_sf.head(<span class="dv">36</span>)</span>
<span id="cb193-11"><a href="arima.html#cb193-11" tabindex="-1"></a>quotes_test <span class="op">=</span> quotes_sf.tail(<span class="dv">4</span>)</span>
<span id="cb193-12"><a href="arima.html#cb193-12" tabindex="-1"></a></span>
<span id="cb193-13"><a href="arima.html#cb193-13" tabindex="-1"></a></span>
<span id="cb193-14"><a href="arima.html#cb193-14" tabindex="-1"></a>plot_acf(quotes_train[<span class="st">&quot;y&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb193-15"><a href="arima.html#cb193-15" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-29-15.png" width="672" /></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="arima.html#cb194-1" tabindex="-1"></a>plot_pacf(quotes_train[<span class="st">&quot;y&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb194-2"><a href="arima.html#cb194-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-29-16.png" width="672" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb195-1"><a href="arima.html#cb195-1" tabindex="-1"></a><span class="co">## AR(1) model</span></span>
<span id="cb195-2"><a href="arima.html#cb195-2" tabindex="-1"></a></span>
<span id="cb195-3"><a href="arima.html#cb195-3" tabindex="-1"></a>model_Quotes <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), include_mean<span class="op">=</span><span class="va">True</span>)], freq <span class="op">=</span> <span class="st">&#39;ME&#39;</span>)</span>
<span id="cb195-4"><a href="arima.html#cb195-4" tabindex="-1"></a>model_Quotes.fit(df <span class="op">=</span> quotes_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb197-1"><a href="arima.html#cb197-1" tabindex="-1"></a>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 0, 0, 0, 1, 0, 0)</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb199-1"><a href="arima.html#cb199-1" tabindex="-1"></a>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.6712076661935175, &#39;intercept&#39;: 13.18990536452543}</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb201-1"><a href="arima.html#cb201-1" tabindex="-1"></a>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 143.5893107658691</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb203-1"><a href="arima.html#cb203-1" tabindex="-1"></a><span class="co">## MA(1) model</span></span>
<span id="cb203-2"><a href="arima.html#cb203-2" tabindex="-1"></a></span>
<span id="cb203-3"><a href="arima.html#cb203-3" tabindex="-1"></a>model_Quotes2 <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), include_mean<span class="op">=</span><span class="va">True</span>)], freq <span class="op">=</span> <span class="st">&#39;ME&#39;</span>)</span>
<span id="cb203-4"><a href="arima.html#cb203-4" tabindex="-1"></a>model_Quotes2.fit(df <span class="op">=</span> quotes_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="arima.html#cb205-1" tabindex="-1"></a>model_Quotes2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (0, 1, 0, 0, 1, 0, 0)</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb207-1"><a href="arima.html#cb207-1" tabindex="-1"></a>model_Quotes2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ma1&#39;: 0.7507681467542602, &#39;intercept&#39;: 13.236625919936786}</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="arima.html#cb209-1" tabindex="-1"></a>model_Quotes2.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 143.6147938154081</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb211-1"><a href="arima.html#cb211-1" tabindex="-1"></a><span class="co">###  Now the automatic search....choose the AR(1) model</span></span>
<span id="cb211-2"><a href="arima.html#cb211-2" tabindex="-1"></a></span>
<span id="cb211-3"><a href="arima.html#cb211-3" tabindex="-1"></a>model_Quotes <span class="op">=</span> StatsForecast(models <span class="op">=</span> [AutoARIMA(seasonal<span class="op">=</span><span class="va">False</span>)], freq <span class="op">=</span> <span class="st">&#39;ME&#39;</span>)</span>
<span id="cb211-4"><a href="arima.html#cb211-4" tabindex="-1"></a>model_Quotes.fit(df <span class="op">=</span> quotes_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[AutoARIMA])</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb213-1"><a href="arima.html#cb213-1" tabindex="-1"></a>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 0, 0, 0, 1, 0, 0)</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="arima.html#cb215-1" tabindex="-1"></a>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.9900652806700364}</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb217-1"><a href="arima.html#cb217-1" tabindex="-1"></a>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 151.64675255955572</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb219-1"><a href="arima.html#cb219-1" tabindex="-1"></a><span class="co">### Even though the automatic search choose AR(1), it did NOT include intercept.</span></span>
<span id="cb219-2"><a href="arima.html#cb219-2" tabindex="-1"></a><span class="co">### Made AR term close to 1 (very close to a random walk).</span></span>
<span id="cb219-3"><a href="arima.html#cb219-3" tabindex="-1"></a><span class="co">### Refitting the AR(1) model:</span></span>
<span id="cb219-4"><a href="arima.html#cb219-4" tabindex="-1"></a></span>
<span id="cb219-5"><a href="arima.html#cb219-5" tabindex="-1"></a>model_Quotes <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), include_mean<span class="op">=</span><span class="va">True</span>)], freq <span class="op">=</span> <span class="st">&#39;ME&#39;</span>)</span>
<span id="cb219-6"><a href="arima.html#cb219-6" tabindex="-1"></a>model_Quotes.fit(df <span class="op">=</span> quotes_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb221-1"><a href="arima.html#cb221-1" tabindex="-1"></a>resid<span class="op">=</span>model_Quotes.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;residuals&quot;</span>)</span>
<span id="cb221-2"><a href="arima.html#cb221-2" tabindex="-1"></a></span>
<span id="cb221-3"><a href="arima.html#cb221-3" tabindex="-1"></a>plot_acf(resid,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb221-4"><a href="arima.html#cb221-4" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-29-17.png" width="672" /></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="arima.html#cb222-1" tabindex="-1"></a>plot_pacf(resid,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb222-2"><a href="arima.html#cb222-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-29-18.png" width="672" /></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb223-1"><a href="arima.html#cb223-1" tabindex="-1"></a><span class="co"># Perform the Ljung-Box test</span></span>
<span id="cb223-2"><a href="arima.html#cb223-2" tabindex="-1"></a>lb_test <span class="op">=</span> diag.acorr_ljungbox(resid, lags<span class="op">=</span>[<span class="dv">10</span>], model_df<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb223-3"><a href="arima.html#cb223-3" tabindex="-1"></a><span class="bu">print</span>(lb_test)</span></code></pre></div>
<pre><code>##      lb_stat  lb_pvalue
## 10  7.200837   0.616218</code></pre>
<p>Now for using the hurricane data set:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb225-1"><a href="arima.html#cb225-1" tabindex="-1"></a><span class="co">###Note that hurr2 is being redefined here.</span></span>
<span id="cb225-2"><a href="arima.html#cb225-2" tabindex="-1"></a></span>
<span id="cb225-3"><a href="arima.html#cb225-3" tabindex="-1"></a></span>
<span id="cb225-4"><a href="arima.html#cb225-4" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;1851-01-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;2008-01-01&#39;</span>, freq<span class="op">=</span><span class="st">&#39;YE&#39;</span>)</span>
<span id="cb225-5"><a href="arima.html#cb225-5" tabindex="-1"></a>hurr.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb225-6"><a href="arima.html#cb225-6" tabindex="-1"></a>hurr2 <span class="op">=</span> hurr.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb225-7"><a href="arima.html#cb225-7" tabindex="-1"></a></span>
<span id="cb225-8"><a href="arima.html#cb225-8" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: hurr2.index, <span class="st">&#39;y&#39;</span>: hurr2[<span class="st">&#39;MeanVMax&#39;</span>]}</span>
<span id="cb225-9"><a href="arima.html#cb225-9" tabindex="-1"></a>hurr_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb225-10"><a href="arima.html#cb225-10" tabindex="-1"></a>hurr_train <span class="op">=</span> hurr_sf.head(<span class="dv">149</span>)</span>
<span id="cb225-11"><a href="arima.html#cb225-11" tabindex="-1"></a>hurr_test <span class="op">=</span> hurr_sf.tail(<span class="dv">9</span>)</span>
<span id="cb225-12"><a href="arima.html#cb225-12" tabindex="-1"></a></span>
<span id="cb225-13"><a href="arima.html#cb225-13" tabindex="-1"></a><span class="co">###Looks like we need to take differences:</span></span>
<span id="cb225-14"><a href="arima.html#cb225-14" tabindex="-1"></a>n_diffs<span class="op">=</span>ndiffs(hurr_train[<span class="st">&quot;y&quot;</span>])</span>
<span id="cb225-15"><a href="arima.html#cb225-15" tabindex="-1"></a><span class="bu">print</span>(n_diffs)</span></code></pre></div>
<pre><code>## 1</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb227-1"><a href="arima.html#cb227-1" tabindex="-1"></a>hurr2[<span class="st">&#39;MVM_diff&#39;</span>] <span class="op">=</span> hurr2[<span class="st">&#39;MeanVMax&#39;</span>].diff()</span></code></pre></div>
<pre><code>## &lt;string&gt;:2: SettingWithCopyWarning: 
## A value is trying to be set on a copy of a slice from a DataFrame.
## Try using .loc[row_indexer,col_indexer] = value instead
## 
## See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb229-1"><a href="arima.html#cb229-1" tabindex="-1"></a>hurr3 <span class="op">=</span> hurr2.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb229-2"><a href="arima.html#cb229-2" tabindex="-1"></a></span>
<span id="cb229-3"><a href="arima.html#cb229-3" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;1854-01-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;2008-01-01&#39;</span>, freq<span class="op">=</span><span class="st">&#39;YE&#39;</span>)</span>
<span id="cb229-4"><a href="arima.html#cb229-4" tabindex="-1"></a>hurr3.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb229-5"><a href="arima.html#cb229-5" tabindex="-1"></a></span>
<span id="cb229-6"><a href="arima.html#cb229-6" tabindex="-1"></a></span>
<span id="cb229-7"><a href="arima.html#cb229-7" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: hurr3.index, <span class="st">&#39;y&#39;</span>: hurr3[<span class="st">&#39;MVM_diff&#39;</span>]}</span>
<span id="cb229-8"><a href="arima.html#cb229-8" tabindex="-1"></a>hurr_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb229-9"><a href="arima.html#cb229-9" tabindex="-1"></a>hurr_train <span class="op">=</span> hurr_sf.head(<span class="dv">146</span>)</span>
<span id="cb229-10"><a href="arima.html#cb229-10" tabindex="-1"></a></span>
<span id="cb229-11"><a href="arima.html#cb229-11" tabindex="-1"></a></span>
<span id="cb229-12"><a href="arima.html#cb229-12" tabindex="-1"></a>plot_acf(hurr_train[<span class="st">&#39;y&#39;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb229-13"><a href="arima.html#cb229-13" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-23.png" width="672" /></p>
<div class="sourceCode" id="cb230"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb230-1"><a href="arima.html#cb230-1" tabindex="-1"></a>plot_pacf(hurr_train[<span class="st">&#39;y&#39;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb230-2"><a href="arima.html#cb230-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-24.png" width="672" /></p>
<div class="sourceCode" id="cb231"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb231-1"><a href="arima.html#cb231-1" tabindex="-1"></a><span class="co">### Now to fit models</span></span>
<span id="cb231-2"><a href="arima.html#cb231-2" tabindex="-1"></a></span>
<span id="cb231-3"><a href="arima.html#cb231-3" tabindex="-1"></a>model_hurr <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>))], freq <span class="op">=</span> <span class="st">&#39;YE&#39;</span>)</span>
<span id="cb231-4"><a href="arima.html#cb231-4" tabindex="-1"></a>model_hurr.fit(df <span class="op">=</span> hurr_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb233-1"><a href="arima.html#cb233-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (3, 0, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb235-1"><a href="arima.html#cb235-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: -1.2068037483176928, &#39;ar2&#39;: -0.9921577263556831, &#39;ar3&#39;: -0.45513268109216304}</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb237-1"><a href="arima.html#cb237-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 1170.708143945541</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb239-1"><a href="arima.html#cb239-1" tabindex="-1"></a>model_hurr <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>))], freq <span class="op">=</span> <span class="st">&#39;YE&#39;</span>)</span>
<span id="cb239-2"><a href="arima.html#cb239-2" tabindex="-1"></a>model_hurr.fit(df <span class="op">=</span> hurr_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb241-1"><a href="arima.html#cb241-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (0, 2, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb243-1"><a href="arima.html#cb243-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ma1&#39;: -1.7415599399956725, &#39;ma2&#39;: 0.7832219286880027}</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb245-1"><a href="arima.html#cb245-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 1106.8880414794749</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb247-1"><a href="arima.html#cb247-1" tabindex="-1"></a>model_hurr1 <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))], freq <span class="op">=</span> <span class="st">&#39;YE&#39;</span>)</span>
<span id="cb247-2"><a href="arima.html#cb247-2" tabindex="-1"></a>model_hurr1.fit(df <span class="op">=</span> hurr_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA])</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb249-1"><a href="arima.html#cb249-1" tabindex="-1"></a>model_hurr1.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (3, 2, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb251-1"><a href="arima.html#cb251-1" tabindex="-1"></a>model_hurr1.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: -0.023317373506325338, &#39;ar2&#39;: -0.10989837543299275, &#39;ar3&#39;: 0.08527147335598896, &#39;ma1&#39;: -1.8828868639758158, &#39;ma2&#39;: 0.8828868781268588}</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb253-1"><a href="arima.html#cb253-1" tabindex="-1"></a>model_hurr1.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 1095.8026951920508</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb255-1"><a href="arima.html#cb255-1" tabindex="-1"></a>model_hurr <span class="op">=</span> StatsForecast(models <span class="op">=</span> [AutoARIMA(seasonal<span class="op">=</span><span class="va">False</span>)], freq <span class="op">=</span> <span class="st">&#39;YE&#39;</span>)</span>
<span id="cb255-2"><a href="arima.html#cb255-2" tabindex="-1"></a>model_hurr.fit(df <span class="op">=</span> quotes_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[AutoARIMA])</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb257-1"><a href="arima.html#cb257-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 0, 0, 0, 1, 0, 0)</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb259-1"><a href="arima.html#cb259-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.9900652806700364}</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb261-1"><a href="arima.html#cb261-1" tabindex="-1"></a>model_hurr.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 151.64675255955572</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb263-1"><a href="arima.html#cb263-1" tabindex="-1"></a>resid<span class="op">=</span>model_hurr1.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;residuals&quot;</span>)</span>
<span id="cb263-2"><a href="arima.html#cb263-2" tabindex="-1"></a>plot_acf(resid,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb263-3"><a href="arima.html#cb263-3" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-25.png" width="672" /></p>
<div class="sourceCode" id="cb264"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb264-1"><a href="arima.html#cb264-1" tabindex="-1"></a>plot_pacf(resid,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb264-2"><a href="arima.html#cb264-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-30-26.png" width="672" /></p>
<div class="sourceCode" id="cb265"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb265-1"><a href="arima.html#cb265-1" tabindex="-1"></a>lb_test <span class="op">=</span> diag.acorr_ljungbox(resid, lags<span class="op">=</span>[<span class="dv">10</span>], model_df<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb265-2"><a href="arima.html#cb265-2" tabindex="-1"></a><span class="bu">print</span>(lb_test)</span></code></pre></div>
<pre><code>##      lb_stat  lb_pvalue
## 10  2.306516   0.805309</code></pre>
<p>Get some measures of accuracy on validation data:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb267-1"><a href="arima.html#cb267-1" tabindex="-1"></a><span class="co">##Hurricane data</span></span>
<span id="cb267-2"><a href="arima.html#cb267-2" tabindex="-1"></a></span>
<span id="cb267-3"><a href="arima.html#cb267-3" tabindex="-1"></a>y_hat1<span class="op">=</span>model_hurr1.predict(h<span class="op">=</span><span class="dv">8</span>)</span></code></pre></div>
<pre><code>## C:\PROGRA~3\ANACON~1\Lib\site-packages\statsforecast\core.py:492: FutureWarning: In a future version the predictions will have the id as a column. You can set the `NIXTLA_ID_AS_COL` environment variable to adopt the new behavior and to suppress this warning.
##   warnings.warn(</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb269-1"><a href="arima.html#cb269-1" tabindex="-1"></a>yhat<span class="op">=</span>y_hat1.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb269-2"><a href="arima.html#cb269-2" tabindex="-1"></a>test <span class="op">=</span> hurr_test.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb269-3"><a href="arima.html#cb269-3" tabindex="-1"></a>abs_error<span class="op">=</span> np.absolute(test[<span class="st">&#39;y&#39;</span>]<span class="op">-</span>yhat[<span class="st">&quot;ARIMA&quot;</span>])</span>
<span id="cb269-4"><a href="arima.html#cb269-4" tabindex="-1"></a>MAE <span class="op">=</span> np.mean(abs_error)</span>
<span id="cb269-5"><a href="arima.html#cb269-5" tabindex="-1"></a>MAE</span></code></pre></div>
<pre><code>## 100.95193510567769</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb271-1"><a href="arima.html#cb271-1" tabindex="-1"></a>MAPE <span class="op">=</span> np.mean(abs_error<span class="op">/</span>np.absolute(test[<span class="st">&#39;y&#39;</span>]))</span>
<span id="cb271-2"><a href="arima.html#cb271-2" tabindex="-1"></a>MAPE</span></code></pre></div>
<pre><code>## 1.0224984187047392</code></pre>
<p>An example with trend (fitting it with both differencing and linear regression)</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb273-1"><a href="arima.html#cb273-1" tabindex="-1"></a>consume <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/consume1982.csv&quot;</span>)</span>
<span id="cb273-2"><a href="arima.html#cb273-2" tabindex="-1"></a></span>
<span id="cb273-3"><a href="arima.html#cb273-3" tabindex="-1"></a></span>
<span id="cb273-4"><a href="arima.html#cb273-4" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;1982-09-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;1990-07-01&#39;</span>, freq<span class="op">=</span><span class="st">&#39;ME&#39;</span>)</span>
<span id="cb273-5"><a href="arima.html#cb273-5" tabindex="-1"></a>consume.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb273-6"><a href="arima.html#cb273-6" tabindex="-1"></a></span>
<span id="cb273-7"><a href="arima.html#cb273-7" tabindex="-1"></a>consume2 <span class="op">=</span>consume</span>
<span id="cb273-8"><a href="arima.html#cb273-8" tabindex="-1"></a></span>
<span id="cb273-9"><a href="arima.html#cb273-9" tabindex="-1"></a></span>
<span id="cb273-10"><a href="arima.html#cb273-10" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: consume.index, <span class="st">&#39;y&#39;</span>: consume[<span class="st">&#39;Disposable_income&#39;</span>]}</span>
<span id="cb273-11"><a href="arima.html#cb273-11" tabindex="-1"></a>consume_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb273-12"><a href="arima.html#cb273-12" tabindex="-1"></a>consume_train <span class="op">=</span> consume_sf.head(<span class="dv">88</span>)</span>
<span id="cb273-13"><a href="arima.html#cb273-13" tabindex="-1"></a>consume_test <span class="op">=</span> consume_sf.tail(<span class="dv">6</span>)</span>
<span id="cb273-14"><a href="arima.html#cb273-14" tabindex="-1"></a></span>
<span id="cb273-15"><a href="arima.html#cb273-15" tabindex="-1"></a>n_diffs<span class="op">=</span>ndiffs(consume_train[<span class="st">&quot;y&quot;</span>])</span>
<span id="cb273-16"><a href="arima.html#cb273-16" tabindex="-1"></a><span class="bu">print</span>(n_diffs)</span></code></pre></div>
<pre><code>## 1</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb275-1"><a href="arima.html#cb275-1" tabindex="-1"></a>consume2[<span class="st">&#39;income_diff&#39;</span>] <span class="op">=</span> consume[<span class="st">&#39;Disposable_income&#39;</span>].diff()</span>
<span id="cb275-2"><a href="arima.html#cb275-2" tabindex="-1"></a>consume3 <span class="op">=</span> consume2.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb275-3"><a href="arima.html#cb275-3" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: consume3.index, <span class="st">&#39;y&#39;</span>: consume3[<span class="st">&#39;income_diff&#39;</span>]}</span>
<span id="cb275-4"><a href="arima.html#cb275-4" tabindex="-1"></a>consume_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb275-5"><a href="arima.html#cb275-5" tabindex="-1"></a>consume_train_diff <span class="op">=</span> consume_sf.head(<span class="dv">87</span>)</span>
<span id="cb275-6"><a href="arima.html#cb275-6" tabindex="-1"></a>consume_test_diff <span class="op">=</span> consume_sf.tail(<span class="dv">6</span>)</span>
<span id="cb275-7"><a href="arima.html#cb275-7" tabindex="-1"></a></span>
<span id="cb275-8"><a href="arima.html#cb275-8" tabindex="-1"></a>plot_acf(consume_train_diff[<span class="st">&#39;y&#39;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb275-9"><a href="arima.html#cb275-9" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-31.png" width="672" /></p>
<div class="sourceCode" id="cb276"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb276-1"><a href="arima.html#cb276-1" tabindex="-1"></a>plot_pacf(consume_train_diff[<span class="st">&#39;y&#39;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb276-2"><a href="arima.html#cb276-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-32.png" width="672" /></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb277-1"><a href="arima.html#cb277-1" tabindex="-1"></a>model_consume <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), alias<span class="op">=</span><span class="st">&quot;AR1&quot;</span>,include_drift<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb277-2"><a href="arima.html#cb277-2" tabindex="-1"></a>                                       ARIMA(order<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), alias<span class="op">=</span><span class="st">&quot;MA1&quot;</span>,include_drift<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb277-3"><a href="arima.html#cb277-3" tabindex="-1"></a>                                       ARIMA(order<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>), alias<span class="op">=</span><span class="st">&quot;AR6&quot;</span>,include_drift<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb277-4"><a href="arima.html#cb277-4" tabindex="-1"></a>                                       ARIMA(order<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>), alias<span class="op">=</span><span class="st">&quot;MA6&quot;</span>,include_drift<span class="op">=</span><span class="va">True</span>)], freq <span class="op">=</span> <span class="st">&#39;ME&#39;</span>)</span>
<span id="cb277-5"><a href="arima.html#cb277-5" tabindex="-1"></a>model_consume.fit(df <span class="op">=</span> consume_train)</span></code></pre></div>
<pre><code>## StatsForecast(models=[AR1,MA1,AR6,MA6])</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb279-1"><a href="arima.html#cb279-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 0, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb281-1"><a href="arima.html#cb281-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: -0.25896653323215896, &#39;drift&#39;: 8.022216007742262}</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb283-1"><a href="arima.html#cb283-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 803.1326810471955</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb285-1"><a href="arima.html#cb285-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (0, 1, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb287-1"><a href="arima.html#cb287-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ma1&#39;: -0.41438549614590336, &#39;drift&#39;: 7.98102069783255}</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb289-1"><a href="arima.html#cb289-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 799.3233434797908</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb291-1"><a href="arima.html#cb291-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">2</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (6, 0, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb293-1"><a href="arima.html#cb293-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">2</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: -0.4010611534333105, &#39;ar2&#39;: -0.31654073048384407, &#39;ar3&#39;: -0.16283508176186343, &#39;ar4&#39;: -0.10615536897926213, &#39;ar5&#39;: -0.010770460986741892, &#39;ar6&#39;: -0.22726548440851652, &#39;drift&#39;: 7.746631279442317}</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb295-1"><a href="arima.html#cb295-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">2</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 801.9784353962</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb297-1"><a href="arima.html#cb297-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">3</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (0, 6, 0, 0, 1, 1, 0)</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb299-1"><a href="arima.html#cb299-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">3</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ma1&#39;: -0.3183332217571267, &#39;ma2&#39;: -0.2699449094170483, &#39;ma3&#39;: 0.0476940122969154, &#39;ma4&#39;: 0.022688981616510704, &#39;ma5&#39;: 0.12514985643356535, &#39;ma6&#39;: -0.3709280657798887, &#39;drift&#39;: 8.089051200580183}</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb301-1"><a href="arima.html#cb301-1" tabindex="-1"></a>model_consume.fitted_[<span class="dv">0</span>][<span class="dv">3</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 795.8092928178905</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb303-1"><a href="arima.html#cb303-1" tabindex="-1"></a><span class="co">### Now for looking at trend:</span></span>
<span id="cb303-2"><a href="arima.html#cb303-2" tabindex="-1"></a>consume <span class="op">=</span> pd.read_csv(<span class="st">&quot;https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/consume1982.csv&quot;</span>)</span>
<span id="cb303-3"><a href="arima.html#cb303-3" tabindex="-1"></a></span>
<span id="cb303-4"><a href="arima.html#cb303-4" tabindex="-1"></a></span>
<span id="cb303-5"><a href="arima.html#cb303-5" tabindex="-1"></a>df <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">&#39;1982-09-01&#39;</span>, end<span class="op">=</span><span class="st">&#39;1990-07-01&#39;</span>, freq<span class="op">=</span><span class="st">&#39;ME&#39;</span>)</span>
<span id="cb303-6"><a href="arima.html#cb303-6" tabindex="-1"></a>consume.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb303-7"><a href="arima.html#cb303-7" tabindex="-1"></a></span>
<span id="cb303-8"><a href="arima.html#cb303-8" tabindex="-1"></a><span class="co">#consume2 =consume</span></span>
<span id="cb303-9"><a href="arima.html#cb303-9" tabindex="-1"></a></span>
<span id="cb303-10"><a href="arima.html#cb303-10" tabindex="-1"></a></span>
<span id="cb303-11"><a href="arima.html#cb303-11" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: consume.index, <span class="st">&#39;y&#39;</span>: consume[<span class="st">&#39;Disposable_income&#39;</span>]}</span>
<span id="cb303-12"><a href="arima.html#cb303-12" tabindex="-1"></a>consume_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb303-13"><a href="arima.html#cb303-13" tabindex="-1"></a>consume_sf[<span class="st">&#39;x&#39;</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb303-14"><a href="arima.html#cb303-14" tabindex="-1"></a>consume_train <span class="op">=</span> consume_sf.head(<span class="dv">88</span>)</span>
<span id="cb303-15"><a href="arima.html#cb303-15" tabindex="-1"></a>consume_test <span class="op">=</span> consume_sf.tail(<span class="dv">6</span>)</span></code></pre></div>
</div>
<div id="sas-code-for-armaarima" class="section level2 hasAnchor" number="4.10">
<h2><span class="header-section-number">4.10</span> SAS Code for ARMA/ARIMA<a href="arima.html#sas-code-for-armaarima" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>AUGMENTED DICKEY-FULLER TESTING</em></p>
<p>proc arima data=Time.fpp_insurance plot=all;  
identify var=quotes nlag=10 stationarity=(adf=2);  
identify var=quotes(1) nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>CORRELATION FUNCTIONS</em><br />
</p>
<p><em>Notice no model statement!</em>  </p>
<p>proc arima data=Time.ar2 plot(unpack)=all;  
identify var=y nlag=10 outcov=Corr;  
estimate method=ML;  
run;
quit;</p>
<p><em>BUILDING AN AUTOREGRESSIVE MODEL</em></p>
<p><em>Fit an AR2 model</em>  </p>
<p>proc arima data=Time.AR2 plot=all;  
identify var=y nlag=10;  
estimate p=2 method=ML;  
run;
quit;  </p>
<p><em>Add another estimate statement</em>
proc arima data=Time.AR2 plot=all;
identify var=y nlag=10;
estimate p=(2) method=ML;
estimate p=(1,2,4) method=ML;
run;
quit;  </p>
<p><em>BUILDING A MOVING AVERAGE MODEL</em></p>
<p>proc arima data=Time.ma2;  
identify var=x;  
estimate q=2 method=ML;  
run;
quit;  </p>
<p><em>Need to check for how to take care of trend</em></p>
<p>proc arima data=Time.Ebay9899 plot=all;  
identify var=DailyHigh nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>It is a random walk!! The way to model a random walk is by using differences</em>  </p>
<p>proc arima data=Time.Ebay9899 plot=all;  
identify var=DailyHigh(1) nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>BUILDING AN AUTOREGRESSIVE MOVING AVERAGE MODEL</em>  
<em>(AUTOMATIC SELECTION TECHNIQUES)</em>  </p>
<p><em>Fit an ARIMA model</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 stationarity=(adf=2);  
run;
quit;  </p>
<p><em>Model identification with minimum information criterion (MINIC)</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 minic P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Model identification with smallest canonical correlation (SCAN);</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 scan P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Model identificaiton with extended sample autocorrelation function (ESACF)</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 esacf P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Create estimates with our ARIMA model p=2, q=3</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12;  
estimate p=2 q=3 method=ML;  
run;
quit;</p>
<p><em>FORECASTING</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=10 ;  
estimate p=2 q=3 method=ML;  
forecast lead=10;  
run;
quit;</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exponential-smoothing.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sjsimmo2/TimeSeries/edit/master/03-ARIMA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sjsimmo2/TimeSeries/blob/master/03-ARIMA.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
