<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 ARIMA | Time Series 1</title>
  <meta name="description" content="Chapter 4 ARIMA | Time Series 1" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 ARIMA | Time Series 1" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 ARIMA | Time Series 1" />
  
  
  

<meta name="author" content="by Dr. Susan Simmons" />


<meta name="date" content="2023-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exponential-smoothing.html"/>
<link rel="next" href="seasonality.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TimeSeries</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series 1</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#time-series-decomposition"><i class="fa fa-check"></i><b>2.1</b> Time series decomposition</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#python-code-and-results-for-time-series-plot"><i class="fa fa-check"></i><b>2.2</b> Python code and results for Time Series plot</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#sas-code-for-time-series-plot-and-decomposition"><i class="fa fa-check"></i><b>2.3</b> SAS code for time series plot and decomposition</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#self-study"><i class="fa fa-check"></i><b>2.4</b> Self-study</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>3</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.1</b> Simple Exponential Smoothing</a></li>
<li class="chapter" data-level="3.2" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-esm"><i class="fa fa-check"></i><b>3.2</b> Holt ESM</a></li>
<li class="chapter" data-level="3.3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-winters"><i class="fa fa-check"></i><b>3.3</b> Holt-Winters</a></li>
<li class="chapter" data-level="3.4" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#evaluating-forecasts"><i class="fa fa-check"></i><b>3.4</b> Evaluating forecasts</a></li>
<li class="chapter" data-level="3.5" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#ets"><i class="fa fa-check"></i><b>3.5</b> ETS</a></li>
<li class="chapter" data-level="3.6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#python-code-for-exponential-smoothing"><i class="fa fa-check"></i><b>3.6</b> Python Code for Exponential Smoothing</a></li>
<li class="chapter" data-level="3.7" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#sas-code-for-exponential-smoothing-models"><i class="fa fa-check"></i><b>3.7</b> SAS Code for Exponential Smoothing Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#correlation-functions"><i class="fa fa-check"></i><b>4.2</b> Correlation Functions</a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#autoregressive-models-ar"><i class="fa fa-check"></i><b>4.3</b> AutoRegressive Models (AR)</a></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#moving-average-model-ma"><i class="fa fa-check"></i><b>4.4</b> Moving Average model (MA)</a></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#white-noise"><i class="fa fa-check"></i><b>4.5</b> White noise</a></li>
<li class="chapter" data-level="4.6" data-path="arima.html"><a href="arima.html#trending-series"><i class="fa fa-check"></i><b>4.6</b> Trending Series</a></li>
<li class="chapter" data-level="4.7" data-path="arima.html"><a href="arima.html#fitting-arima-models"><i class="fa fa-check"></i><b>4.7</b> Fitting ARIMA models</a></li>
<li class="chapter" data-level="4.8" data-path="arima.html"><a href="arima.html#python-code-for-armaarima-models"><i class="fa fa-check"></i><b>4.8</b> Python Code for ARMA/ARIMA models</a></li>
<li class="chapter" data-level="4.9" data-path="arima.html"><a href="arima.html#sas-code-for-armaarima"><i class="fa fa-check"></i><b>4.9</b> SAS Code for ARMA/ARIMA</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seasonality.html"><a href="seasonality.html"><i class="fa fa-check"></i><b>5</b> Seasonality</a>
<ul>
<li class="chapter" data-level="5.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-unit-root-testing"><i class="fa fa-check"></i><b>5.1</b> Seasonal Unit Root Testing</a></li>
<li class="chapter" data-level="5.2" data-path="seasonality.html"><a href="seasonality.html#deterministic-solutions"><i class="fa fa-check"></i><b>5.2</b> Deterministic Solutions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-dummy-variables"><i class="fa fa-check"></i><b>5.2.1</b> Seasonal Dummy Variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="seasonality.html"><a href="seasonality.html#fourier-transforms"><i class="fa fa-check"></i><b>5.2.2</b> Fourier Transforms</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="seasonality.html"><a href="seasonality.html#stochastic-solutions"><i class="fa fa-check"></i><b>5.3</b> Stochastic Solutions</a></li>
<li class="chapter" data-level="5.4" data-path="seasonality.html"><a href="seasonality.html#seasonal-arima-modeling"><i class="fa fa-check"></i><b>5.4</b> Seasonal ARIMA Modeling</a></li>
<li class="chapter" data-level="5.5" data-path="seasonality.html"><a href="seasonality.html#python-code-for-seasonality"><i class="fa fa-check"></i><b>5.5</b> Python Code for Seasonality</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="seasonality.html"><a href="seasonality.html#seasonality-1"><i class="fa fa-check"></i><b>5.5.1</b> Seasonality</a></li>
<li class="chapter" data-level="5.5.2" data-path="seasonality.html"><a href="seasonality.html#deterministic-solutions-1"><i class="fa fa-check"></i><b>5.5.2</b> Deterministic Solutions</a></li>
<li class="chapter" data-level="5.5.3" data-path="seasonality.html"><a href="seasonality.html#stochastic-solution"><i class="fa fa-check"></i><b>5.5.3</b> Stochastic Solution</a></li>
<li class="chapter" data-level="5.5.4" data-path="seasonality.html"><a href="seasonality.html#seasonal-arima"><i class="fa fa-check"></i><b>5.5.4</b> Seasonal ARIMA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html"><i class="fa fa-check"></i><b>6</b> Dynamic Regression Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#intervention-variables"><i class="fa fa-check"></i><b>6.1</b> Intervention Variables</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#predictor-variables"><i class="fa fa-check"></i><b>6.2</b> Predictor Variables</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#python-code-for-dynamic-regression-models"><i class="fa fa-check"></i><b>6.3</b> Python Code for Dynamic Regression Models</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#intervention-variables-1"><i class="fa fa-check"></i><b>6.3.1</b> Intervention Variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#predictor-variables-1"><i class="fa fa-check"></i><b>6.3.2</b> Predictor Variables</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="arima" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> ARIMA<a href="arima.html#arima" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We will now be switching over to doing ARMA/ARIMA models!! There are a number of different concepts you will need in order to do this type of modeling.</p>
<div id="stationarity" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Stationarity<a href="arima.html#stationarity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we can try to model the dependency structure (the AR and MA terms), we must first have a stationarity! The ADF test is one of the most well-known and accepted test for testing stationarity. There are several packages that will do this for you, however, below, I am focusing on the ADF test within the package aTSA.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="arima.html#cb94-1" tabindex="-1"></a>Quotes.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(Quotes<span class="sc">$</span>Quotes,<span class="at">start=</span><span class="dv">2002</span>,<span class="at">frequency=</span><span class="dv">12</span>)</span>
<span id="cb94-2"><a href="arima.html#cb94-2" tabindex="-1"></a><span class="fu">autoplot</span>(Quotes.ts)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Daily Stock quotes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Quotes&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/plot-1.png" width="672" /></p>
<p>The following code produces output similar to the output seen in SAS (under the tau test).</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="arima.html#cb95-1" tabindex="-1"></a><span class="co"># Perform the ADF test (k=0)</span></span>
<span id="cb95-2"><a href="arima.html#cb95-2" tabindex="-1"></a>aTSA<span class="sc">::</span><span class="fu">adf.test</span>(Quotes.ts)</span></code></pre></div>
<pre><code>## Augmented Dickey-Fuller Test 
## alternative: stationary 
##  
## Type 1: no drift no trend 
##      lag     ADF p.value
## [1,]   0 -0.3061   0.550
## [2,]   1 -0.5980   0.458
## [3,]   2 -0.0632   0.620
## [4,]   3 -0.0950   0.611
## Type 2: with drift no trend 
##      lag   ADF p.value
## [1,]   0 -2.66  0.0939
## [2,]   1 -3.42  0.0192
## [3,]   2 -2.45  0.1608
## [4,]   3 -2.36  0.1943
## Type 3: with drift and trend 
##      lag   ADF p.value
## [1,]   0 -2.62  0.3212
## [2,]   1 -3.36  0.0772
## [3,]   2 -2.41  0.4012
## [4,]   3 -2.29  0.4463
## ---- 
## Note: in fact, p.value = 0.01 means p.value &lt;= 0.01</code></pre>
</div>
<div id="correlation-functions" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Correlation Functions<a href="arima.html#correlation-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Acf and the Pacf in R will calculate the autocorrelation (up to the lag you specify) and the partial autocorrelation, respectively. You can either output these values to look at them or plot them (see code below).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="arima.html#cb97-1" tabindex="-1"></a>acf1<span class="ot">=</span><span class="fu">Acf</span>(Y, <span class="at">lag=</span><span class="dv">10</span>)<span class="sc">$</span>acf</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-1.png" width="672" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="arima.html#cb98-1" tabindex="-1"></a>pacf1<span class="ot">=</span><span class="fu">Pacf</span>(Y, <span class="at">lag=</span><span class="dv">10</span>)<span class="sc">$</span>acf</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-2.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="arima.html#cb99-1" tabindex="-1"></a>index1<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(pacf1))</span>
<span id="cb99-2"><a href="arima.html#cb99-2" tabindex="-1"></a></span>
<span id="cb99-3"><a href="arima.html#cb99-3" tabindex="-1"></a>all.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(acf1[<span class="dv">2</span><span class="sc">:</span><span class="dv">11</span>],pacf1,index1))</span>
<span id="cb99-4"><a href="arima.html#cb99-4" tabindex="-1"></a><span class="fu">colnames</span>(all.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;acf&quot;</span>,<span class="st">&quot;pacf&quot;</span>,<span class="st">&quot;index&quot;</span>)</span>
<span id="cb99-5"><a href="arima.html#cb99-5" tabindex="-1"></a></span>
<span id="cb99-6"><a href="arima.html#cb99-6" tabindex="-1"></a><span class="fu">ggplot</span>(all.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(index),<span class="at">y=</span>acf))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-3.png" width="672" /></p>
</div>
<div id="autoregressive-models-ar" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> AutoRegressive Models (AR)<a href="arima.html#autoregressive-models-ar" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>AutoRegressive (AR) models involve modeling the lags of Y. We can write an autoregressive model as</p>
<p><span class="math display">\[ Y_{t} = c + \phi_{1}Y_{t-1}+\phi_{2}Y_{t-2}+...\phi_{p}Y_{t-p}+\epsilon_{t} \]</span>
Where there are <em>p</em> lags of <em>Y</em>. Below is the code to fit an AR(2) model. The <em>order</em> in the <em>Arima</em> function needs the p,d,q values (p=# of AR terms, d=how many differences should be taken and q=# of MA terms).</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="arima.html#cb100-1" tabindex="-1"></a><span class="fu">ggAcf</span>(Y)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-1.png" width="672" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="arima.html#cb101-1" tabindex="-1"></a><span class="fu">ggPacf</span>(Y)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-2.png" width="672" /></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="arima.html#cb102-1" tabindex="-1"></a>Y.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Y)</span>
<span id="cb102-2"><a href="arima.html#cb102-2" tabindex="-1"></a>Y.ARIMA <span class="ot">&lt;-</span> <span class="fu">Arima</span>(Y.ts, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb102-3"><a href="arima.html#cb102-3" tabindex="-1"></a></span>
<span id="cb102-4"><a href="arima.html#cb102-4" tabindex="-1"></a><span class="fu">ggAcf</span>(Y.ARIMA<span class="sc">$</span>residuals)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-3.png" width="672" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="arima.html#cb103-1" tabindex="-1"></a><span class="fu">ggPacf</span>(Y.ARIMA<span class="sc">$</span>residuals)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-4.png" width="672" /></p>
</div>
<div id="moving-average-model-ma" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Moving Average model (MA)<a href="arima.html#moving-average-model-ma" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Moving average (MA) models involve modeling the lags of the error. We can write a moving average model as</p>
<p><span class="math display">\[ Y_{t} = c - \theta_{1}\epsilon_{t-1}-\theta_{2}\epsilon_{t-2}-...\theta_{q}\epsilon_{t-q}+\epsilon_{t} \]</span>
Where there are <em>q</em> lags of <span class="math inline">\(\epsilon\)</span>. Below is code to fit an MA(2) model.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="arima.html#cb104-1" tabindex="-1"></a><span class="fu">ggAcf</span>(x)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-1.png" width="672" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="arima.html#cb105-1" tabindex="-1"></a><span class="fu">ggPacf</span>(x)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-2.png" width="672" /></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="arima.html#cb106-1" tabindex="-1"></a>x.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(x)</span>
<span id="cb106-2"><a href="arima.html#cb106-2" tabindex="-1"></a>x.ARIMA <span class="ot">&lt;-</span> <span class="fu">Arima</span>(x.ts, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>))</span>
<span id="cb106-3"><a href="arima.html#cb106-3" tabindex="-1"></a><span class="fu">summary</span>(x.ARIMA)</span></code></pre></div>
<pre><code>## Series: x.ts 
## ARIMA(0,0,2) with non-zero mean 
## 
## Coefficients:
##           ma1     ma2    mean
##       -0.2460  0.4772  0.0250
## s.e.   0.0857  0.0923  0.0567
## 
## sigma^2 = 0.2207:  log likelihood = -65.1
## AIC=138.2   AICc=138.63   BIC=148.62
## 
## Training set error measures:
##                        ME      RMSE       MAE      MPE
## Training set 0.0008828966 0.4627151 0.3808289 74.99115
##                  MAPE      MASE         ACF1
## Training set 114.4434 0.5453401 -0.002299708</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="arima.html#cb108-1" tabindex="-1"></a><span class="fu">ggAcf</span>(x.ARIMA<span class="sc">$</span>residuals)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-3.png" width="672" /></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="arima.html#cb109-1" tabindex="-1"></a><span class="fu">ggPacf</span>(x.ARIMA<span class="sc">$</span>residuals)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-4.png" width="672" /></p>
</div>
<div id="white-noise" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> White noise<a href="arima.html#white-noise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For residuals to exhibit white noise, they must be “independent” and normally distributed with mean 0 and constant variance. You already know how to assess normality and constant variance, however, we need to focus on assessing “independence”. We can assess if there is significant dependence through the Ljung-Box test. The hypotheses being tested are</p>
<p><span class="math display">\[H_{0}:No\quad significant\quad autocorrelation\\
H_{A}:Significant\qquad autocorrletion \]</span></p>
<p>This should be assessed on a stationary time series. Looking at a stationary time series, going back 10 lags should be sufficient (this will be different when we get to seasonal models). We would like for all of the p-values (for lags 1-10) to be insignificant (large p-values). However, keep in mind that sample size will matter when assessing significance.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="arima.html#cb110-1" tabindex="-1"></a>White.LB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb110-2"><a href="arima.html#cb110-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb110-3"><a href="arima.html#cb110-3" tabindex="-1"></a>  White.LB[i] <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(Y, <span class="at">lag=</span>i, <span class="at">type=</span><span class="st">&quot;Ljung-Box&quot;</span>, <span class="at">fitdf =</span> <span class="dv">0</span>)<span class="sc">$</span>p.value</span>
<span id="cb110-4"><a href="arima.html#cb110-4" tabindex="-1"></a>}</span>
<span id="cb110-5"><a href="arima.html#cb110-5" tabindex="-1"></a></span>
<span id="cb110-6"><a href="arima.html#cb110-6" tabindex="-1"></a>white.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(White.LB,index1))</span>
<span id="cb110-7"><a href="arima.html#cb110-7" tabindex="-1"></a><span class="fu">colnames</span>(white.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;pvalues&quot;</span>,<span class="st">&quot;Lag&quot;</span>)</span>
<span id="cb110-8"><a href="arima.html#cb110-8" tabindex="-1"></a></span>
<span id="cb110-9"><a href="arima.html#cb110-9" tabindex="-1"></a><span class="fu">ggplot</span>(white.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(Lag),<span class="at">y=</span>pvalues))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Ljung-Box test p-values&quot;</span>,<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>,<span class="at">y=</span><span class="st">&quot;p-values&quot;</span>)<span class="sc">+</span><span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.025</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Ljung-Box%20test-1.png" width="672" /></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="arima.html#cb111-1" tabindex="-1"></a><span class="do">####Fit appropriate model</span></span>
<span id="cb111-2"><a href="arima.html#cb111-2" tabindex="-1"></a>Y.ARIMA<span class="ot">=</span><span class="fu">Arima</span>(Y,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb111-3"><a href="arima.html#cb111-3" tabindex="-1"></a>White.LB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb111-4"><a href="arima.html#cb111-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb111-5"><a href="arima.html#cb111-5" tabindex="-1"></a>  White.LB[i] <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(Y.ARIMA<span class="sc">$</span>residuals, <span class="at">lag=</span>i, <span class="at">type=</span><span class="st">&quot;Ljung-Box&quot;</span>, <span class="at">fitdf =</span> <span class="dv">2</span>)<span class="sc">$</span>p.value</span>
<span id="cb111-6"><a href="arima.html#cb111-6" tabindex="-1"></a>}</span>
<span id="cb111-7"><a href="arima.html#cb111-7" tabindex="-1"></a></span>
<span id="cb111-8"><a href="arima.html#cb111-8" tabindex="-1"></a>white.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(White.LB[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>],index1[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>]))</span>
<span id="cb111-9"><a href="arima.html#cb111-9" tabindex="-1"></a><span class="fu">colnames</span>(white.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;pvalues&quot;</span>,<span class="st">&quot;Lag&quot;</span>) </span>
<span id="cb111-10"><a href="arima.html#cb111-10" tabindex="-1"></a></span>
<span id="cb111-11"><a href="arima.html#cb111-11" tabindex="-1"></a></span>
<span id="cb111-12"><a href="arima.html#cb111-12" tabindex="-1"></a><span class="fu">ggplot</span>(white.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(Lag),<span class="at">y=</span>pvalues))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Ljung-Box test when there is white noise&quot;</span>,<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>,<span class="at">y=</span><span class="st">&quot;p-values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Ljung-Box%20test-2.png" width="672" /></p>
</div>
<div id="trending-series" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Trending Series<a href="arima.html#trending-series" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If the series is trending then it is NOT stationary. You will NEED to do something to the series in order to make it stationary!! You will either fit a linear regression line (then use the residuals to model dependencies) or take differences and use the differenced series to model dependencies. We will be using the Ebay stock data of “Daily High” (however, this data has missing values!!). If you do not impute missing values, it simply ignores the missing values (could create an issue). I would recommend FIRST imputing those values BEFORE doing the ADF test (in the na_interpolation algorithm, missing values are imputed).</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="arima.html#cb112-1" tabindex="-1"></a>Daily.High <span class="ot">&lt;-</span> <span class="fu">ts</span>(Ebay<span class="sc">$</span>DailyHigh)</span>
<span id="cb112-2"><a href="arima.html#cb112-2" tabindex="-1"></a><span class="do">###NOT appropriate since there are missing values!!</span></span>
<span id="cb112-3"><a href="arima.html#cb112-3" tabindex="-1"></a>aTSA<span class="sc">::</span><span class="fu">adf.test</span>(Daily.High)</span></code></pre></div>
<pre><code>## Augmented Dickey-Fuller Test 
## alternative: stationary 
##  
## Type 1: no drift no trend 
##      lag   ADF p.value
## [1,]   0 0.410   0.762
## [2,]   1 0.157   0.689
## [3,]   2 0.254   0.717
## [4,]   3 0.327   0.738
## [5,]   4 0.396   0.758
## [6,]   5 0.431   0.768
## Type 2: with drift no trend 
##      lag   ADF p.value
## [1,]   0 -1.79   0.409
## [2,]   1 -1.99   0.331
## [3,]   2 -1.90   0.366
## [4,]   3 -1.89   0.372
## [5,]   4 -1.88   0.375
## [6,]   5 -1.91   0.365
## Type 3: with drift and trend 
##      lag   ADF p.value
## [1,]   0 -1.74   0.687
## [2,]   1 -2.09   0.538
## [3,]   2 -1.94   0.600
## [4,]   3 -1.87   0.632
## [5,]   4 -1.81   0.657
## [6,]   5 -1.80   0.662
## ---- 
## Note: in fact, p.value = 0.01 means p.value &lt;= 0.01</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="arima.html#cb114-1" tabindex="-1"></a><span class="fu">ggplot_na_distribution</span>(Daily.High)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Stock prices for Ebay&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/adf%20test%20with%20missing%20values-1.png" width="672" /></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="arima.html#cb115-1" tabindex="-1"></a><span class="co"># Interpolate the missing observations in this data set</span></span>
<span id="cb115-2"><a href="arima.html#cb115-2" tabindex="-1"></a>Daily.High<span class="ot">&lt;-</span>Daily.High <span class="sc">%&gt;%</span> <span class="fu">na_interpolation</span>(<span class="at">option =</span> <span class="st">&quot;spline&quot;</span>)</span>
<span id="cb115-3"><a href="arima.html#cb115-3" tabindex="-1"></a></span>
<span id="cb115-4"><a href="arima.html#cb115-4" tabindex="-1"></a><span class="fu">autoplot</span>(Daily.High)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Daily high stock quotes&quot;</span>,<span class="at">x=</span><span class="st">&quot;Time&quot;</span>,<span class="at">y=</span><span class="st">&quot;Quotes&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/adf%20test%20with%20missing%20values-2.png" width="672" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="arima.html#cb116-1" tabindex="-1"></a><span class="co"># Perform an ADF test</span></span>
<span id="cb116-2"><a href="arima.html#cb116-2" tabindex="-1"></a>aTSA<span class="sc">::</span><span class="fu">adf.test</span>(Daily.High)</span></code></pre></div>
<pre><code>## Augmented Dickey-Fuller Test 
## alternative: stationary 
##  
## Type 1: no drift no trend 
##      lag   ADF p.value
## [1,]   0 0.414   0.763
## [2,]   1 0.148   0.687
## [3,]   2 0.266   0.720
## [4,]   3 0.330   0.739
## [5,]   4 0.385   0.755
## [6,]   5 0.434   0.769
## Type 2: with drift no trend 
##      lag   ADF p.value
## [1,]   0 -1.80   0.405
## [2,]   1 -2.01   0.324
## [3,]   2 -1.91   0.364
## [4,]   3 -1.90   0.367
## [5,]   4 -1.90   0.368
## [6,]   5 -1.92   0.361
## Type 3: with drift and trend 
##      lag   ADF p.value
## [1,]   0 -1.76   0.679
## [2,]   1 -2.13   0.520
## [3,]   2 -1.96   0.595
## [4,]   3 -1.89   0.622
## [5,]   4 -1.84   0.642
## [6,]   5 -1.82   0.653
## ---- 
## Note: in fact, p.value = 0.01 means p.value &lt;= 0.01</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="arima.html#cb118-1" tabindex="-1"></a><span class="do">### Definitely a Random Walk!!</span></span></code></pre></div>
<p>How do we fit each situation? If the series is stationary about the line, we need to fit a line (and then model the AR and MA terms on the residuals). If series is a random walk with drift, then need to take differences. Here is the R code for each situation.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="arima.html#cb119-1" tabindex="-1"></a><span class="do">###Fitting a regression line...</span></span>
<span id="cb119-2"><a href="arima.html#cb119-2" tabindex="-1"></a>time.high<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(Daily.High))</span>
<span id="cb119-3"><a href="arima.html#cb119-3" tabindex="-1"></a>resid.y <span class="ot">=</span><span class="fu">lm</span>(Daily.High <span class="sc">~</span> time.high)<span class="sc">$</span>resid</span>
<span id="cb119-4"><a href="arima.html#cb119-4" tabindex="-1"></a><span class="co">#Now use resid.y to explore what p and q to fit</span></span>
<span id="cb119-5"><a href="arima.html#cb119-5" tabindex="-1"></a><span class="fu">ggAcf</span>(resid.y)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ARIMA%20with%20trend-1.png" width="672" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="arima.html#cb120-1" tabindex="-1"></a><span class="fu">ggPacf</span>(resid.y)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ARIMA%20with%20trend-2.png" width="672" /></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="arima.html#cb121-1" tabindex="-1"></a><span class="do">### You can CLEARLY see this is a random walk...can&#39;t really fit p,q</span></span>
<span id="cb121-2"><a href="arima.html#cb121-2" tabindex="-1"></a></span>
<span id="cb121-3"><a href="arima.html#cb121-3" tabindex="-1"></a><span class="do">## DO NOT RUN!!</span></span>
<span id="cb121-4"><a href="arima.html#cb121-4" tabindex="-1"></a><span class="co">#ARIMA.line=Arima(Daily.High,order=c(p,0,q),xreg=time.high)</span></span>
<span id="cb121-5"><a href="arima.html#cb121-5" tabindex="-1"></a></span>
<span id="cb121-6"><a href="arima.html#cb121-6" tabindex="-1"></a></span>
<span id="cb121-7"><a href="arima.html#cb121-7" tabindex="-1"></a></span>
<span id="cb121-8"><a href="arima.html#cb121-8" tabindex="-1"></a><span class="do">####Fitting a random walk with drift</span></span>
<span id="cb121-9"><a href="arima.html#cb121-9" tabindex="-1"></a>diff.y<span class="ot">=</span><span class="fu">diff</span>(Daily.High)</span>
<span id="cb121-10"><a href="arima.html#cb121-10" tabindex="-1"></a><span class="fu">ggAcf</span>(diff.y) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ARIMA%20with%20trend-3.png" width="672" /></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="arima.html#cb122-1" tabindex="-1"></a><span class="fu">ggPacf</span>(diff.y)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ARIMA%20with%20trend-4.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="arima.html#cb123-1" tabindex="-1"></a>ARIMA.RW<span class="ot">=</span><span class="fu">Arima</span>(Daily.High,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb123-2"><a href="arima.html#cb123-2" tabindex="-1"></a><span class="fu">summary</span>(ARIMA.RW)</span></code></pre></div>
<pre><code>## Series: Daily.High 
## ARIMA(1,1,0) 
## 
## Coefficients:
##          ar1
##       0.2059
## s.e.  0.0549
## 
## sigma^2 = 45.87:  log likelihood = -1055.72
## AIC=2115.44   AICc=2115.48   BIC=2122.95
## 
## Training set error measures:
##                     ME     RMSE      MAE       MPE     MAPE
## Training set 0.3815611 6.751471 4.749967 0.4017785 4.444782
##                   MASE       ACF1
## Training set 0.9673213 0.01647521</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="arima.html#cb125-1" tabindex="-1"></a><span class="do">####  automatic procedure will determine if you need differencing or not!</span></span></code></pre></div>
</div>
<div id="fitting-arima-models" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Fitting ARIMA models<a href="arima.html#fitting-arima-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can use an automatic procedure to help us find a model. For this illustration, we will be using the mean of the maximum velocity in the hurricane data set. This data also has some missing values which we need to look into first.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="arima.html#cb126-1" tabindex="-1"></a>max.velocity<span class="ot">=</span>hurricane<span class="sc">$</span>MeanVMax</span>
<span id="cb126-2"><a href="arima.html#cb126-2" tabindex="-1"></a></span>
<span id="cb126-3"><a href="arima.html#cb126-3" tabindex="-1"></a><span class="fu">ggplot_na_distribution</span>(max.velocity)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Mean Max Velocity&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/visualize%20missing%20values-1.png" width="672" /></p>
<p>This is yearly data and the reason those values are missing is because there were no hurricanes recorded for that year. Since there is no trend (nor seasonality), I am going to remove these NA values and then run the Dickey-Fuller test.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="arima.html#cb127-1" tabindex="-1"></a>max.velocity<span class="ot">=</span><span class="fu">na.omit</span>(max.velocity)</span>
<span id="cb127-2"><a href="arima.html#cb127-2" tabindex="-1"></a>hurrican.ts<span class="ot">=</span><span class="fu">ts</span>(max.velocity)</span>
<span id="cb127-3"><a href="arima.html#cb127-3" tabindex="-1"></a>aTSA<span class="sc">::</span><span class="fu">adf.test</span>(hurrican.ts)</span></code></pre></div>
<pre><code>## Augmented Dickey-Fuller Test 
## alternative: stationary 
##  
## Type 1: no drift no trend 
##      lag     ADF p.value
## [1,]   0 -0.8242   0.384
## [2,]   1 -0.4391   0.517
## [3,]   2 -0.2585   0.569
## [4,]   3 -0.1254   0.607
## [5,]   4 -0.0692   0.623
## Type 2: with drift no trend 
##      lag    ADF p.value
## [1,]   0 -10.69    0.01
## [2,]   1  -7.69    0.01
## [3,]   2  -5.09    0.01
## [4,]   3  -4.09    0.01
## [5,]   4  -3.62    0.01
## Type 3: with drift and trend 
##      lag    ADF p.value
## [1,]   0 -11.37    0.01
## [2,]   1  -8.37    0.01
## [3,]   2  -5.70    0.01
## [4,]   3  -4.67    0.01
## [5,]   4  -4.23    0.01
## ---- 
## Note: in fact, p.value = 0.01 means p.value &lt;= 0.01</code></pre>
<p>Series is stationary!! Let’s see if there is any significant dependecies here…</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="arima.html#cb129-1" tabindex="-1"></a>index1<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb129-2"><a href="arima.html#cb129-2" tabindex="-1"></a>White.LB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb129-3"><a href="arima.html#cb129-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb129-4"><a href="arima.html#cb129-4" tabindex="-1"></a>  White.LB[i] <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(hurrican.ts, <span class="at">lag=</span>i, <span class="at">type=</span><span class="st">&quot;Ljung-Box&quot;</span>, <span class="at">fitdf =</span> <span class="dv">0</span>)<span class="sc">$</span>p.value</span>
<span id="cb129-5"><a href="arima.html#cb129-5" tabindex="-1"></a>}</span>
<span id="cb129-6"><a href="arima.html#cb129-6" tabindex="-1"></a></span>
<span id="cb129-7"><a href="arima.html#cb129-7" tabindex="-1"></a>white.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(White.LB[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],index1[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]))</span>
<span id="cb129-8"><a href="arima.html#cb129-8" tabindex="-1"></a><span class="fu">colnames</span>(white.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;pvalues&quot;</span>,<span class="st">&quot;Lag&quot;</span>) </span>
<span id="cb129-9"><a href="arima.html#cb129-9" tabindex="-1"></a></span>
<span id="cb129-10"><a href="arima.html#cb129-10" tabindex="-1"></a></span>
<span id="cb129-11"><a href="arima.html#cb129-11" tabindex="-1"></a><span class="fu">ggplot</span>(white.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(Lag),<span class="at">y=</span>pvalues))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Hurricane data&quot;</span>,<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>,<span class="at">y=</span><span class="st">&quot;p-values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Ljung-Box%20for%20Hurricane%20data-1.png" width="672" /></p>
<p>There is definitely something to be modeled here!! Let’s try an automated search first…</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="arima.html#cb130-1" tabindex="-1"></a>model1<span class="ot">=</span><span class="fu">auto.arima</span>(hurrican.ts)</span>
<span id="cb130-2"><a href="arima.html#cb130-2" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">auto.arima</span>(hurrican.ts,<span class="at">d=</span><span class="dv">0</span>)</span></code></pre></div>
<p>Let’s take a look at ACF and PACF plots and see how well we do manually..</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="arima.html#cb131-1" tabindex="-1"></a><span class="fu">ggAcf</span>(hurrican.ts)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Correlation%20plots%20hurricane%20data-1.png" width="672" /></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="arima.html#cb132-1" tabindex="-1"></a><span class="fu">ggPacf</span>(hurrican.ts)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Correlation%20plots%20hurricane%20data-2.png" width="672" /></p>
<p>Using the graphs and some trial and error, here was the model I chose…</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="arima.html#cb133-1" tabindex="-1"></a>model3<span class="ot">=</span><span class="fu">Arima</span>(hurrican.ts,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">3</span>))</span>
<span id="cb133-2"><a href="arima.html#cb133-2" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code></pre></div>
<pre><code>## Series: hurrican.ts 
## ARIMA(2,0,3) with non-zero mean 
## 
## Coefficients:
##          ar1     ar2      ma1      ma2     ma3     mean
##       0.7921  0.1100  -0.7257  -0.1803  0.1578  91.4046
## s.e.  0.4161  0.3958   0.4094   0.3583  0.0791   1.8812
## 
## sigma^2 = 94.76:  log likelihood = -569.79
## AIC=1153.58   AICc=1154.34   BIC=1174.88
## 
## Training set error measures:
##                      ME     RMSE      MAE       MPE    MAPE
## Training set 0.07215997 9.544078 7.471114 -1.024043 8.28476
##                   MASE          ACF1
## Training set 0.7050813 -0.0003383851</code></pre>
<p>Comparing the ACF and PACF plots for these models:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="arima.html#cb135-1" tabindex="-1"></a><span class="fu">ggAcf</span>(model1<span class="sc">$</span>residuals,<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/comparing%20ACF%20and%20PACF-1.png" width="672" /></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="arima.html#cb136-1" tabindex="-1"></a><span class="fu">ggPacf</span>(model1<span class="sc">$</span>residuals,<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/comparing%20ACF%20and%20PACF-2.png" width="672" /></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="arima.html#cb137-1" tabindex="-1"></a><span class="fu">ggAcf</span>(model2<span class="sc">$</span>residuals,<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/comparing%20ACF%20and%20PACF-3.png" width="672" /></p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="arima.html#cb138-1" tabindex="-1"></a><span class="fu">ggPacf</span>(model2<span class="sc">$</span>residuals,<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/comparing%20ACF%20and%20PACF-4.png" width="672" /></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="arima.html#cb139-1" tabindex="-1"></a><span class="fu">ggAcf</span>(model3<span class="sc">$</span>residuals,<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/comparing%20ACF%20and%20PACF-5.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="arima.html#cb140-1" tabindex="-1"></a><span class="fu">ggPacf</span>(model3<span class="sc">$</span>residuals,<span class="at">lag.max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/comparing%20ACF%20and%20PACF-6.png" width="672" /></p>
<p>Let’s take a look at white noise for each model:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="arima.html#cb141-1" tabindex="-1"></a>index1<span class="ot">=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb141-2"><a href="arima.html#cb141-2" tabindex="-1"></a>White.LB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb141-3"><a href="arima.html#cb141-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb141-4"><a href="arima.html#cb141-4" tabindex="-1"></a>  White.LB[i] <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(model1<span class="sc">$</span>residuals, <span class="at">lag=</span>i, <span class="at">type=</span><span class="st">&quot;Ljung-Box&quot;</span>, <span class="at">fitdf =</span> <span class="dv">1</span>)<span class="sc">$</span>p.value</span>
<span id="cb141-5"><a href="arima.html#cb141-5" tabindex="-1"></a>}</span>
<span id="cb141-6"><a href="arima.html#cb141-6" tabindex="-1"></a></span>
<span id="cb141-7"><a href="arima.html#cb141-7" tabindex="-1"></a>white.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(White.LB[<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>],index1[<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>]))</span>
<span id="cb141-8"><a href="arima.html#cb141-8" tabindex="-1"></a><span class="fu">colnames</span>(white.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;pvalues&quot;</span>,<span class="st">&quot;Lag&quot;</span>) </span>
<span id="cb141-9"><a href="arima.html#cb141-9" tabindex="-1"></a></span>
<span id="cb141-10"><a href="arima.html#cb141-10" tabindex="-1"></a></span>
<span id="cb141-11"><a href="arima.html#cb141-11" tabindex="-1"></a><span class="fu">ggplot</span>(white.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(Lag),<span class="at">y=</span>pvalues))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Model 1&quot;</span>,<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>,<span class="at">y=</span><span class="st">&quot;p-values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/white%20noise-1.png" width="672" /></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="arima.html#cb142-1" tabindex="-1"></a>White.LB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb142-2"><a href="arima.html#cb142-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb142-3"><a href="arima.html#cb142-3" tabindex="-1"></a>  White.LB[i] <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(model2<span class="sc">$</span>residuals, <span class="at">lag=</span>i, <span class="at">type=</span><span class="st">&quot;Ljung-Box&quot;</span>, <span class="at">fitdf =</span> <span class="dv">2</span>)<span class="sc">$</span>p.value</span>
<span id="cb142-4"><a href="arima.html#cb142-4" tabindex="-1"></a>}</span>
<span id="cb142-5"><a href="arima.html#cb142-5" tabindex="-1"></a></span>
<span id="cb142-6"><a href="arima.html#cb142-6" tabindex="-1"></a>white.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(White.LB[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>],index1[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>]))</span>
<span id="cb142-7"><a href="arima.html#cb142-7" tabindex="-1"></a><span class="fu">colnames</span>(white.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;pvalues&quot;</span>,<span class="st">&quot;Lag&quot;</span>) </span>
<span id="cb142-8"><a href="arima.html#cb142-8" tabindex="-1"></a></span>
<span id="cb142-9"><a href="arima.html#cb142-9" tabindex="-1"></a></span>
<span id="cb142-10"><a href="arima.html#cb142-10" tabindex="-1"></a><span class="fu">ggplot</span>(white.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(Lag),<span class="at">y=</span>pvalues))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Model 2&quot;</span>,<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>,<span class="at">y=</span><span class="st">&quot;p-values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/white%20noise-2.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="arima.html#cb143-1" tabindex="-1"></a>White.LB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb143-2"><a href="arima.html#cb143-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb143-3"><a href="arima.html#cb143-3" tabindex="-1"></a>  White.LB[i] <span class="ot">&lt;-</span> <span class="fu">Box.test</span>(model3<span class="sc">$</span>residuals, <span class="at">lag=</span>i, <span class="at">type=</span><span class="st">&quot;Ljung-Box&quot;</span>, <span class="at">fitdf =</span> <span class="dv">5</span>)<span class="sc">$</span>p.value</span>
<span id="cb143-4"><a href="arima.html#cb143-4" tabindex="-1"></a>}</span>
<span id="cb143-5"><a href="arima.html#cb143-5" tabindex="-1"></a></span>
<span id="cb143-6"><a href="arima.html#cb143-6" tabindex="-1"></a>white.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(White.LB[<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],index1[<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>]))</span>
<span id="cb143-7"><a href="arima.html#cb143-7" tabindex="-1"></a><span class="fu">colnames</span>(white.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;pvalues&quot;</span>,<span class="st">&quot;Lag&quot;</span>) </span>
<span id="cb143-8"><a href="arima.html#cb143-8" tabindex="-1"></a></span>
<span id="cb143-9"><a href="arima.html#cb143-9" tabindex="-1"></a></span>
<span id="cb143-10"><a href="arima.html#cb143-10" tabindex="-1"></a><span class="fu">ggplot</span>(white.dat,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(Lag),<span class="at">y=</span>pvalues))<span class="sc">+</span><span class="fu">geom_col</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Model 3&quot;</span>,<span class="at">x=</span><span class="st">&quot;Lags&quot;</span>,<span class="at">y=</span><span class="st">&quot;p-values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/white%20noise-3.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="arima.html#cb144-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span>hurrican.ts, <span class="fu">aes</span>(<span class="at">x =</span> model1<span class="sc">$</span>residuals)) <span class="sc">+</span></span>
<span id="cb144-2"><a href="arima.html#cb144-2" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb144-3"><a href="arima.html#cb144-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Histogram of Residuals for Model 1&#39;</span>, <span class="at">x =</span> <span class="st">&#39;Residuals&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Frequency&#39;</span>)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type
## &lt;ts&gt;. Defaulting to continuous.
## `stat_bin()` using `bins = 30`. Pick better value with
## `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/white%20noise-4.png" width="672" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="arima.html#cb146-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span>hurrican.ts, <span class="fu">aes</span>(<span class="at">x =</span> model2<span class="sc">$</span>residuals)) <span class="sc">+</span></span>
<span id="cb146-2"><a href="arima.html#cb146-2" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb146-3"><a href="arima.html#cb146-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Histogram of Residuals for Model 2&#39;</span>, <span class="at">x =</span> <span class="st">&#39;Residuals&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Frequency&#39;</span>)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type
## &lt;ts&gt;. Defaulting to continuous.
## `stat_bin()` using `bins = 30`. Pick better value with
## `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/white%20noise-5.png" width="672" /></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="arima.html#cb148-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span>hurrican.ts, <span class="fu">aes</span>(<span class="at">x =</span> model3<span class="sc">$</span>residuals)) <span class="sc">+</span></span>
<span id="cb148-2"><a href="arima.html#cb148-2" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb148-3"><a href="arima.html#cb148-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Histogram of Residuals for Model 3&#39;</span>, <span class="at">x =</span> <span class="st">&#39;Residuals&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Frequency&#39;</span>)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type
## &lt;ts&gt;. Defaulting to continuous.
## `stat_bin()` using `bins = 30`. Pick better value with
## `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/white%20noise-6.png" width="672" /></p>
<p>You can now forecast the data with these models:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="arima.html#cb150-1" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">forecast</span>(model1, <span class="at">h =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
## 156       94.59774 82.06430 107.1312 75.42950 113.7660
## 157       94.59774 82.00783 107.1877 75.34314 113.8524
## 158       94.59774 81.95162 107.2439 75.25716 113.9383
## 159       94.59774 81.89565 107.2998 75.17157 114.0239
## 160       94.59774 81.83993 107.3556 75.08635 114.1091
## 161       94.59774 81.78445 107.4110 75.00151 114.1940
## 162       94.59774 81.72921 107.4663 74.91703 114.2785
## 163       94.59774 81.67421 107.5213 74.83291 114.3626
## 164       94.59774 81.61944 107.5760 74.74914 114.4463
## 165       94.59774 81.56490 107.6306 74.66573 114.5298</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="arima.html#cb152-1" tabindex="-1"></a><span class="fu">autoplot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(model1, <span class="at">h =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/forecast%20ARIMA-1.png" width="672" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="arima.html#cb153-1" tabindex="-1"></a><span class="fu">autoplot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(model2, <span class="at">h =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/forecast%20ARIMA-2.png" width="672" /></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="arima.html#cb154-1" tabindex="-1"></a><span class="fu">autoplot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(model3, <span class="at">h =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/forecast%20ARIMA-3.png" width="672" /></p>
</div>
<div id="python-code-for-armaarima-models" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Python Code for ARMA/ARIMA models<a href="arima.html#python-code-for-armaarima-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="arima.html#cb155-1" tabindex="-1"></a></span>
<span id="cb155-2"><a href="arima.html#cb155-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb155-3"><a href="arima.html#cb155-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb155-4"><a href="arima.html#cb155-4" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb155-5"><a href="arima.html#cb155-5" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb155-6"><a href="arima.html#cb155-6" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb155-7"><a href="arima.html#cb155-7" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb155-8"><a href="arima.html#cb155-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb155-9"><a href="arima.html#cb155-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb155-10"><a href="arima.html#cb155-10" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb155-11"><a href="arima.html#cb155-11" tabindex="-1"></a></span>
<span id="cb155-12"><a href="arima.html#cb155-12" tabindex="-1"></a>quotes<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">fpp_insurance.csv&quot;</span>)</span>
<span id="cb155-13"><a href="arima.html#cb155-13" tabindex="-1"></a>y<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ar2.csv&quot;</span>)</span>
<span id="cb155-14"><a href="arima.html#cb155-14" tabindex="-1"></a></span>
<span id="cb155-15"><a href="arima.html#cb155-15" tabindex="-1"></a>result<span class="op">=</span>adfuller(quotes[<span class="st">&quot;Quotes&quot;</span>])</span>
<span id="cb155-16"><a href="arima.html#cb155-16" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;ADF p-value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<pre><code>## ADF p-value: 0.010194998749727997</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="arima.html#cb157-1" tabindex="-1"></a>plot_acf(quotes[<span class="st">&quot;Quotes&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb157-2"><a href="arima.html#cb157-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-1.png" width="672" /></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="arima.html#cb158-1" tabindex="-1"></a>plot_pacf(quotes[<span class="st">&quot;Quotes&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb158-2"><a href="arima.html#cb158-2" tabindex="-1"></a>pyplot.show</span></code></pre></div>
<pre><code>## &lt;function make_python_function.&lt;locals&gt;.python_function at 0x000002385BC2EE60&gt;</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="arima.html#cb160-1" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y, order<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb160-2"><a href="arima.html#cb160-2" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb160-3"><a href="arima.html#cb160-3" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code></pre></div>
<pre><code>##                                SARIMAX Results                                
## ==============================================================================
## Dep. Variable:                      Y   No. Observations:                 1000
## Model:                 ARIMA(2, 0, 0)   Log Likelihood               -3695.014
## Date:                Thu, 07 Sep 2023   AIC                           7398.028
## Time:                        22:49:32   BIC                           7417.659
## Sample:                             0   HQIC                          7405.489
##                                - 1000                                         
## Covariance Type:                  opg                                         
## ==============================================================================
##                  coef    std err          z      P&gt;|z|      [0.025      0.975]
## ------------------------------------------------------------------------------
## const         -0.1365      0.420     -0.325      0.745      -0.960       0.687
## ar.L1          0.6406      0.030     21.165      0.000       0.581       0.700
## ar.L2         -0.3759      0.030    -12.466      0.000      -0.435      -0.317
## sigma2        94.7853      4.193     22.604      0.000      86.567     103.004
## ===================================================================================
## Ljung-Box (L1) (Q):                   0.02   Jarque-Bera (JB):                 0.26
## Prob(Q):                              0.89   Prob(JB):                         0.88
## Heteroskedasticity (H):               1.04   Skew:                            -0.03
## Prob(H) (two-sided):                  0.73   Kurtosis:                         3.05
## ===================================================================================
## 
## Warnings:
## [1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="arima.html#cb162-1" tabindex="-1"></a>residuals <span class="op">=</span> DataFrame(model_fit.resid)</span>
<span id="cb162-2"><a href="arima.html#cb162-2" tabindex="-1"></a>residuals.plot()</span>
<span id="cb162-3"><a href="arima.html#cb162-3" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-2.png" width="672" /></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb163-1"><a href="arima.html#cb163-1" tabindex="-1"></a><span class="bu">print</span>(residuals.describe())</span></code></pre></div>
<pre><code>##                  0
## count  1000.000000
## mean     -0.001313
## std       9.747534
## min     -33.282545
## 25%      -6.475670
## 50%       0.117391
## 75%       6.510636
## max      30.318100</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb165-1"><a href="arima.html#cb165-1" tabindex="-1"></a>plot_acf(residuals,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb165-2"><a href="arima.html#cb165-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-3.png" width="672" /></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="arima.html#cb166-1" tabindex="-1"></a>plot_pacf(residuals,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb166-2"><a href="arima.html#cb166-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-4.png" width="672" /></p>
<p>Checking for white noise:
The first value in the Ljung-Box test is the test statistic and the second value is the p-value.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb167-1"><a href="arima.html#cb167-1" tabindex="-1"></a></span>
<span id="cb167-2"><a href="arima.html#cb167-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb167-3"><a href="arima.html#cb167-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb167-4"><a href="arima.html#cb167-4" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb167-5"><a href="arima.html#cb167-5" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb167-6"><a href="arima.html#cb167-6" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb167-7"><a href="arima.html#cb167-7" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb167-8"><a href="arima.html#cb167-8" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb167-9"><a href="arima.html#cb167-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb167-10"><a href="arima.html#cb167-10" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb167-11"><a href="arima.html#cb167-11" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb167-12"><a href="arima.html#cb167-12" tabindex="-1"></a></span>
<span id="cb167-13"><a href="arima.html#cb167-13" tabindex="-1"></a>quotes<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">fpp_insurance.csv&quot;</span>)</span>
<span id="cb167-14"><a href="arima.html#cb167-14" tabindex="-1"></a>y<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ar2.csv&quot;</span>)</span>
<span id="cb167-15"><a href="arima.html#cb167-15" tabindex="-1"></a></span>
<span id="cb167-16"><a href="arima.html#cb167-16" tabindex="-1"></a></span>
<span id="cb167-17"><a href="arima.html#cb167-17" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y, order<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb167-18"><a href="arima.html#cb167-18" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb167-19"><a href="arima.html#cb167-19" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code></pre></div>
<pre><code>##                                SARIMAX Results                                
## ==============================================================================
## Dep. Variable:                      Y   No. Observations:                 1000
## Model:                 ARIMA(2, 0, 0)   Log Likelihood               -3695.014
## Date:                Thu, 07 Sep 2023   AIC                           7398.028
## Time:                        22:49:33   BIC                           7417.659
## Sample:                             0   HQIC                          7405.489
##                                - 1000                                         
## Covariance Type:                  opg                                         
## ==============================================================================
##                  coef    std err          z      P&gt;|z|      [0.025      0.975]
## ------------------------------------------------------------------------------
## const         -0.1365      0.420     -0.325      0.745      -0.960       0.687
## ar.L1          0.6406      0.030     21.165      0.000       0.581       0.700
## ar.L2         -0.3759      0.030    -12.466      0.000      -0.435      -0.317
## sigma2        94.7853      4.193     22.604      0.000      86.567     103.004
## ===================================================================================
## Ljung-Box (L1) (Q):                   0.02   Jarque-Bera (JB):                 0.26
## Prob(Q):                              0.89   Prob(JB):                         0.88
## Heteroskedasticity (H):               1.04   Skew:                            -0.03
## Prob(H) (two-sided):                  0.73   Kurtosis:                         3.05
## ===================================================================================
## 
## Warnings:
## [1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb169-1"><a href="arima.html#cb169-1" tabindex="-1"></a>lag_test<span class="op">=</span>[<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>]</span>
<span id="cb169-2"><a href="arima.html#cb169-2" tabindex="-1"></a></span>
<span id="cb169-3"><a href="arima.html#cb169-3" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> lag_test:</span>
<span id="cb169-4"><a href="arima.html#cb169-4" tabindex="-1"></a>  sm.stats.acorr_ljungbox(model_fit.resid, lags<span class="op">=</span>[x], model_df<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb169-5"><a href="arima.html#cb169-5" tabindex="-1"></a>  </span></code></pre></div>
<pre><code>##     lb_stat  lb_pvalue
## 3  0.312026    0.57644
##    lb_stat  lb_pvalue
## 4  0.48802    0.78348
##     lb_stat  lb_pvalue
## 5  0.514998   0.915584
##     lb_stat  lb_pvalue
## 6  4.115336   0.390622
##    lb_stat  lb_pvalue
## 7  4.12802   0.531135
##     lb_stat  lb_pvalue
## 8  4.256921   0.641952
##     lb_stat  lb_pvalue
## 9  4.313757   0.743012
##      lb_stat  lb_pvalue
## 10  6.360916   0.606873</code></pre>
<p>Trending series…</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb171-1"><a href="arima.html#cb171-1" tabindex="-1"></a></span>
<span id="cb171-2"><a href="arima.html#cb171-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb171-3"><a href="arima.html#cb171-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb171-4"><a href="arima.html#cb171-4" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb171-5"><a href="arima.html#cb171-5" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb171-6"><a href="arima.html#cb171-6" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb171-7"><a href="arima.html#cb171-7" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb171-8"><a href="arima.html#cb171-8" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb171-9"><a href="arima.html#cb171-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb171-10"><a href="arima.html#cb171-10" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb171-11"><a href="arima.html#cb171-11" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb171-12"><a href="arima.html#cb171-12" tabindex="-1"></a></span>
<span id="cb171-13"><a href="arima.html#cb171-13" tabindex="-1"></a></span>
<span id="cb171-14"><a href="arima.html#cb171-14" tabindex="-1"></a>Daily_High_all<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ebay9899.csv&quot;</span>)</span>
<span id="cb171-15"><a href="arima.html#cb171-15" tabindex="-1"></a>Daily_High<span class="op">=</span>Daily_High_all[<span class="st">&quot;DailyHigh&quot;</span>]</span>
<span id="cb171-16"><a href="arima.html#cb171-16" tabindex="-1"></a>Daily_High2<span class="op">=</span>Daily_High.interpolate(option<span class="op">=</span><span class="st">&#39;spline&#39;</span>)</span>
<span id="cb171-17"><a href="arima.html#cb171-17" tabindex="-1"></a>result<span class="op">=</span>adfuller(Daily_High2)</span>
<span id="cb171-18"><a href="arima.html#cb171-18" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;ADF p-value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb171-19"><a href="arima.html#cb171-19" tabindex="-1"></a></span>
<span id="cb171-20"><a href="arima.html#cb171-20" tabindex="-1"></a><span class="co">##Fitting a Random Walk</span></span></code></pre></div>
<pre><code>## ADF p-value: 0.28418702727378115</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb173-1"><a href="arima.html#cb173-1" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y, order<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb173-2"><a href="arima.html#cb173-2" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb173-3"><a href="arima.html#cb173-3" tabindex="-1"></a></span>
<span id="cb173-4"><a href="arima.html#cb173-4" tabindex="-1"></a><span class="co">###NOT correct, but if you wanted to fit a regression to data</span></span>
<span id="cb173-5"><a href="arima.html#cb173-5" tabindex="-1"></a>x<span class="op">=</span>pd.Series(<span class="bu">range</span>(<span class="dv">318</span>))</span>
<span id="cb173-6"><a href="arima.html#cb173-6" tabindex="-1"></a>model2<span class="op">=</span>ARIMA(endog<span class="op">=</span>Daily_High2,exog<span class="op">=</span>x,order<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb173-7"><a href="arima.html#cb173-7" tabindex="-1"></a>model2_fit<span class="op">=</span>model2.fit()</span>
<span id="cb173-8"><a href="arima.html#cb173-8" tabindex="-1"></a>model2_fit</span>
<span id="cb173-9"><a href="arima.html#cb173-9" tabindex="-1"></a></span>
<span id="cb173-10"><a href="arima.html#cb173-10" tabindex="-1"></a><span class="co">### Now you can model residuals from the regression (if that is the route you took)</span></span>
<span id="cb173-11"><a href="arima.html#cb173-11" tabindex="-1"></a>  </span></code></pre></div>
<pre><code>## &lt;statsmodels.tsa.arima.model.ARIMAResultsWrapper object at 0x00000238789E04F0&gt;</code></pre>
<p>Fitting ARIMA models.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="arima.html#cb175-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb175-2"><a href="arima.html#cb175-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb175-3"><a href="arima.html#cb175-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb175-4"><a href="arima.html#cb175-4" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb175-5"><a href="arima.html#cb175-5" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb175-6"><a href="arima.html#cb175-6" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb175-7"><a href="arima.html#cb175-7" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb175-8"><a href="arima.html#cb175-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb175-9"><a href="arima.html#cb175-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb175-10"><a href="arima.html#cb175-10" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb175-11"><a href="arima.html#cb175-11" tabindex="-1"></a><span class="im">import</span> pmdarima <span class="im">as</span> pm</span>
<span id="cb175-12"><a href="arima.html#cb175-12" tabindex="-1"></a></span>
<span id="cb175-13"><a href="arima.html#cb175-13" tabindex="-1"></a></span>
<span id="cb175-14"><a href="arima.html#cb175-14" tabindex="-1"></a>hurricane<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">hurrican.csv&quot;</span>)</span>
<span id="cb175-15"><a href="arima.html#cb175-15" tabindex="-1"></a>max_velocity<span class="op">=</span>hurricane[<span class="st">&quot;MeanVMax&quot;</span>]</span>
<span id="cb175-16"><a href="arima.html#cb175-16" tabindex="-1"></a>max2<span class="op">=</span>max_velocity.dropna()</span>
<span id="cb175-17"><a href="arima.html#cb175-17" tabindex="-1"></a></span>
<span id="cb175-18"><a href="arima.html#cb175-18" tabindex="-1"></a><span class="co">### Testing stationarity </span></span>
<span id="cb175-19"><a href="arima.html#cb175-19" tabindex="-1"></a></span>
<span id="cb175-20"><a href="arima.html#cb175-20" tabindex="-1"></a>result<span class="op">=</span>adfuller(max2)</span>
<span id="cb175-21"><a href="arima.html#cb175-21" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;ADF p-value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb175-22"><a href="arima.html#cb175-22" tabindex="-1"></a></span>
<span id="cb175-23"><a href="arima.html#cb175-23" tabindex="-1"></a><span class="co">### Same result as auto.arima in R!</span></span></code></pre></div>
<pre><code>## ADF p-value: 0.0010116374636738128</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb177-1"><a href="arima.html#cb177-1" tabindex="-1"></a>model1<span class="op">=</span>pm.auto_arima(max2, start_p<span class="op">=</span><span class="dv">0</span>,start_q<span class="op">=</span><span class="dv">0</span>,max_p<span class="op">=</span><span class="dv">5</span>,max_q<span class="op">=</span><span class="dv">5</span>,seasonal<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb177-2"><a href="arima.html#cb177-2" tabindex="-1"></a>model1.summary()</span>
<span id="cb177-3"><a href="arima.html#cb177-3" tabindex="-1"></a></span>
<span id="cb177-4"><a href="arima.html#cb177-4" tabindex="-1"></a><span class="co"># Force d=0</span></span></code></pre></div>
<table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>    <td>155</td>  
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(0, 1, 1)</td> <th>  Log Likelihood     </th> <td>-570.040</td>
</tr>
<tr>
  <th>Date:</th>            <td>Thu, 07 Sep 2023</td> <th>  AIC                </th> <td>1144.080</td>
</tr>
<tr>
  <th>Time:</th>                <td>22:49:35</td>     <th>  BIC                </th> <td>1150.154</td>
</tr>
<tr>
  <th>Sample:</th>                  <td>0</td>        <th>  HQIC               </th> <td>1146.547</td>
</tr>
<tr>
  <th></th>                      <td> - 155</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ma.L1</th>  <td>   -0.9050</td> <td>    0.036</td> <td>  -25.036</td> <td> 0.000</td> <td>   -0.976</td> <td>   -0.834</td>
</tr>
<tr>
  <th>sigma2</th> <td>   95.0278</td> <td>   10.416</td> <td>    9.123</td> <td> 0.000</td> <td>   74.612</td> <td>  115.443</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.05</td> <th>  Jarque-Bera (JB):  </th> <td>0.30</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.81</td> <th>  Prob(JB):          </th> <td>0.86</td>
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>2.10</td> <th>  Skew:              </th> <td>0.08</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.01</td> <th>  Kurtosis:          </th> <td>3.15</td>
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
<div class="sourceCode" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="arima.html#cb178-1" tabindex="-1"></a>model2<span class="op">=</span>pm.auto_arima(max2, start_p<span class="op">=</span><span class="dv">0</span>,start_q<span class="op">=</span><span class="dv">0</span>,max_p<span class="op">=</span><span class="dv">5</span>,max_q<span class="op">=</span><span class="dv">5</span>,d<span class="op">=</span><span class="dv">0</span>,seasonal<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb178-2"><a href="arima.html#cb178-2" tabindex="-1"></a>model2.summary()</span></code></pre></div>
<table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>    <td>155</td>  
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(1, 0, 1)</td> <th>  Log Likelihood     </th> <td>-574.278</td>
</tr>
<tr>
  <th>Date:</th>            <td>Thu, 07 Sep 2023</td> <th>  AIC                </th> <td>1156.556</td>
</tr>
<tr>
  <th>Time:</th>                <td>22:49:36</td>     <th>  BIC                </th> <td>1168.729</td>
</tr>
<tr>
  <th>Sample:</th>                  <td>0</td>        <th>  HQIC               </th> <td>1161.500</td>
</tr>
<tr>
  <th></th>                      <td> - 155</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>intercept</th> <td>   26.5825</td> <td>   20.863</td> <td>    1.274</td> <td> 0.203</td> <td>  -14.308</td> <td>   67.473</td>
</tr>
<tr>
  <th>ar.L1</th>     <td>    0.7082</td> <td>    0.228</td> <td>    3.103</td> <td> 0.002</td> <td>    0.261</td> <td>    1.156</td>
</tr>
<tr>
  <th>ma.L1</th>     <td>   -0.5717</td> <td>    0.281</td> <td>   -2.031</td> <td> 0.042</td> <td>   -1.123</td> <td>   -0.020</td>
</tr>
<tr>
  <th>sigma2</th>    <td>   97.3309</td> <td>   11.556</td> <td>    8.423</td> <td> 0.000</td> <td>   74.682</td> <td>  119.979</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.23</td> <th>  Jarque-Bera (JB):  </th> <td>2.12</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.63</td> <th>  Prob(JB):          </th> <td>0.35</td>
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>1.75</td> <th>  Skew:              </th> <td>0.29</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.05</td> <th>  Kurtosis:          </th> <td>2.95</td>
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</div>
<div id="sas-code-for-armaarima" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> SAS Code for ARMA/ARIMA<a href="arima.html#sas-code-for-armaarima" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>AUGMENTED DICKEY-FULLER TESTING</em></p>
<p>proc arima data=Time.fpp_insurance plot=all;  
identify var=quotes nlag=10 stationarity=(adf=2);  
identify var=quotes(1) nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>CORRELATION FUNCTIONS</em><br />
</p>
<p><em>Notice no model statement!</em>  </p>
<p>proc arima data=Time.ar2 plot(unpack)=all;  
identify var=y nlag=10 outcov=Corr;  
estimate method=ML;  
run;
quit;</p>
<p><em>BUILDING AN AUTOREGRESSIVE MODEL</em></p>
<p><em>Fit an AR2 model</em>  </p>
<p>proc arima data=Time.AR2 plot=all;  
identify var=y nlag=10;  
estimate p=2 method=ML;  
run;
quit;  </p>
<p><em>Add another estimate statement</em>
proc arima data=Time.AR2 plot=all;
identify var=y nlag=10;
estimate p=(2) method=ML;
estimate p=(1,2,4) method=ML;
run;
quit;  </p>
<p><em>BUILDING A MOVING AVERAGE MODEL</em></p>
<p>proc arima data=Time.ma2;  
identify var=x;  
estimate q=2 method=ML;  
run;
quit;  </p>
<p><em>Need to check for how to take care of trend</em></p>
<p>proc arima data=Time.Ebay9899 plot=all;  
identify var=DailyHigh nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>It is a random walk!! The way to model a random walk is by using differences</em>  </p>
<p>proc arima data=Time.Ebay9899 plot=all;  
identify var=DailyHigh(1) nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>IF it would have been deterministic…CAUTION, it is NOT deterministic!!</em>  </p>
<p><em>You would need to create an “x” variable for time</em>  </p>
<p>data newebay;  
set Time.Ebay9899;  
time=<em>n</em>;  
run;  </p>
<p><em>Keep in mind that this data is not deterministic!!</em>  </p>
<p>proc arima data=newebay plot=all;  
identify var=DailyHigh crosscorr=time;  
estimate input=time;  
run;
quit;</p>
<p><em>BUILDING AN AUTOREGRESSIVE MOVING AVERAGE MODEL</em>  
<em>(AUTOMATIC SELECTION TECHNIQUES)</em>  </p>
<p><em>Fit an ARIMA model</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 stationarity=(adf=2);  
run;
quit;  </p>
<p><em>Model identification with minimum information criterion (MINIC)</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 minic P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Model identification with smallest canonical correlation (SCAN);</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 scan P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Model identificaiton with extended sample autocorrelation function (ESACF)</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 esacf P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Create estimates with our ARIMA model p=2, q=3</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12;  
estimate p=2 q=3 method=ML;  
run;
quit;</p>
<p><em>FORECASTING</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=10 ;  
estimate p=2 q=3 method=ML;  
forecast lead=10;  
run;
quit;</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exponential-smoothing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="seasonality.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sjsimmo2/TimeSeries/edit/master/03-ARIMA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sjsimmo2/TimeSeries/blob/master/03-ARIMA.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
