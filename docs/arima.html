<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 ARIMA | Time Series 1 and 2</title>
  <meta name="description" content="Chapter 4 ARIMA | Time Series 1 and 2" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 ARIMA | Time Series 1 and 2" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 ARIMA | Time Series 1 and 2" />
  
  
  

<meta name="author" content="by Dr. Susan Simmons and Dr. Aric LaBarr" />


<meta name="date" content="2024-08-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exponential-smoothing.html"/>
<link rel="next" href="seasonality.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TimeSeries</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#other-plots"><i class="fa fa-check"></i><b>2.1</b> Other plots</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#time-series-decomposition"><i class="fa fa-check"></i><b>2.2</b> Time series decomposition</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#stl-features"><i class="fa fa-check"></i><b>2.3</b> STL features</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#missing-values"><i class="fa fa-check"></i><b>2.4</b> Missing values</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#python-code-and-results-for-time-series-plot"><i class="fa fa-check"></i><b>2.5</b> Python code and results for Time Series plot</a></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#sas-code-for-time-series-plot-and-decomposition"><i class="fa fa-check"></i><b>2.6</b> SAS code for time series plot and decomposition</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>3</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.1</b> Simple Exponential Smoothing</a></li>
<li class="chapter" data-level="3.2" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-esm"><i class="fa fa-check"></i><b>3.2</b> Holt ESM</a></li>
<li class="chapter" data-level="3.3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-winters"><i class="fa fa-check"></i><b>3.3</b> Holt-Winters</a></li>
<li class="chapter" data-level="3.4" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#comparing-forecasts"><i class="fa fa-check"></i><b>3.4</b> Comparing forecasts</a></li>
<li class="chapter" data-level="3.5" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#ets"><i class="fa fa-check"></i><b>3.5</b> ETS</a></li>
<li class="chapter" data-level="3.6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#python-code-for-exponential-smoothing"><i class="fa fa-check"></i><b>3.6</b> Python Code for Exponential Smoothing</a></li>
<li class="chapter" data-level="3.7" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#sas-code-for-exponential-smoothing-models"><i class="fa fa-check"></i><b>3.7</b> SAS Code for Exponential Smoothing Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#correlation-functions"><i class="fa fa-check"></i><b>4.2</b> Correlation Functions</a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#autoregressive-models-ar"><i class="fa fa-check"></i><b>4.3</b> AutoRegressive Models (AR)</a></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#moving-average-model-ma"><i class="fa fa-check"></i><b>4.4</b> Moving Average model (MA)</a></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#white-noise"><i class="fa fa-check"></i><b>4.5</b> White noise</a></li>
<li class="chapter" data-level="4.6" data-path="arima.html"><a href="arima.html#python-code-for-armaarima-models"><i class="fa fa-check"></i><b>4.6</b> Python Code for ARMA/ARIMA models</a></li>
<li class="chapter" data-level="4.7" data-path="arima.html"><a href="arima.html#sas-code-for-armaarima"><i class="fa fa-check"></i><b>4.7</b> SAS Code for ARMA/ARIMA</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seasonality.html"><a href="seasonality.html"><i class="fa fa-check"></i><b>5</b> Seasonality</a>
<ul>
<li class="chapter" data-level="5.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-unit-root-testing"><i class="fa fa-check"></i><b>5.1</b> Seasonal Unit Root Testing</a></li>
<li class="chapter" data-level="5.2" data-path="seasonality.html"><a href="seasonality.html#deterministic-solutions"><i class="fa fa-check"></i><b>5.2</b> Deterministic Solutions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="seasonality.html"><a href="seasonality.html#seasonal-dummy-variables"><i class="fa fa-check"></i><b>5.2.1</b> Seasonal Dummy Variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="seasonality.html"><a href="seasonality.html#fourier-transforms"><i class="fa fa-check"></i><b>5.2.2</b> Fourier Transforms</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="seasonality.html"><a href="seasonality.html#stochastic-solutions"><i class="fa fa-check"></i><b>5.3</b> Stochastic Solutions</a></li>
<li class="chapter" data-level="5.4" data-path="seasonality.html"><a href="seasonality.html#seasonal-arima-modeling"><i class="fa fa-check"></i><b>5.4</b> Seasonal ARIMA Modeling</a></li>
<li class="chapter" data-level="5.5" data-path="seasonality.html"><a href="seasonality.html#python-code-for-seasonality"><i class="fa fa-check"></i><b>5.5</b> Python Code for Seasonality</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="seasonality.html"><a href="seasonality.html#seasonality-1"><i class="fa fa-check"></i><b>5.5.1</b> Seasonality</a></li>
<li class="chapter" data-level="5.5.2" data-path="seasonality.html"><a href="seasonality.html#deterministic-solutions-1"><i class="fa fa-check"></i><b>5.5.2</b> Deterministic Solutions</a></li>
<li class="chapter" data-level="5.5.3" data-path="seasonality.html"><a href="seasonality.html#stochastic-solution"><i class="fa fa-check"></i><b>5.5.3</b> Stochastic Solution</a></li>
<li class="chapter" data-level="5.5.4" data-path="seasonality.html"><a href="seasonality.html#seasonal-arima"><i class="fa fa-check"></i><b>5.5.4</b> Seasonal ARIMA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html"><i class="fa fa-check"></i><b>6</b> Dynamic Regression Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#intervention-variables"><i class="fa fa-check"></i><b>6.1</b> Intervention Variables</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#predictor-variables"><i class="fa fa-check"></i><b>6.2</b> Predictor Variables</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#python-code-for-dynamic-regression-models"><i class="fa fa-check"></i><b>6.3</b> Python Code for Dynamic Regression Models</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#intervention-variables-1"><i class="fa fa-check"></i><b>6.3.1</b> Intervention Variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="dynamic-regression-models.html"><a href="dynamic-regression-models.html#predictor-variables-1"><i class="fa fa-check"></i><b>6.3.2</b> Predictor Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="prophet.html"><a href="prophet.html"><i class="fa fa-check"></i><b>7</b> Prophet</a>
<ul>
<li class="chapter" data-level="7.1" data-path="prophet.html"><a href="prophet.html#python-code-for-prophet"><i class="fa fa-check"></i><b>7.1</b> Python Code for Prophet</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="prophet.html"><a href="prophet.html#model-structure"><i class="fa fa-check"></i><b>7.1.1</b> Model Structure</a></li>
<li class="chapter" data-level="7.1.2" data-path="prophet.html"><a href="prophet.html#forecasting"><i class="fa fa-check"></i><b>7.1.2</b> Forecasting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="neural-network-model.html"><a href="neural-network-model.html"><i class="fa fa-check"></i><b>8</b> Neural Network Model</a>
<ul>
<li class="chapter" data-level="8.1" data-path="neural-network-model.html"><a href="neural-network-model.html#python-code-for-neural-networks"><i class="fa fa-check"></i><b>8.1</b> Python Code for Neural Networks</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="neural-network-model.html"><a href="neural-network-model.html#ar-neural-networks"><i class="fa fa-check"></i><b>8.1.1</b> AR Neural Networks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="weighted-and-combined-models.html"><a href="weighted-and-combined-models.html"><i class="fa fa-check"></i><b>9</b> Weighted and Combined Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="weighted-and-combined-models.html"><a href="weighted-and-combined-models.html#python-code-for-weighted-and-combined-models"><i class="fa fa-check"></i><b>9.1</b> Python Code for Weighted and Combined Models</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="weighted-and-combined-models.html"><a href="weighted-and-combined-models.html#simple-average"><i class="fa fa-check"></i><b>9.1.1</b> Simple Average</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1 and 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="arima" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> ARIMA<a href="arima.html#arima" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We will now be switching over to doing ARMA/ARIMA models!! There are a number of different concepts you will need in order to do this type of modeling.</p>
<div id="stationarity" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Stationarity<a href="arima.html#stationarity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we can try to model the dependency structure (the AR and MA terms), we must first have a stationary series! The ADF test is one of the most well-known and accepted test for testing stationarity. However, others have also been proposed. Within this document, we will be using the KPSS test.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="arima.html#cb1-1" tabindex="-1"></a>Quotes.ts<span class="ot">&lt;-</span>Quotes <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2002-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2005-04-21&#39;</span>),<span class="at">by=</span><span class="st">&#39;months&#39;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="arima.html#cb1-2" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span>
<span id="cb1-3"><a href="arima.html#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="arima.html#cb1-4" tabindex="-1"></a>Quotes_train<span class="ot">&lt;-</span>Quotes.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">2005</span>)</span>
<span id="cb1-5"><a href="arima.html#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="arima.html#cb1-6" tabindex="-1"></a><span class="fu">autoplot</span>(Quotes_train,Quotes)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Monthly Stock quotes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Quotes&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/plot-1.png" width="672" /></p>
<p>The following code looks into stationarity.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="arima.html#cb2-1" tabindex="-1"></a><span class="co"># Perform the KPSS test </span></span>
<span id="cb2-2"><a href="arima.html#cb2-2" tabindex="-1"></a>Quotes_train <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="arima.html#cb2-3" tabindex="-1"></a> <span class="fu">features</span>(Quotes, unitroot_kpss)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   kpss_stat kpss_pvalue
##       &lt;dbl&gt;       &lt;dbl&gt;
## 1     0.197         0.1</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="arima.html#cb4-1" tabindex="-1"></a>Quotes_train <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="arima.html#cb4-2" tabindex="-1"></a> <span class="fu">features</span>(Quotes, unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      0</code></pre>
</div>
<div id="correlation-functions" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Correlation Functions<a href="arima.html#correlation-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Acf and the Pacf in R will calculate the autocorrelation (up to the lag you specify) and the partial autocorrelation, respectively.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="arima.html#cb6-1" tabindex="-1"></a><span class="fu">ggAcf</span>(Quotes_train<span class="sc">$</span>Quotes,<span class="at">lag=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-1.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="arima.html#cb7-1" tabindex="-1"></a><span class="fu">ggPacf</span>(Quotes_train<span class="sc">$</span>Quotes,<span class="at">lag=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/correlation%20functions-2.png" width="672" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="arima.html#cb8-1" tabindex="-1"></a>Hurricane.ts<span class="ot">&lt;-</span> hurricane <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>Year)</span>
<span id="cb8-2"><a href="arima.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="arima.html#cb8-3" tabindex="-1"></a>Hurricane_train <span class="ot">&lt;-</span>Hurricane.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&lt;</span><span class="dv">2000</span>)</span>
<span id="cb8-4"><a href="arima.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="arima.html#cb8-5" tabindex="-1"></a><span class="fu">autoplot</span>(Hurricane_train,MeanVMax)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Yearly Mean Velocity for Hurricanes&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;MPH&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="arima.html#cb9-1" tabindex="-1"></a>Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">features</span>(MeanVMax,unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      1</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="arima.html#cb11-1" tabindex="-1"></a>Hurricane_train <span class="ot">&lt;-</span> Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mean_diff=</span><span class="fu">difference</span>(MeanVMax))</span>
<span id="cb11-2"><a href="arima.html#cb11-2" tabindex="-1"></a>Hurricane_train <span class="sc">%&gt;%</span> <span class="fu">features</span>(mean_diff,unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      0</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="arima.html#cb13-1" tabindex="-1"></a><span class="fu">autoplot</span>(Hurricane_train,mean_diff)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Differenced Mean Max Velocity&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Difference&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
</div>
<div id="autoregressive-models-ar" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> AutoRegressive Models (AR)<a href="arima.html#autoregressive-models-ar" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>AutoRegressive (AR) models involve modeling the lags of Y. We can write an autoregressive model as</p>
<p><span class="math display">\[ Y_{t} = c + \phi_{1}Y_{t-1}+\phi_{2}Y_{t-2}+...\phi_{p}Y_{t-p}+\epsilon_{t} \]</span>
Where there are <em>p</em> lags of <em>Y</em>. Below is the code to fit an AR(2) model. The <em>order</em> in the <em>Arima</em> function needs the p,d,q values (p=# of AR terms, d=how many differences should be taken and q=# of MA terms).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="arima.html#cb15-1" tabindex="-1"></a><span class="fu">ggAcf</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">731</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="arima.html#cb16-1" tabindex="-1"></a><span class="fu">ggPacf</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">731</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-2.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="arima.html#cb17-1" tabindex="-1"></a>Y<span class="fl">.1</span> <span class="ot">&lt;-</span><span class="fu">data.frame</span>(Y)</span>
<span id="cb17-2"><a href="arima.html#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="arima.html#cb17-3" tabindex="-1"></a>Y.ts<span class="ot">&lt;-</span>Y<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2000-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2002-9-26&#39;</span>),<span class="at">by=</span><span class="st">&#39;day&#39;</span>))  <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>date)</span>
<span id="cb17-4"><a href="arima.html#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="arima.html#cb17-5" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> Y.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">&lt;</span><span class="dv">2002</span>)</span>
<span id="cb17-6"><a href="arima.html#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="arima.html#cb17-7" tabindex="-1"></a><span class="fu">autoplot</span>(Y_train,Y)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Simulated Daily series&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-3.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="arima.html#cb18-1" tabindex="-1"></a>Y.ARIMA <span class="ot">&lt;-</span> Y_train <span class="sc">%&gt;%</span> <span class="fu">model</span>(<span class="fu">ARIMA</span>(Y<span class="sc">~</span><span class="fu">pdq</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">+</span><span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb18-2"><a href="arima.html#cb18-2" tabindex="-1"></a><span class="fu">report</span>(Y.ARIMA)</span></code></pre></div>
<pre><code>## Series: Y 
## Model: ARIMA(2,0,0) 
## 
## Coefficients:
##          ar1      ar2
##       0.6399  -0.3838
## s.e.  0.0342   0.0342
## 
## sigma^2 estimated as 93.75:  log likelihood=-2696.14
## AIC=5398.28   AICc=5398.32   BIC=5412.07</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="arima.html#cb20-1" tabindex="-1"></a>Y.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-4.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="arima.html#cb21-1" tabindex="-1"></a>Y.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AR2-5.png" width="672" /></p>
</div>
<div id="moving-average-model-ma" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Moving Average model (MA)<a href="arima.html#moving-average-model-ma" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Moving average (MA) models involve modeling the lags of the error. We can write a moving average model as</p>
<p><span class="math display">\[ Y_{t} = c - \theta_{1}\epsilon_{t-1}-\theta_{2}\epsilon_{t-2}-...\theta_{q}\epsilon_{t-q}+\epsilon_{t} \]</span>
Where there are <em>q</em> lags of <span class="math inline">\(\epsilon\)</span>. Below is code to fit an MA(2) model.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="arima.html#cb22-1" tabindex="-1"></a><span class="fu">ggAcf</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">74</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-1.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="arima.html#cb23-1" tabindex="-1"></a><span class="fu">ggPacf</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">74</span>,])</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-2.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="arima.html#cb24-1" tabindex="-1"></a>x<span class="fl">.1</span> <span class="ot">&lt;-</span><span class="fu">data.frame</span>(x)</span>
<span id="cb24-2"><a href="arima.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="arima.html#cb24-3" tabindex="-1"></a>x.ts<span class="ot">&lt;-</span>x<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;2000-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;2000-4-9&#39;</span>),<span class="at">by=</span><span class="st">&#39;day&#39;</span>))  <span class="sc">%&gt;%</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>date)</span>
<span id="cb24-4"><a href="arima.html#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="arima.html#cb24-5" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> x.ts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="st">&#39;2000-3-15&#39;</span>)</span>
<span id="cb24-6"><a href="arima.html#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="arima.html#cb24-7" tabindex="-1"></a><span class="fu">autoplot</span>(x_train,x)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series of Simulated Daily series&quot;</span>, <span class="at">x=</span><span class="st">&quot;Time&quot;</span>, <span class="at">y=</span><span class="st">&quot;Values&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-3.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="arima.html#cb25-1" tabindex="-1"></a>x.ARIMA <span class="ot">&lt;-</span> x_train <span class="sc">%&gt;%</span> <span class="fu">model</span>(<span class="fu">ARIMA</span>(x<span class="sc">~</span><span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>)<span class="sc">+</span><span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb25-2"><a href="arima.html#cb25-2" tabindex="-1"></a><span class="fu">report</span>(x.ARIMA)</span></code></pre></div>
<pre><code>## Series: x 
## Model: ARIMA(0,0,2) 
## 
## Coefficients:
##           ma1     ma2
##       -0.2585  0.4874
## s.e.   0.1031  0.1063
## 
## sigma^2 estimated as 0.2299:  log likelihood=-49.88
## AIC=105.77   AICc=106.11   BIC=112.68</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="arima.html#cb27-1" tabindex="-1"></a>x.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggAcf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-4.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="arima.html#cb28-1" tabindex="-1"></a>x.ARIMA <span class="sc">%&gt;%</span> <span class="fu">residuals</span>() <span class="sc">%&gt;%</span> <span class="fu">ggPacf</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/MA2-5.png" width="672" /></p>
</div>
<div id="white-noise" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> White noise<a href="arima.html#white-noise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For residuals to exhibit white noise, they must be “independent” and normally distributed with mean 0 and constant variance. You already know how to assess normality and constant variance, however, we need to focus on assessing “independence”. We can assess if there is significant dependence through the Ljung-Box test (or graphically through ACF and PACF plots). The hypotheses being tested are</p>
<p><span class="math display">\[H_{0}:No\quad significant\quad autocorrelation\\
H_{A}:Significant\qquad autocorrletion \]</span></p>
<p>This should be assessed on a <em>stationary</em> time series. Looking at a stationary time series, going back 10 lags should be sufficient (this will be different when we get to seasonal models). Keep in mind that sample size does matter when assessing significance (adjust significance level accordingly).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="arima.html#cb29-1" tabindex="-1"></a><span class="do">### Before fitting model:</span></span>
<span id="cb29-2"><a href="arima.html#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="arima.html#cb29-3" tabindex="-1"></a><span class="fu">ljung_box</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">731</span>,], <span class="at">lag =</span> <span class="dv">10</span>, <span class="at">dof=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>##   lb_stat lb_pvalue 
##  217.3408    0.0000</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="arima.html#cb31-1" tabindex="-1"></a><span class="do">## Note: Y is a vector</span></span>
<span id="cb31-2"><a href="arima.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="arima.html#cb31-3" tabindex="-1"></a><span class="do">### After fitting model:</span></span>
<span id="cb31-4"><a href="arima.html#cb31-4" tabindex="-1"></a></span>
<span id="cb31-5"><a href="arima.html#cb31-5" tabindex="-1"></a><span class="fu">augment</span>(Y.ARIMA) <span class="sc">%&gt;%</span> <span class="fu">features</span>(.innov,ljung_box, <span class="at">lag=</span><span class="dv">10</span>, <span class="at">dof =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model                                 lb_stat lb_pvalue
##   &lt;chr&gt;                                    &lt;dbl&gt;     &lt;dbl&gt;
## 1 ARIMA(Y ~ pdq(2, 0, 0) + PDQ(0, 0, 0))    8.50     0.386</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="arima.html#cb33-1" tabindex="-1"></a><span class="do">## Note that dof has changed!!</span></span></code></pre></div>
</div>
<div id="python-code-for-armaarima-models" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Python Code for ARMA/ARIMA models<a href="arima.html#python-code-for-armaarima-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="arima.html#cb34-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-2"><a href="arima.html#cb34-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-3"><a href="arima.html#cb34-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb34-4"><a href="arima.html#cb34-4" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb34-5"><a href="arima.html#cb34-5" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb34-6"><a href="arima.html#cb34-6" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb34-7"><a href="arima.html#cb34-7" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb34-8"><a href="arima.html#cb34-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb34-9"><a href="arima.html#cb34-9" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb34-10"><a href="arima.html#cb34-10" tabindex="-1"></a></span>
<span id="cb34-11"><a href="arima.html#cb34-11" tabindex="-1"></a>quotes<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">fpp_insurance.csv&quot;</span>)</span>
<span id="cb34-12"><a href="arima.html#cb34-12" tabindex="-1"></a>y<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ar2.csv&quot;</span>)</span>
<span id="cb34-13"><a href="arima.html#cb34-13" tabindex="-1"></a></span>
<span id="cb34-14"><a href="arima.html#cb34-14" tabindex="-1"></a>result<span class="op">=</span>adfuller(quotes[<span class="st">&quot;Quotes&quot;</span>])</span>
<span id="cb34-15"><a href="arima.html#cb34-15" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;ADF p-value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<pre><code>## ADF p-value: 0.010194998749727997</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="arima.html#cb36-1" tabindex="-1"></a>plot_acf(quotes[<span class="st">&quot;Quotes&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb36-2"><a href="arima.html#cb36-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-1.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="arima.html#cb37-1" tabindex="-1"></a>plot_pacf(quotes[<span class="st">&quot;Quotes&quot;</span>],lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb37-2"><a href="arima.html#cb37-2" tabindex="-1"></a>pyplot.show</span></code></pre></div>
<pre><code>## &lt;function make_python_function.&lt;locals&gt;.python_function at 0x000002C851DF1B40&gt;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="arima.html#cb39-1" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y, order<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb39-2"><a href="arima.html#cb39-2" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb39-3"><a href="arima.html#cb39-3" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code></pre></div>
<pre><code>##                                SARIMAX Results                                
## ==============================================================================
## Dep. Variable:                      Y   No. Observations:                 1000
## Model:                 ARIMA(2, 0, 0)   Log Likelihood               -3695.014
## Date:                Mon, 19 Aug 2024   AIC                           7398.028
## Time:                        10:19:28   BIC                           7417.659
## Sample:                             0   HQIC                          7405.489
##                                - 1000                                         
## Covariance Type:                  opg                                         
## ==============================================================================
##                  coef    std err          z      P&gt;|z|      [0.025      0.975]
## ------------------------------------------------------------------------------
## const         -0.1365      0.420     -0.325      0.745      -0.960       0.687
## ar.L1          0.6406      0.030     21.165      0.000       0.581       0.700
## ar.L2         -0.3759      0.030    -12.466      0.000      -0.435      -0.317
## sigma2        94.7853      4.193     22.604      0.000      86.567     103.004
## ===================================================================================
## Ljung-Box (L1) (Q):                   0.02   Jarque-Bera (JB):                 0.26
## Prob(Q):                              0.89   Prob(JB):                         0.88
## Heteroskedasticity (H):               1.04   Skew:                            -0.03
## Prob(H) (two-sided):                  0.73   Kurtosis:                         3.05
## ===================================================================================
## 
## Warnings:
## [1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="arima.html#cb41-1" tabindex="-1"></a>residuals <span class="op">=</span> DataFrame(model_fit.resid)</span>
<span id="cb41-2"><a href="arima.html#cb41-2" tabindex="-1"></a>residuals.plot()</span>
<span id="cb41-3"><a href="arima.html#cb41-3" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-2.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="arima.html#cb42-1" tabindex="-1"></a><span class="bu">print</span>(residuals.describe())</span></code></pre></div>
<pre><code>##                  0
## count  1000.000000
## mean     -0.001313
## std       9.747534
## min     -33.282545
## 25%      -6.475670
## 50%       0.117391
## 75%       6.510636
## max      30.318100</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="arima.html#cb44-1" tabindex="-1"></a>plot_acf(residuals,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb44-2"><a href="arima.html#cb44-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-3.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="arima.html#cb45-1" tabindex="-1"></a>plot_pacf(residuals,lags<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb45-2"><a href="arima.html#cb45-2" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-4.png" width="672" /><img src="bookdownproj_files/figure-html/ADF,%20correlation%20plots%20and%20ARIMA-5.png" width="672" /></p>
<p>Checking for white noise:
The first value in the Ljung-Box test is the test statistic and the second value is the p-value.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="arima.html#cb46-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb46-2"><a href="arima.html#cb46-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb46-3"><a href="arima.html#cb46-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb46-4"><a href="arima.html#cb46-4" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb46-5"><a href="arima.html#cb46-5" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb46-6"><a href="arima.html#cb46-6" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb46-7"><a href="arima.html#cb46-7" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb46-8"><a href="arima.html#cb46-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb46-9"><a href="arima.html#cb46-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb46-10"><a href="arima.html#cb46-10" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb46-11"><a href="arima.html#cb46-11" tabindex="-1"></a></span>
<span id="cb46-12"><a href="arima.html#cb46-12" tabindex="-1"></a>quotes<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">fpp_insurance.csv&quot;</span>)</span>
<span id="cb46-13"><a href="arima.html#cb46-13" tabindex="-1"></a>y<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">ar2.csv&quot;</span>)</span>
<span id="cb46-14"><a href="arima.html#cb46-14" tabindex="-1"></a></span>
<span id="cb46-15"><a href="arima.html#cb46-15" tabindex="-1"></a></span>
<span id="cb46-16"><a href="arima.html#cb46-16" tabindex="-1"></a>model <span class="op">=</span> ARIMA(y, order<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb46-17"><a href="arima.html#cb46-17" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb46-18"><a href="arima.html#cb46-18" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code></pre></div>
<pre><code>##                                SARIMAX Results                                
## ==============================================================================
## Dep. Variable:                      Y   No. Observations:                 1000
## Model:                 ARIMA(2, 0, 0)   Log Likelihood               -3695.014
## Date:                Mon, 19 Aug 2024   AIC                           7398.028
## Time:                        10:19:29   BIC                           7417.659
## Sample:                             0   HQIC                          7405.489
##                                - 1000                                         
## Covariance Type:                  opg                                         
## ==============================================================================
##                  coef    std err          z      P&gt;|z|      [0.025      0.975]
## ------------------------------------------------------------------------------
## const         -0.1365      0.420     -0.325      0.745      -0.960       0.687
## ar.L1          0.6406      0.030     21.165      0.000       0.581       0.700
## ar.L2         -0.3759      0.030    -12.466      0.000      -0.435      -0.317
## sigma2        94.7853      4.193     22.604      0.000      86.567     103.004
## ===================================================================================
## Ljung-Box (L1) (Q):                   0.02   Jarque-Bera (JB):                 0.26
## Prob(Q):                              0.89   Prob(JB):                         0.88
## Heteroskedasticity (H):               1.04   Skew:                            -0.03
## Prob(H) (two-sided):                  0.73   Kurtosis:                         3.05
## ===================================================================================
## 
## Warnings:
## [1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="arima.html#cb48-1" tabindex="-1"></a>lag_test<span class="op">=</span>[<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>]</span>
<span id="cb48-2"><a href="arima.html#cb48-2" tabindex="-1"></a></span>
<span id="cb48-3"><a href="arima.html#cb48-3" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> lag_test:</span>
<span id="cb48-4"><a href="arima.html#cb48-4" tabindex="-1"></a>  sm.stats.acorr_ljungbox(model_fit.resid, lags<span class="op">=</span>[x], model_df<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     lb_stat  lb_pvalue
## 3  0.312026    0.57644
##    lb_stat  lb_pvalue
## 4  0.48802    0.78348
##     lb_stat  lb_pvalue
## 5  0.514998   0.915584
##     lb_stat  lb_pvalue
## 6  4.115336   0.390622
##    lb_stat  lb_pvalue
## 7  4.12802   0.531135
##     lb_stat  lb_pvalue
## 8  4.256921   0.641952
##     lb_stat  lb_pvalue
## 9  4.313757   0.743012
##      lb_stat  lb_pvalue
## 10  6.360916   0.606873</code></pre>
<p>Fitting ARIMA models.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="arima.html#cb50-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-2"><a href="arima.html#cb50-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb50-3"><a href="arima.html#cb50-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb50-4"><a href="arima.html#cb50-4" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb50-5"><a href="arima.html#cb50-5" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame</span>
<span id="cb50-6"><a href="arima.html#cb50-6" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb50-7"><a href="arima.html#cb50-7" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb50-8"><a href="arima.html#cb50-8" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb50-9"><a href="arima.html#cb50-9" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb50-10"><a href="arima.html#cb50-10" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb50-11"><a href="arima.html#cb50-11" tabindex="-1"></a><span class="im">import</span> pmdarima <span class="im">as</span> pm</span>
<span id="cb50-12"><a href="arima.html#cb50-12" tabindex="-1"></a></span>
<span id="cb50-13"><a href="arima.html#cb50-13" tabindex="-1"></a></span>
<span id="cb50-14"><a href="arima.html#cb50-14" tabindex="-1"></a>hurricane<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">hurrican.csv&quot;</span>)</span>
<span id="cb50-15"><a href="arima.html#cb50-15" tabindex="-1"></a>max_velocity<span class="op">=</span>hurricane[<span class="st">&quot;MeanVMax&quot;</span>]</span>
<span id="cb50-16"><a href="arima.html#cb50-16" tabindex="-1"></a>max2<span class="op">=</span>max_velocity.dropna()</span>
<span id="cb50-17"><a href="arima.html#cb50-17" tabindex="-1"></a></span>
<span id="cb50-18"><a href="arima.html#cb50-18" tabindex="-1"></a><span class="co">### Testing stationarity </span></span>
<span id="cb50-19"><a href="arima.html#cb50-19" tabindex="-1"></a></span>
<span id="cb50-20"><a href="arima.html#cb50-20" tabindex="-1"></a>result<span class="op">=</span>adfuller(max2)</span>
<span id="cb50-21"><a href="arima.html#cb50-21" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;ADF p-value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<pre><code>## ADF p-value: 0.0010116374636738128</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="arima.html#cb52-1" tabindex="-1"></a><span class="co">### Same result as auto.arima in R!</span></span>
<span id="cb52-2"><a href="arima.html#cb52-2" tabindex="-1"></a>model1<span class="op">=</span>pm.auto_arima(max2, start_p<span class="op">=</span><span class="dv">0</span>,start_q<span class="op">=</span><span class="dv">0</span>,max_p<span class="op">=</span><span class="dv">5</span>,max_q<span class="op">=</span><span class="dv">5</span>,seasonal<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-3"><a href="arima.html#cb52-3" tabindex="-1"></a>model1.summary()</span></code></pre></div>
<table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>    <td>155</td>  
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(0, 1, 1)</td> <th>  Log Likelihood     </th> <td>-570.040</td>
</tr>
<tr>
  <th>Date:</th>            <td>Mon, 19 Aug 2024</td> <th>  AIC                </th> <td>1144.080</td>
</tr>
<tr>
  <th>Time:</th>                <td>10:19:30</td>     <th>  BIC                </th> <td>1150.154</td>
</tr>
<tr>
  <th>Sample:</th>                  <td>0</td>        <th>  HQIC               </th> <td>1146.547</td>
</tr>
<tr>
  <th></th>                      <td> - 155</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ma.L1</th>  <td>   -0.9050</td> <td>    0.036</td> <td>  -25.036</td> <td> 0.000</td> <td>   -0.976</td> <td>   -0.834</td>
</tr>
<tr>
  <th>sigma2</th> <td>   95.0278</td> <td>   10.416</td> <td>    9.123</td> <td> 0.000</td> <td>   74.612</td> <td>  115.443</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.05</td> <th>  Jarque-Bera (JB):  </th> <td>0.30</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.81</td> <th>  Prob(JB):          </th> <td>0.86</td>
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>2.10</td> <th>  Skew:              </th> <td>0.08</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.01</td> <th>  Kurtosis:          </th> <td>3.15</td>
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="arima.html#cb53-1" tabindex="-1"></a><span class="co"># Force d=0</span></span>
<span id="cb53-2"><a href="arima.html#cb53-2" tabindex="-1"></a>model2<span class="op">=</span>pm.auto_arima(max2, start_p<span class="op">=</span><span class="dv">0</span>,start_q<span class="op">=</span><span class="dv">0</span>,max_p<span class="op">=</span><span class="dv">5</span>,max_q<span class="op">=</span><span class="dv">5</span>,d<span class="op">=</span><span class="dv">0</span>,seasonal<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-3"><a href="arima.html#cb53-3" tabindex="-1"></a>model2.summary()</span></code></pre></div>
<table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>    <td>155</td>  
</tr>
<tr>
  <th>Model:</th>           <td>SARIMAX(1, 0, 1)</td> <th>  Log Likelihood     </th> <td>-574.278</td>
</tr>
<tr>
  <th>Date:</th>            <td>Mon, 19 Aug 2024</td> <th>  AIC                </th> <td>1156.556</td>
</tr>
<tr>
  <th>Time:</th>                <td>10:19:31</td>     <th>  BIC                </th> <td>1168.729</td>
</tr>
<tr>
  <th>Sample:</th>                  <td>0</td>        <th>  HQIC               </th> <td>1161.500</td>
</tr>
<tr>
  <th></th>                      <td> - 155</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>intercept</th> <td>   26.5825</td> <td>   20.863</td> <td>    1.274</td> <td> 0.203</td> <td>  -14.308</td> <td>   67.473</td>
</tr>
<tr>
  <th>ar.L1</th>     <td>    0.7082</td> <td>    0.228</td> <td>    3.103</td> <td> 0.002</td> <td>    0.261</td> <td>    1.156</td>
</tr>
<tr>
  <th>ma.L1</th>     <td>   -0.5717</td> <td>    0.281</td> <td>   -2.031</td> <td> 0.042</td> <td>   -1.123</td> <td>   -0.020</td>
</tr>
<tr>
  <th>sigma2</th>    <td>   97.3309</td> <td>   11.556</td> <td>    8.423</td> <td> 0.000</td> <td>   74.682</td> <td>  119.979</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.23</td> <th>  Jarque-Bera (JB):  </th> <td>2.12</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.63</td> <th>  Prob(JB):          </th> <td>0.35</td>
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>1.75</td> <th>  Skew:              </th> <td>0.29</td>
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.05</td> <th>  Kurtosis:          </th> <td>2.95</td>
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</div>
<div id="sas-code-for-armaarima" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> SAS Code for ARMA/ARIMA<a href="arima.html#sas-code-for-armaarima" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>AUGMENTED DICKEY-FULLER TESTING</em></p>
<p>proc arima data=Time.fpp_insurance plot=all;  
identify var=quotes nlag=10 stationarity=(adf=2);  
identify var=quotes(1) nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>CORRELATION FUNCTIONS</em><br />
</p>
<p><em>Notice no model statement!</em>  </p>
<p>proc arima data=Time.ar2 plot(unpack)=all;  
identify var=y nlag=10 outcov=Corr;  
estimate method=ML;  
run;
quit;</p>
<p><em>BUILDING AN AUTOREGRESSIVE MODEL</em></p>
<p><em>Fit an AR2 model</em>  </p>
<p>proc arima data=Time.AR2 plot=all;  
identify var=y nlag=10;  
estimate p=2 method=ML;  
run;
quit;  </p>
<p><em>Add another estimate statement</em>
proc arima data=Time.AR2 plot=all;
identify var=y nlag=10;
estimate p=(2) method=ML;
estimate p=(1,2,4) method=ML;
run;
quit;  </p>
<p><em>BUILDING A MOVING AVERAGE MODEL</em></p>
<p>proc arima data=Time.ma2;  
identify var=x;  
estimate q=2 method=ML;  
run;
quit;  </p>
<p><em>Need to check for how to take care of trend</em></p>
<p>proc arima data=Time.Ebay9899 plot=all;  
identify var=DailyHigh nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>It is a random walk!! The way to model a random walk is by using differences</em>  </p>
<p>proc arima data=Time.Ebay9899 plot=all;  
identify var=DailyHigh(1) nlag=10 stationarity=(adf=2);  
run;
quit;</p>
<p><em>BUILDING AN AUTOREGRESSIVE MOVING AVERAGE MODEL</em>  
<em>(AUTOMATIC SELECTION TECHNIQUES)</em>  </p>
<p><em>Fit an ARIMA model</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 stationarity=(adf=2);  
run;
quit;  </p>
<p><em>Model identification with minimum information criterion (MINIC)</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 minic P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Model identification with smallest canonical correlation (SCAN);</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 scan P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Model identificaiton with extended sample autocorrelation function (ESACF)</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12 esacf P=(0:12) Q=(0:12);  
run;
quit;  </p>
<p><em>Create estimates with our ARIMA model p=2, q=3</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=12;  
estimate p=2 q=3 method=ML;  
run;
quit;</p>
<p><em>FORECASTING</em>  </p>
<p>proc arima data=Time.Hurricanes plot=all;  
identify var=MeanVMax nlag=10 ;  
estimate p=2 q=3 method=ML;  
forecast lead=10;  
run;
quit;</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exponential-smoothing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="seasonality.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sjsimmo2/TimeSeries/edit/master/03-ARIMA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sjsimmo2/TimeSeries/blob/master/03-ARIMA.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
