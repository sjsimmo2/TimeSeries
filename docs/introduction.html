<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Introduction | Time Series 1</title>
  <meta name="description" content="Chapter 2 Introduction | Time Series 1" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Introduction | Time Series 1" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Introduction | Time Series 1" />
  
  
  

<meta name="author" content="by Dr.Â Susan Simmons" />


<meta name="date" content="2025-08-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="exponential-smoothing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TimeSeries</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#other-plots"><i class="fa fa-check"></i><b>2.1</b> Other plots</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#time-series-decomposition"><i class="fa fa-check"></i><b>2.2</b> Time series decomposition</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#stl-features"><i class="fa fa-check"></i><b>2.3</b> STL features</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#missing-values"><i class="fa fa-check"></i><b>2.4</b> Missing values</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#python-code-and-results-for-time-series-plot"><i class="fa fa-check"></i><b>2.5</b> Python code and results for Time Series plot</a></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#sas-code-for-time-series-plot-and-decomposition"><i class="fa fa-check"></i><b>2.6</b> SAS code for time series plot and decomposition</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>3</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.1</b> Simple Exponential Smoothing</a></li>
<li class="chapter" data-level="3.2" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-esm"><i class="fa fa-check"></i><b>3.2</b> Holt ESM</a></li>
<li class="chapter" data-level="3.3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-winters"><i class="fa fa-check"></i><b>3.3</b> Holt-Winters</a></li>
<li class="chapter" data-level="3.4" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#comparing-forecasts"><i class="fa fa-check"></i><b>3.4</b> Comparing forecasts</a></li>
<li class="chapter" data-level="3.5" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#ets"><i class="fa fa-check"></i><b>3.5</b> ETS</a></li>
<li class="chapter" data-level="3.6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#python-code-for-exponential-smoothing"><i class="fa fa-check"></i><b>3.6</b> Python Code for Exponential Smoothing</a></li>
<li class="chapter" data-level="3.7" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#sas-code-for-exponential-smoothing-models"><i class="fa fa-check"></i><b>3.7</b> SAS Code for Exponential Smoothing Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#correlation-functions"><i class="fa fa-check"></i><b>4.2</b> Correlation Functions</a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#autoregressive-models-ar"><i class="fa fa-check"></i><b>4.3</b> AutoRegressive Models (AR)</a></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#moving-average-model-ma"><i class="fa fa-check"></i><b>4.4</b> Moving Average model (MA)</a></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#white-noise"><i class="fa fa-check"></i><b>4.5</b> White noise</a></li>
<li class="chapter" data-level="4.6" data-path="arima.html"><a href="arima.html#examples"><i class="fa fa-check"></i><b>4.6</b> Examples</a></li>
<li class="chapter" data-level="4.7" data-path="arima.html"><a href="arima.html#forecasting"><i class="fa fa-check"></i><b>4.7</b> Forecasting</a></li>
<li class="chapter" data-level="4.8" data-path="arima.html"><a href="arima.html#trend"><i class="fa fa-check"></i><b>4.8</b> Trend</a></li>
<li class="chapter" data-level="4.9" data-path="arima.html"><a href="arima.html#python-code-for-armaarima-models"><i class="fa fa-check"></i><b>4.9</b> Python Code for ARMA/ARIMA models</a></li>
<li class="chapter" data-level="4.10" data-path="arima.html"><a href="arima.html#sas-code-for-armaarima"><i class="fa fa-check"></i><b>4.10</b> SAS Code for ARMA/ARIMA</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="introduction" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Introduction<a href="introduction.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This document provides the code and output from Time Series. This is a living document and may be updated throughout the semester. First, here is a list of some the libraries that you will need:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="introduction.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="introduction.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb1-3"><a href="introduction.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb1-4"><a href="introduction.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(fabletools)</span>
<span id="cb1-5"><a href="introduction.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="introduction.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(expsmooth)</span>
<span id="cb1-7"><a href="introduction.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb1-8"><a href="introduction.html#cb1-8" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-9"><a href="introduction.html#cb1-9" tabindex="-1"></a><span class="fu">library</span>(seasonal)</span>
<span id="cb1-10"><a href="introduction.html#cb1-10" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="introduction.html#cb1-11" tabindex="-1"></a><span class="fu">library</span>(seasonalview)</span>
<span id="cb1-12"><a href="introduction.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(aTSA)</span>
<span id="cb1-13"><a href="introduction.html#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="introduction.html#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="introduction.html#cb1-15" tabindex="-1"></a><span class="do">### Note that the following packages and information is for Python:</span></span>
<span id="cb1-16"><a href="introduction.html#cb1-16" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb1-17"><a href="introduction.html#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="introduction.html#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="introduction.html#cb1-19" tabindex="-1"></a><span class="fu">use_python</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">ProgramData</span><span class="sc">\\</span><span class="st">Anaconda3</span><span class="sc">\\</span><span class="st">python.exe&quot;</span>)</span></code></pre></div>
<p>The data sets that you will need are as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="introduction.html#cb2-1" tabindex="-1"></a>file.dir <span class="ot">=</span> <span class="st">&quot;https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/&quot;</span> </span>
<span id="cb2-2"><a href="introduction.html#cb2-2" tabindex="-1"></a>input.file1 <span class="ot">=</span> <span class="st">&quot;usairlines.csv&quot;</span></span>
<span id="cb2-3"><a href="introduction.html#cb2-3" tabindex="-1"></a>input.file2 <span class="ot">=</span> <span class="st">&quot;steel.csv&quot;</span></span>
<span id="cb2-4"><a href="introduction.html#cb2-4" tabindex="-1"></a>input.file3 <span class="ot">=</span> <span class="st">&quot;leadyear2.csv&quot;</span></span>
<span id="cb2-5"><a href="introduction.html#cb2-5" tabindex="-1"></a>input.file4 <span class="ot">=</span> <span class="st">&quot;ebay9899.csv&quot;</span></span>
<span id="cb2-6"><a href="introduction.html#cb2-6" tabindex="-1"></a>input.file5 <span class="ot">=</span> <span class="st">&quot;fpp_insurance.csv&quot;</span> </span>
<span id="cb2-7"><a href="introduction.html#cb2-7" tabindex="-1"></a>input.file6 <span class="ot">=</span> <span class="st">&quot;ar2.csv&quot;</span></span>
<span id="cb2-8"><a href="introduction.html#cb2-8" tabindex="-1"></a>input.file7 <span class="ot">=</span> <span class="st">&quot;MA2.csv&quot;</span></span>
<span id="cb2-9"><a href="introduction.html#cb2-9" tabindex="-1"></a>input.file8 <span class="ot">=</span> <span class="st">&quot;hurrican.csv&quot;</span></span>
<span id="cb2-10"><a href="introduction.html#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="introduction.html#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="introduction.html#cb2-12" tabindex="-1"></a>USAirlines <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file1,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-13"><a href="introduction.html#cb2-13" tabindex="-1"></a>Steel <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file2, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-14"><a href="introduction.html#cb2-14" tabindex="-1"></a>Lead.Year <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file3, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-15"><a href="introduction.html#cb2-15" tabindex="-1"></a>Ebay <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file4, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-16"><a href="introduction.html#cb2-16" tabindex="-1"></a>Quotes<span class="ot">=</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file5, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-17"><a href="introduction.html#cb2-17" tabindex="-1"></a>Y<span class="ot">=</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file6, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-18"><a href="introduction.html#cb2-18" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file7, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-19"><a href="introduction.html#cb2-19" tabindex="-1"></a>hurricane<span class="ot">=</span><span class="fu">read_csv</span>(<span class="fu">paste</span>(file.dir, input.file8, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),<span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-20"><a href="introduction.html#cb2-20" tabindex="-1"></a>temp<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 2017 - Time Series</span><span class="sc">\\</span><span class="st">DataR</span><span class="sc">\\</span><span class="st">minntemp.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>For most of the applications we will be using, you will first need to create a tsibble. In order to create a tsibble, you need to have a column that identifies the date (which we will indicate with âindexâ). The code below creates tsibble for the Steel data set and the Minneapolis temperature data set and plots the data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="introduction.html#cb3-1" tabindex="-1"></a>Steel <span class="ot">&lt;-</span> Steel <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;1932-07-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;1980-01-01&#39;</span>),<span class="at">by=</span><span class="st">&#39;6 months&#39;</span>))</span>
<span id="cb3-2"><a href="introduction.html#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="introduction.html#cb3-3" tabindex="-1"></a>steel_ts<span class="ot">&lt;-</span>Steel <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Month=</span><span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>Month)</span>
<span id="cb3-4"><a href="introduction.html#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="introduction.html#cb3-5" tabindex="-1"></a><span class="fu">autoplot</span>(steel_ts,steelshp) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">&quot;Iron and Steel Exports&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Weight in tons&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Export&quot;</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Time%20Series%20object-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="introduction.html#cb4-1" tabindex="-1"></a>temp_ts<span class="ot">&lt;-</span>temp <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">&#39;1900-01-01&#39;</span>),<span class="fu">ymd</span>(<span class="st">&#39;1966-03-01&#39;</span>),<span class="at">by=</span><span class="st">&#39;months&#39;</span>)) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Month=</span><span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>Month)</span>
<span id="cb4-2"><a href="introduction.html#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="introduction.html#cb4-3" tabindex="-1"></a><span class="fu">autoplot</span>(temp_ts,Temp) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Minneapolis temperature&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Temperature&quot;</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Time%20Series%20object-2.png" width="672" /></p>
<p>Another example of creating a tsibble and time plot with the US Airlines data set:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="introduction.html#cb5-1" tabindex="-1"></a>USAirlines_ts <span class="ot">&lt;-</span> USAirlines <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">myd</span>(<span class="fu">paste</span>(Month, Year, <span class="st">&quot;1&quot;</span>))) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Month2=</span><span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index=</span>Month2)</span>
<span id="cb5-2"><a href="introduction.html#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="introduction.html#cb5-3" tabindex="-1"></a><span class="fu">autoplot</span>(USAirlines_ts,Passengers)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/ts2-1.png" width="672" /></p>
<div id="other-plots" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Other plots<a href="introduction.html#other-plots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some other interesting plots we can look at is the seasonal plot (only if our time series has a seasonal componentâ¦.if you have yearly data, this is not possible since each line in the graph represents one year).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="introduction.html#cb6-1" tabindex="-1"></a>USAirlines_ts <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="introduction.html#cb6-2" tabindex="-1"></a>  <span class="fu">gg_season</span>(Passengers, <span class="at">labels =</span> <span class="st">&quot;both&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="introduction.html#cb6-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Passengers&quot;</span>,</span>
<span id="cb6-4"><a href="introduction.html#cb6-4" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Seasonal plot: US Airline Passengers&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>We can further explore seasonal patterns by a subseries plot (again ONLY if there is a seasonal component):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="introduction.html#cb7-1" tabindex="-1"></a>USAirlines_ts <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="introduction.html#cb7-2" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Passengers) <span class="sc">+</span></span>
<span id="cb7-3"><a href="introduction.html#cb7-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-4"><a href="introduction.html#cb7-4" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Passengers&quot;</span>,</span>
<span id="cb7-5"><a href="introduction.html#cb7-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;US Airline Passengers&quot;</span></span>
<span id="cb7-6"><a href="introduction.html#cb7-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="time-series-decomposition" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Time series decomposition<a href="introduction.html#time-series-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If your time series has a seasonal component to it, a useful visualization is the decomposition. We will first look at the STL decomposition (which can only do the additive decomposition, NOT multiplicative!). The following code creates the decomposition and then plots it:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="introduction.html#cb8-1" tabindex="-1"></a><span class="co"># Time Series Decomposition ...STL#</span></span>
<span id="cb8-2"><a href="introduction.html#cb8-2" tabindex="-1"></a>dcmp <span class="ot">&lt;-</span> USAirlines_ts <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="introduction.html#cb8-3" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(Passengers))</span>
<span id="cb8-4"><a href="introduction.html#cb8-4" tabindex="-1"></a><span class="fu">components</span>(dcmp)</span></code></pre></div>
<pre><code>## # A dable: 219 x 7 [1M]
## # Key:     .model [1]
## # :        Passengers = trend + season_year + remainder
##    .model   Month2 Passengers  trend season_year remainder season_adjust
##    &lt;chr&gt;     &lt;mth&gt;      &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 stl    1990 Jan      34348 39033.      -4676.     -8.97        39024.
##  2 stl    1990 Feb      33536 38897.      -5842.    481.          39378.
##  3 stl    1990 Mar      40578 38762.       1238.    578.          39340.
##  4 stl    1990 Apr      38267 38626.       -563.    204.          38830.
##  5 stl    1990 May      38249 38494.        378.   -623.          37871.
##  6 stl    1990 Jun      40792 38362.       2950.   -519.          37842.
##  7 stl    1990 Jul      42225 38229.       5219.  -1223.          37006.
##  8 stl    1990 Aug      44943 38090.       6551.    302.          38392.
##  9 stl    1990 Sep      35708 37951.      -1956.   -287.          37664.
## 10 stl    1990 Oct      38286 37812.        345.    129.          37941.
## # â¹ 209 more rows</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="introduction.html#cb10-1" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/decomposition-1.png" width="672" /></p>
<p>We can visualize the time plot with the trend component overlaid with it:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="introduction.html#cb11-1" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="introduction.html#cb11-2" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="introduction.html#cb11-3" tabindex="-1"></a>  <span class="fu">autoplot</span>(Passengers, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="introduction.html#cb11-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>trend), <span class="at">colour =</span> <span class="st">&quot;#D55E00&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="introduction.html#cb11-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-6"><a href="introduction.html#cb11-6" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Passengers&quot;</span>,</span>
<span id="cb11-7"><a href="introduction.html#cb11-7" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;US Airline Passengers with trend overlaid&quot;</span></span>
<span id="cb11-8"><a href="introduction.html#cb11-8" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/overlay%20trend-1.png" width="672" /></p>
<p>We can also overlay plots with the seasonally adjusted values (plot below has both trend and seasonally adjusted overlaid):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="introduction.html#cb12-1" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="introduction.html#cb12-2" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="introduction.html#cb12-3" tabindex="-1"></a>  <span class="fu">autoplot</span>(Passengers, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="introduction.html#cb12-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>season_adjust), <span class="at">colour =</span> <span class="st">&quot;#D55E00&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="introduction.html#cb12-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-6"><a href="introduction.html#cb12-6" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Passengers&quot;</span>,</span>
<span id="cb12-7"><a href="introduction.html#cb12-7" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;US Airline Passengers with seasonally adjusted overlaid&quot;</span></span>
<span id="cb12-8"><a href="introduction.html#cb12-8" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/seasonally%20adjusted-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="introduction.html#cb13-1" tabindex="-1"></a><span class="do">## Both</span></span>
<span id="cb13-2"><a href="introduction.html#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="introduction.html#cb13-3" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="introduction.html#cb13-4" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="introduction.html#cb13-5" tabindex="-1"></a>  <span class="fu">autoplot</span>(Passengers, <span class="at">colour=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="introduction.html#cb13-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>season_adjust), <span class="at">colour =</span> <span class="st">&quot;#D55E00&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="introduction.html#cb13-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>trend),<span class="at">colour=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-8"><a href="introduction.html#cb13-8" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-9"><a href="introduction.html#cb13-9" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Passengers&quot;</span>,</span>
<span id="cb13-10"><a href="introduction.html#cb13-10" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;US Airline Passengers &quot;</span></span>
<span id="cb13-11"><a href="introduction.html#cb13-11" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/seasonally%20adjusted-2.png" width="672" /></p>
<p>Notice that the trend component is VERY similar to the âseasonally adjustedâ data! Do you know what the difference between the lines are?</p>
<p>We can also do a classical decomposition (this can do an additive decomposition and a multiplicative decompositionâ¦just change type = âmultiplicativeâ to do a multiplicative decomposition).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="introduction.html#cb14-1" tabindex="-1"></a>USAirlines_ts <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="introduction.html#cb14-2" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb14-3"><a href="introduction.html#cb14-3" tabindex="-1"></a>    <span class="fu">classical_decomposition</span>(Passengers, <span class="at">type =</span> <span class="st">&quot;additive&quot;</span>)</span>
<span id="cb14-4"><a href="introduction.html#cb14-4" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="introduction.html#cb14-5" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="introduction.html#cb14-6" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb14-7"><a href="introduction.html#cb14-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Classical additive decomposition of US Airline Passengers&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/classical-1.png" width="672" /></p>
<p>The last decomposition we will look at is the X11 decomposition (done by the government). This is a very complex algorithm that does the decomposition.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="introduction.html#cb16-1" tabindex="-1"></a>x11_dcmp <span class="ot">&lt;-</span> USAirlines_ts <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="introduction.html#cb16-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">x11 =</span> <span class="fu">X_13ARIMA_SEATS</span>(Passengers <span class="sc">~</span> <span class="fu">x11</span>())) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="introduction.html#cb16-3" tabindex="-1"></a>  <span class="fu">components</span>()</span>
<span id="cb16-4"><a href="introduction.html#cb16-4" tabindex="-1"></a><span class="fu">autoplot</span>(x11_dcmp) <span class="sc">+</span></span>
<span id="cb16-5"><a href="introduction.html#cb16-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span></span>
<span id="cb16-6"><a href="introduction.html#cb16-6" tabindex="-1"></a>    <span class="st">&quot;Decomposition of US Airline Passengers using X-11.&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="stl-features" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> STL features<a href="introduction.html#stl-features" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can also look at the strength of the trend and seasonal components in with a STL decomposition:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="introduction.html#cb17-1" tabindex="-1"></a>USAirlines_ts <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="introduction.html#cb17-2" tabindex="-1"></a>  <span class="fu">features</span>(Passengers, feat_stl)</span></code></pre></div>
<pre><code>## # A tibble: 1 Ã 9
##   trend_strength seasonal_strength_year seasonal_peak_year seasonal_trough_year
##            &lt;dbl&gt;                  &lt;dbl&gt;              &lt;dbl&gt;                &lt;dbl&gt;
## 1          0.976                  0.919                  7                    2
## # â¹ 5 more variables: spikiness &lt;dbl&gt;, linearity &lt;dbl&gt;, curvature &lt;dbl&gt;,
## #   stl_e_acf1 &lt;dbl&gt;, stl_e_acf10 &lt;dbl&gt;</code></pre>
</div>
<div id="missing-values" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Missing values<a href="introduction.html#missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We actually need to put the series in the OLD format to use the package imputeTS (will probably get updated, just not yet). We will illustrate this with the US Airlines data set (but first we need to create the missing values).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="introduction.html#cb19-1" tabindex="-1"></a><span class="do">#### Make some missing values:</span></span>
<span id="cb19-2"><a href="introduction.html#cb19-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19076</span>)</span>
<span id="cb19-3"><a href="introduction.html#cb19-3" tabindex="-1"></a>miss_val<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(USAirlines),<span class="dv">30</span>,<span class="at">replace=</span>F)</span>
<span id="cb19-4"><a href="introduction.html#cb19-4" tabindex="-1"></a>miss_val<span class="ot">&lt;-</span><span class="fu">c</span>(miss_val,<span class="dv">102</span>,<span class="dv">104</span><span class="sc">:</span><span class="dv">107</span>)</span>
<span id="cb19-5"><a href="introduction.html#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="introduction.html#cb19-6" tabindex="-1"></a>US_temp<span class="ot">&lt;-</span>USAirlines</span>
<span id="cb19-7"><a href="introduction.html#cb19-7" tabindex="-1"></a>US_temp<span class="sc">$</span>Passengers[miss_val]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb19-8"><a href="introduction.html#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="introduction.html#cb19-9" tabindex="-1"></a>col_vector<span class="ot">=</span><span class="fu">rep</span>(<span class="st">&quot;blue&quot;</span>,<span class="fu">nrow</span>(USAirlines))</span>
<span id="cb19-10"><a href="introduction.html#cb19-10" tabindex="-1"></a>col_vector[miss_val]<span class="ot">=</span><span class="st">&quot;red&quot;</span></span>
<span id="cb19-11"><a href="introduction.html#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="introduction.html#cb19-12" tabindex="-1"></a><span class="do">### Create ts using the old way:</span></span>
<span id="cb19-13"><a href="introduction.html#cb19-13" tabindex="-1"></a><span class="fu">library</span>(imputeTS)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;imputeTS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:zoo&#39;:
## 
##     na.locf</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="introduction.html#cb22-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb22-2"><a href="introduction.html#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="introduction.html#cb22-3" tabindex="-1"></a>Pass_miss<span class="ot">&lt;-</span><span class="fu">ts</span>(US_temp<span class="sc">$</span>Passengers,<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">1</span>),<span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb22-4"><a href="introduction.html#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="introduction.html#cb22-5" tabindex="-1"></a><span class="fu">ggplot_na_distribution</span>(Pass_miss)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;US Airline Passengers&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="introduction.html#cb23-1" tabindex="-1"></a><span class="co"># Interpolate the missing observations in this data set</span></span>
<span id="cb23-2"><a href="introduction.html#cb23-2" tabindex="-1"></a>Pass_impute<span class="ot">&lt;-</span>Pass_miss <span class="sc">%&gt;%</span> <span class="fu">na_interpolation</span>(<span class="at">option =</span> <span class="st">&quot;spline&quot;</span>)</span>
<span id="cb23-3"><a href="introduction.html#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="introduction.html#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="introduction.html#cb23-5" tabindex="-1"></a><span class="fu">autoplot</span>(Pass_impute,<span class="at">color=</span>col_vector) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Airline Passengers&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="introduction.html#cb24-1" tabindex="-1"></a>Pass_impute<span class="ot">&lt;-</span>Pass_miss <span class="sc">%&gt;%</span> <span class="fu">na_seadec</span>(<span class="at">algorithm =</span> <span class="st">&quot;interpolation&quot;</span>)</span>
<span id="cb24-2"><a href="introduction.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="introduction.html#cb24-3" tabindex="-1"></a><span class="fu">autoplot</span>(Pass_impute,<span class="at">color=</span>col_vector) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Airline Passengers&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-5-3.png" width="672" /></p>
</div>
<div id="python-code-and-results-for-time-series-plot" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Python code and results for Time Series plot<a href="introduction.html#python-code-and-results-for-time-series-plot" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following code shows the time series plot and classical decomposition (using additive model).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="introduction.html#cb25-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-2"><a href="introduction.html#cb25-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-3"><a href="introduction.html#cb25-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-4"><a href="introduction.html#cb25-4" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb25-5"><a href="introduction.html#cb25-5" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb25-6"><a href="introduction.html#cb25-6" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> STL</span>
<span id="cb25-7"><a href="introduction.html#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="introduction.html#cb25-8" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb25-9"><a href="introduction.html#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="introduction.html#cb25-10" tabindex="-1"></a>usair_p<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">usairlines.csv&quot;</span>)</span>
<span id="cb25-11"><a href="introduction.html#cb25-11" tabindex="-1"></a>df<span class="op">=</span>pd.date_range(start<span class="op">=</span><span class="st">&#39;1/1/1990&#39;</span>, end<span class="op">=</span><span class="st">&#39;3/1/2008&#39;</span>, freq<span class="op">=</span><span class="st">&#39;MS&#39;</span>)</span>
<span id="cb25-12"><a href="introduction.html#cb25-12" tabindex="-1"></a>usair_p.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb25-13"><a href="introduction.html#cb25-13" tabindex="-1"></a></span>
<span id="cb25-14"><a href="introduction.html#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="introduction.html#cb25-15" tabindex="-1"></a></span>
<span id="cb25-16"><a href="introduction.html#cb25-16" tabindex="-1"></a>plt.plot(usair_p[<span class="st">&quot;Passengers&quot;</span>])</span>
<span id="cb25-17"><a href="introduction.html#cb25-17" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Date&quot;</span>)</span>
<span id="cb25-18"><a href="introduction.html#cb25-18" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Passengers&quot;</span>)</span>
<span id="cb25-19"><a href="introduction.html#cb25-19" tabindex="-1"></a>plt.title(<span class="st">&quot;Airline Passengers&quot;</span>)</span>
<span id="cb25-20"><a href="introduction.html#cb25-20" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="introduction.html#cb26-1" tabindex="-1"></a><span class="co">## Classical Decomposition</span></span>
<span id="cb26-2"><a href="introduction.html#cb26-2" tabindex="-1"></a>result <span class="op">=</span> seasonal_decompose(usair_p[<span class="st">&quot;Passengers&quot;</span>], model<span class="op">=</span><span class="st">&#39;additive&#39;</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-3"><a href="introduction.html#cb26-3" tabindex="-1"></a>result.plot()</span>
<span id="cb26-4"><a href="introduction.html#cb26-4" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<p>You can also specify multiplicative by changing âadditiveâ to âmultiplicativeâ in the Python code. If you want to do the STL decomposition, then you can apply the following code:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="introduction.html#cb27-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="introduction.html#cb27-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-3"><a href="introduction.html#cb27-3" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb27-4"><a href="introduction.html#cb27-4" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb27-5"><a href="introduction.html#cb27-5" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> STL</span>
<span id="cb27-6"><a href="introduction.html#cb27-6" tabindex="-1"></a>usair_p<span class="op">=</span>pd.read_csv(<span class="st">&quot;Q:</span><span class="ch">\\</span><span class="st">My Drive</span><span class="ch">\\</span><span class="st">Fall 2017 - Time Series</span><span class="ch">\\</span><span class="st">DataR</span><span class="ch">\\</span><span class="st">usairlines.csv&quot;</span>)</span>
<span id="cb27-7"><a href="introduction.html#cb27-7" tabindex="-1"></a>df<span class="op">=</span>pd.date_range(start<span class="op">=</span><span class="st">&#39;1/1/1990&#39;</span>, end<span class="op">=</span><span class="st">&#39;3/1/2008&#39;</span>, freq<span class="op">=</span><span class="st">&#39;MS&#39;</span>)</span>
<span id="cb27-8"><a href="introduction.html#cb27-8" tabindex="-1"></a>usair_p.index<span class="op">=</span>pd.to_datetime(df)</span>
<span id="cb27-9"><a href="introduction.html#cb27-9" tabindex="-1"></a></span>
<span id="cb27-10"><a href="introduction.html#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="introduction.html#cb27-11" tabindex="-1"></a><span class="co">## STL Decomposition</span></span>
<span id="cb27-12"><a href="introduction.html#cb27-12" tabindex="-1"></a></span>
<span id="cb27-13"><a href="introduction.html#cb27-13" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> MSTL</span>
<span id="cb27-14"><a href="introduction.html#cb27-14" tabindex="-1"></a></span>
<span id="cb27-15"><a href="introduction.html#cb27-15" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: usair_p.index, <span class="st">&#39;y&#39;</span>: usair_p[<span class="st">&#39;Passengers&#39;</span>]}</span>
<span id="cb27-16"><a href="introduction.html#cb27-16" tabindex="-1"></a>usair_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d)</span>
<span id="cb27-17"><a href="introduction.html#cb27-17" tabindex="-1"></a></span>
<span id="cb27-18"><a href="introduction.html#cb27-18" tabindex="-1"></a>dcmp <span class="op">=</span> StatsForecast(models <span class="op">=</span> [MSTL(season_length <span class="op">=</span> <span class="dv">12</span>)], freq <span class="op">=</span> <span class="st">&#39;M&#39;</span>)</span>
<span id="cb27-19"><a href="introduction.html#cb27-19" tabindex="-1"></a>dcmp.fit(df <span class="op">=</span> usair_sf)</span></code></pre></div>
<pre><code>## StatsForecast(models=[MSTL])</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="introduction.html#cb29-1" tabindex="-1"></a>result <span class="op">=</span> dcmp.fitted_[<span class="dv">0</span>,<span class="dv">0</span>].model_</span>
<span id="cb29-2"><a href="introduction.html#cb29-2" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>##         data         trend     seasonal    remainder
## 0    34348.0  39019.259582 -4656.824185   -14.435397
## 1    33536.0  38883.032235 -5824.359162   477.326927
## 2    40578.0  38749.492861  1252.473058   576.034080
## 3    38267.0  38618.252549  -554.514256   203.261707
## 4    38249.0  38488.211906   388.629101  -627.841007
## ..       ...           ...          ...          ...
## 214  61967.0  64483.390709 -2942.503405   426.112696
## 215  60907.0  64538.640065 -1897.489966 -1734.150099
## 216  57800.0  64584.717962 -6231.124988  -553.592974
## 217  57109.0  64621.674775 -7705.357902   192.683127
## 218  67818.0  64650.268751  3776.567142  -608.835893
## 
## [219 rows x 4 columns]</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="introduction.html#cb31-1" tabindex="-1"></a>dcmp.fitted_[<span class="dv">0</span>, <span class="dv">0</span>].model_.plot(subplots<span class="op">=</span><span class="va">True</span>, grid<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>## array([&lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;], dtype=object)</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="introduction.html#cb33-1" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb33-2"><a href="introduction.html#cb33-2" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/STL%20decomposition-5.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="introduction.html#cb34-1" tabindex="-1"></a><span class="co">## The following code calculates the Fs and Ft (many thanks to Fred!)</span></span>
<span id="cb34-2"><a href="introduction.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="introduction.html#cb34-3" tabindex="-1"></a>data <span class="op">=</span> usair_p[<span class="st">&quot;Passengers&quot;</span>]</span>
<span id="cb34-4"><a href="introduction.html#cb34-4" tabindex="-1"></a><span class="co"># Perform STL decomposition</span></span>
<span id="cb34-5"><a href="introduction.html#cb34-5" tabindex="-1"></a>stl <span class="op">=</span> STL(data, period<span class="op">=</span><span class="dv">12</span>)  <span class="co"># Adjust period as needed for your data</span></span>
<span id="cb34-6"><a href="introduction.html#cb34-6" tabindex="-1"></a>result <span class="op">=</span> stl.fit()</span>
<span id="cb34-7"><a href="introduction.html#cb34-7" tabindex="-1"></a><span class="co"># Extract components</span></span>
<span id="cb34-8"><a href="introduction.html#cb34-8" tabindex="-1"></a>trend <span class="op">=</span> result.trend</span>
<span id="cb34-9"><a href="introduction.html#cb34-9" tabindex="-1"></a>seasonal <span class="op">=</span> result.seasonal</span>
<span id="cb34-10"><a href="introduction.html#cb34-10" tabindex="-1"></a>residual <span class="op">=</span> result.resid</span>
<span id="cb34-11"><a href="introduction.html#cb34-11" tabindex="-1"></a>t_and_r <span class="op">=</span> trend <span class="op">+</span> residual</span>
<span id="cb34-12"><a href="introduction.html#cb34-12" tabindex="-1"></a><span class="co"># Ensure all series are aligned</span></span>
<span id="cb34-13"><a href="introduction.html#cb34-13" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> trend.empty <span class="kw">and</span> <span class="kw">not</span> residual.empty <span class="kw">and</span> <span class="kw">not</span> seasonal.empty:</span>
<span id="cb34-14"><a href="introduction.html#cb34-14" tabindex="-1"></a>    <span class="co"># Calculate Trend Strength</span></span>
<span id="cb34-15"><a href="introduction.html#cb34-15" tabindex="-1"></a>    var_residual <span class="op">=</span> residual.var()</span>
<span id="cb34-16"><a href="introduction.html#cb34-16" tabindex="-1"></a>    var_t_plus_r <span class="op">=</span> t_and_r.var()</span>
<span id="cb34-17"><a href="introduction.html#cb34-17" tabindex="-1"></a>    var_detrended <span class="op">=</span> (data <span class="op">-</span> trend).var()</span>
<span id="cb34-18"><a href="introduction.html#cb34-18" tabindex="-1"></a>    <span class="cf">if</span> var_detrended <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb34-19"><a href="introduction.html#cb34-19" tabindex="-1"></a>        trend_strength <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb34-20"><a href="introduction.html#cb34-20" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Trend Strength: 0 (Detrended variance is zero)&quot;</span>)</span>
<span id="cb34-21"><a href="introduction.html#cb34-21" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-22"><a href="introduction.html#cb34-22" tabindex="-1"></a>        trend_strength <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (var_residual <span class="op">/</span> var_t_plus_r)</span>
<span id="cb34-23"><a href="introduction.html#cb34-23" tabindex="-1"></a>        trend_strength <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, trend_strength)  <span class="co"># Avoid negative strength</span></span>
<span id="cb34-24"><a href="introduction.html#cb34-24" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Trend Strength: </span><span class="sc">{</span>trend_strength<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb34-25"><a href="introduction.html#cb34-25" tabindex="-1"></a>    <span class="co"># Calculate Seasonal Strength</span></span>
<span id="cb34-26"><a href="introduction.html#cb34-26" tabindex="-1"></a>    var_seasonal <span class="op">=</span> seasonal.var()</span>
<span id="cb34-27"><a href="introduction.html#cb34-27" tabindex="-1"></a>    <span class="cf">if</span> var_detrended <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb34-28"><a href="introduction.html#cb34-28" tabindex="-1"></a>        seasonal_strength <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb34-29"><a href="introduction.html#cb34-29" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Seasonal Strength: 0 (Detrended variance is zero)&quot;</span>)</span>
<span id="cb34-30"><a href="introduction.html#cb34-30" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-31"><a href="introduction.html#cb34-31" tabindex="-1"></a>        seasonal_strength <span class="op">=</span> var_seasonal <span class="op">/</span> var_detrended</span>
<span id="cb34-32"><a href="introduction.html#cb34-32" tabindex="-1"></a>        seasonal_strength <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, seasonal_strength)  <span class="co"># Avoid negative strength</span></span>
<span id="cb34-33"><a href="introduction.html#cb34-33" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Seasonal Strength: </span><span class="sc">{</span>seasonal_strength<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb34-34"><a href="introduction.html#cb34-34" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb34-35"><a href="introduction.html#cb34-35" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Trend, Seasonal, or Residual series is empty or misaligned.&quot;</span>)</span></code></pre></div>
<pre><code>## Trend Strength: 0.98
## Seasonal Strength: 0.92</code></pre>
</div>
<div id="sas-code-for-time-series-plot-and-decomposition" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> SAS code for time series plot and decomposition<a href="introduction.html#sas-code-for-time-series-plot-and-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following code is in SAS (creates the time series plot and the decompositionâ¦which is the next section). The use of the id statement can only be used if the series has a properly formatted date column. Great thing about SAS is that if there is a missing value (or missing date), it will impute it for you. It can also aggregate easily in SAS. If you do not have a date column, you can still use this command, you will use seasonality = and then set the length of the season. However, if you use the seasonality option, SAS will not recognize missing dates.</p>
<p><em>Create library for data sets</em> Â </p>
<p>libname Time âQ:Drive - Time Seriesâ; Â 
run; Â </p>
<p><em>Time series plot and decomposition of Airline Passengers</em> Â </p>
<p>proc timeseries data=Time.USAirlines plots=(series decomp sc); Â 
id date interval=month; Â 
var Passengers; Â 
run; Â </p>
<p><em>Time series and decomposition of Airline Passengers, but now the seasonal cycle is set to a year</em> Â </p>
<p>proc timeseries data=Time.USAirlines plots=(series decomp sc) seasonality=12; Â 
var Passengers; Â 
run; Â </p>
<p>proc timeseries data=Time.Steel plots=(series decomp sc) seasonality=12; Â 
var steelshp; Â 
run; Â </p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exponential-smoothing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/sjsimmo2/TimeSeries/edit/master/01-Introduction.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/sjsimmo2/TimeSeries/blob/master/01-Introduction.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
