<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Time series decomposition | Time Series 1</title>
  <meta name="description" content="Chapter 4 Time series decomposition | Time Series 1" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Time series decomposition | Time Series 1" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Time series decomposition | Time Series 1" />
  
  
  

<meta name="author" content="by Dr. Susan Simmons" />


<meta name="date" content="2022-08-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started.html"/>
<link rel="next" href="a-caucus-race-and-a-long-tale.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SHORT TITLE HERE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series 1</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>3</b> Getting Started</a></li>
<li class="chapter" data-level="4" data-path="time-series-decomposition.html"><a href="time-series-decomposition.html"><i class="fa fa-check"></i><b>4</b> Time series decomposition</a>
<ul>
<li class="chapter" data-level="4.1" data-path="time-series-decomposition.html"><a href="time-series-decomposition.html#self-study"><i class="fa fa-check"></i><b>4.1</b> Self-study</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-caucus-race-and-a-long-tale.html"><a href="a-caucus-race-and-a-long-tale.html"><i class="fa fa-check"></i><b>5</b> A caucus-race and a long tale</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series-decomposition" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Time series decomposition<a href="time-series-decomposition.html#time-series-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>IF your time series has a seasonal component to it, a useful visualization is the decomposition. We will be using the STL decomposition (which can only do the additive decomposition, NOT multiplicative!). The following code creates the decomposition and then plots it:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="time-series-decomposition.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time Series Decomposition ...STL#</span></span>
<span id="cb8-2"><a href="time-series-decomposition.html#cb8-2" aria-hidden="true" tabindex="-1"></a>decomp_stl <span class="ot">&lt;-</span> <span class="fu">stl</span>(Passenger, <span class="at">s.window =</span> <span class="dv">7</span>)</span>
<span id="cb8-3"><a href="time-series-decomposition.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="time-series-decomposition.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the individual components of the time series</span></span>
<span id="cb8-5"><a href="time-series-decomposition.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(decomp_stl)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/decomposition-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="time-series-decomposition.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(decomp_stl)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/decomposition-2.png" width="672" /></p>
<p>You can pull off the different components (Seasonal, Trend or Remainder). The below command provides the first few rows of the decomposition (you can see what information is contained within the decomposition…season, trend and remainder).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="time-series-decomposition.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(decomp_stl<span class="sc">$</span>time.series)</span></code></pre></div>
<pre><code>##            seasonal    trend remainder
## Jan 1990 -4526.7610 39081.77 -207.0131
## Feb 1990 -5827.5592 38942.75  420.8128
## Mar 1990   560.4986 38803.72 1213.7829
## Apr 1990  -802.2312 38664.69  404.5406
## May 1990   139.2095 38533.15 -423.3574
## Jun 1990  2953.8857 38401.61 -563.4910</code></pre>
<p>Which means we can overlay the original data with the trend component (which is the second column.)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="time-series-decomposition.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(Passenger)<span class="sc">+</span><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>decomp_stl<span class="sc">$</span>time.series[,<span class="dv">2</span>]),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/overlay%20trend-1.png" width="672" /></p>
<p>Notice that the trend component is VERY similar to the “seasonally adjusted” data! Do you know what the difference between the two series is?</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="time-series-decomposition.html#cb13-1" aria-hidden="true" tabindex="-1"></a>seas_adj<span class="ot">=</span>Passenger<span class="sc">-</span>decomp_stl<span class="sc">$</span>time.series[,<span class="dv">1</span>]</span>
<span id="cb13-2"><a href="time-series-decomposition.html#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="time-series-decomposition.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(Passenger) <span class="sc">+</span></span>
<span id="cb13-4"><a href="time-series-decomposition.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>decomp_stl<span class="sc">$</span>time.series[,<span class="dv">2</span>]),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="time-series-decomposition.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>seas_adj),<span class="at">color=</span><span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/seasonally%20adjusted-1.png" width="672" /></p>
<p>Another interesting plot is the subseries plot. This looks at the individual series (in this case, the series for January, the series for February, etc….).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="time-series-decomposition.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal subseries by months</span></span>
<span id="cb14-2"><a href="time-series-decomposition.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(Passenger)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/subseries-1.png" width="672" />
Just a quick note. STL ONLY does additive seasonal decomposition. There is a decompose library that will do both additive AND multiplicative decomposition.</p>
<div id="self-study" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Self-study<a href="time-series-decomposition.html#self-study" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here is something to get you started if you want to take a look at the X13 decomposition!</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="time-series-decomposition.html#cb15-1" aria-hidden="true" tabindex="-1"></a>decomp_x13<span class="ot">=</span><span class="fu">seas</span>(Passenger)</span>
<span id="cb15-2"><a href="time-series-decomposition.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(decomp_x13)</span></code></pre></div>
<pre><code>## 
## Call:
## seas(x = Passenger)
## 
## Coefficients:
##                     Estimate Std. Error z value Pr(&gt;|z|)    
## Leap Year          1.610e+03  4.003e+02   4.021 5.79e-05 ***
## Weekday            5.586e+01  1.890e+01   2.956  0.00312 ** 
## LS1992.Jun         4.006e+03  8.439e+02   4.747 2.07e-06 ***
## LS1992.Oct        -3.511e+03  8.409e+02  -4.176 2.97e-05 ***
## LS2001.Sep        -1.580e+04  8.633e+02 -18.296  &lt; 2e-16 ***
## LS2001.Nov         5.492e+03  8.629e+02   6.365 1.96e-10 ***
## AO2002.Dec         4.412e+03  8.402e+02   5.251 1.51e-07 ***
## MA-Nonseasonal-01  5.073e-01  5.991e-02   8.468  &lt; 2e-16 ***
## MA-Seasonal-12     4.981e-01  6.133e-02   8.121 4.62e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## SEATS adj.  ARIMA: (0 1 1)(0 1 1)  Obs.: 219  Transform: none
## AICc:  3501, BIC:  3533  QS (no seasonality in final):    0  
## Box-Ljung (no autocorr.): 22.77   Shapiro (normality): 0.9914  
## Messages generated by X-13:
## Warnings:
## - At least one visually significant trading day peak has been
##   found in one or more of the estimated spectra.</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="time-series-decomposition.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Neat R shiny application....run OUTSIDE of RMarkdown</span></span>
<span id="cb17-2"><a href="time-series-decomposition.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#view(decomp_x13)</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-caucus-race-and-a-long-tale.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/edit/master/01-Introduction.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/blob/master/01-Introduction.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
