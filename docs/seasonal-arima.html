<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Seasonal ARIMA | Time Series 1</title>
  <meta name="description" content="Chapter 5 Seasonal ARIMA | Time Series 1" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Seasonal ARIMA | Time Series 1" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Seasonal ARIMA | Time Series 1" />
  
  
  

<meta name="author" content="by Dr. Susan Simmons" />


<meta name="date" content="2025-10-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="arima.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TimeSeries</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Time series</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#other-plots"><i class="fa fa-check"></i><b>2.1</b> Other plots</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#time-series-decomposition"><i class="fa fa-check"></i><b>2.2</b> Time series decomposition</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#stl-features"><i class="fa fa-check"></i><b>2.3</b> STL features</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#missing-values"><i class="fa fa-check"></i><b>2.4</b> Missing values</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#python-code-and-results-for-time-series-plot"><i class="fa fa-check"></i><b>2.5</b> Python code and results for Time Series plot</a></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#sas-code-for-time-series-plot-and-decomposition"><i class="fa fa-check"></i><b>2.6</b> SAS code for time series plot and decomposition</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html"><i class="fa fa-check"></i><b>3</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#simple-exponential-smoothing"><i class="fa fa-check"></i><b>3.1</b> Simple Exponential Smoothing</a></li>
<li class="chapter" data-level="3.2" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-esm"><i class="fa fa-check"></i><b>3.2</b> Holt ESM</a></li>
<li class="chapter" data-level="3.3" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#holt-winters"><i class="fa fa-check"></i><b>3.3</b> Holt-Winters</a></li>
<li class="chapter" data-level="3.4" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#comparing-forecasts"><i class="fa fa-check"></i><b>3.4</b> Comparing forecasts</a></li>
<li class="chapter" data-level="3.5" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#ets"><i class="fa fa-check"></i><b>3.5</b> ETS</a></li>
<li class="chapter" data-level="3.6" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#python-code-for-exponential-smoothing"><i class="fa fa-check"></i><b>3.6</b> Python Code for Exponential Smoothing</a></li>
<li class="chapter" data-level="3.7" data-path="exponential-smoothing.html"><a href="exponential-smoothing.html#sas-code-for-exponential-smoothing-models"><i class="fa fa-check"></i><b>3.7</b> SAS Code for Exponential Smoothing Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>4</b> ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arima.html"><a href="arima.html#stationarity"><i class="fa fa-check"></i><b>4.1</b> Stationarity</a></li>
<li class="chapter" data-level="4.2" data-path="arima.html"><a href="arima.html#correlation-functions"><i class="fa fa-check"></i><b>4.2</b> Correlation Functions</a></li>
<li class="chapter" data-level="4.3" data-path="arima.html"><a href="arima.html#autoregressive-models-ar"><i class="fa fa-check"></i><b>4.3</b> AutoRegressive Models (AR)</a></li>
<li class="chapter" data-level="4.4" data-path="arima.html"><a href="arima.html#moving-average-model-ma"><i class="fa fa-check"></i><b>4.4</b> Moving Average model (MA)</a></li>
<li class="chapter" data-level="4.5" data-path="arima.html"><a href="arima.html#white-noise"><i class="fa fa-check"></i><b>4.5</b> White noise</a></li>
<li class="chapter" data-level="4.6" data-path="arima.html"><a href="arima.html#examples"><i class="fa fa-check"></i><b>4.6</b> Examples</a></li>
<li class="chapter" data-level="4.7" data-path="arima.html"><a href="arima.html#forecasting"><i class="fa fa-check"></i><b>4.7</b> Forecasting</a></li>
<li class="chapter" data-level="4.8" data-path="arima.html"><a href="arima.html#trend"><i class="fa fa-check"></i><b>4.8</b> Trend</a></li>
<li class="chapter" data-level="4.9" data-path="arima.html"><a href="arima.html#python-code-for-armaarima-models"><i class="fa fa-check"></i><b>4.9</b> Python Code for ARMA/ARIMA models</a></li>
<li class="chapter" data-level="4.10" data-path="arima.html"><a href="arima.html#sas-code-for-armaarima"><i class="fa fa-check"></i><b>4.10</b> SAS Code for ARMA/ARIMA</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="seasonal-arima.html"><a href="seasonal-arima.html"><i class="fa fa-check"></i><b>5</b> Seasonal ARIMA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="seasonal-arima.html"><a href="seasonal-arima.html#seasonality"><i class="fa fa-check"></i><b>5.1</b> Seasonality</a></li>
<li class="chapter" data-level="5.2" data-path="seasonal-arima.html"><a href="seasonal-arima.html#seasonal-unit-root-testing"><i class="fa fa-check"></i><b>5.2</b> Seasonal “Unit-Root” Testing</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="seasonal-arima.html"><a href="seasonal-arima.html#r"><i class="fa fa-check"></i><b>5.2.1</b> R</a></li>
<li class="chapter" data-level="5.2.2" data-path="seasonal-arima.html"><a href="seasonal-arima.html#python"><i class="fa fa-check"></i><b>5.2.2</b> Python</a></li>
<li class="chapter" data-level="5.2.3" data-path="seasonal-arima.html"><a href="seasonal-arima.html#sas"><i class="fa fa-check"></i><b>5.2.3</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="seasonal-arima.html"><a href="seasonal-arima.html#deterministic-solution"><i class="fa fa-check"></i><b>5.3</b> Deterministic Solution</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="seasonal-arima.html"><a href="seasonal-arima.html#r-1"><i class="fa fa-check"></i><b>5.3.1</b> R</a></li>
<li class="chapter" data-level="5.3.2" data-path="seasonal-arima.html"><a href="seasonal-arima.html#python-1"><i class="fa fa-check"></i><b>5.3.2</b> Python</a></li>
<li class="chapter" data-level="5.3.3" data-path="seasonal-arima.html"><a href="seasonal-arima.html#sas-1"><i class="fa fa-check"></i><b>5.3.3</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="seasonal-arima.html"><a href="seasonal-arima.html#fourier-transformations"><i class="fa fa-check"></i><b>5.4</b> Fourier Transformations</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="seasonal-arima.html"><a href="seasonal-arima.html#r-2"><i class="fa fa-check"></i><b>5.4.1</b> R</a></li>
<li class="chapter" data-level="5.4.2" data-path="seasonal-arima.html"><a href="seasonal-arima.html#python-2"><i class="fa fa-check"></i><b>5.4.2</b> Python</a></li>
<li class="chapter" data-level="5.4.3" data-path="seasonal-arima.html"><a href="seasonal-arima.html#sas-2"><i class="fa fa-check"></i><b>5.4.3</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="seasonal-arima.html"><a href="seasonal-arima.html#other-predictor-variables"><i class="fa fa-check"></i><b>5.5</b> Other Predictor Variables</a></li>
<li class="chapter" data-level="5.6" data-path="seasonal-arima.html"><a href="seasonal-arima.html#stochastic-solution"><i class="fa fa-check"></i><b>5.6</b> Stochastic Solution</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="seasonal-arima.html"><a href="seasonal-arima.html#r-3"><i class="fa fa-check"></i><b>5.6.1</b> R</a></li>
<li class="chapter" data-level="5.6.2" data-path="seasonal-arima.html"><a href="seasonal-arima.html#python-3"><i class="fa fa-check"></i><b>5.6.2</b> Python</a></li>
<li class="chapter" data-level="5.6.3" data-path="seasonal-arima.html"><a href="seasonal-arima.html#sas-3"><i class="fa fa-check"></i><b>5.6.3</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="seasonal-arima.html"><a href="seasonal-arima.html#seasonal-arima-modeling"><i class="fa fa-check"></i><b>5.7</b> Seasonal ARIMA Modeling</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="seasonal-arima.html"><a href="seasonal-arima.html#r-4"><i class="fa fa-check"></i><b>5.7.1</b> R</a></li>
<li class="chapter" data-level="5.7.2" data-path="seasonal-arima.html"><a href="seasonal-arima.html#python-4"><i class="fa fa-check"></i><b>5.7.2</b> Python</a></li>
<li class="chapter" data-level="5.7.3" data-path="seasonal-arima.html"><a href="seasonal-arima.html#sas-4"><i class="fa fa-check"></i><b>5.7.3</b> SAS</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="seasonal-arima.html"><a href="seasonal-arima.html#multiplicative-vs.-additive"><i class="fa fa-check"></i><b>5.8</b> Multiplicative vs. Additive</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="seasonal-arima" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Seasonal ARIMA<a href="seasonal-arima.html#seasonal-arima" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="seasonality" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Seasonality<a href="seasonal-arima.html#seasonality" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Seasonality is the component of time series that represents the effects of seasonal variation. The seasonal component of a time series is the repeated pattern over a fixed period of time. For example, the airlines dataset we’ve been working through (shown below) shows seasonality every 12 observations (12 months) where we see different patterns in summer and holiday times of the year as compared to other times of the year. Seasonality occurs over a fixed and known period of time.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="seasonal-arima.html#cb1-1" tabindex="-1"></a><span class="fu">autoplot</span>(USAirlines_ts, Passengers) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Time Series plot for Passengers&quot;</span>, <span class="at">x=</span><span class="st">&quot;Date&quot;</span>,<span class="at">y=</span><span class="st">&quot;Passengers&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The length of the seasonal periods is denoted as S. Therefore, seasonal factors repeat every S units of time.</p>
<p>As mentioned in the stationarity section, seasonal models are not stationary by default because the time series doesn’t revert to a long term mean. When your data has both trend and seasonality, the seasonality should be the first problem you try and correct to make stationary. We do this because making the data stationary by accounting for the seasonality might also account for trend. This is not true for trend. Our process for building ARIMA models is the following:</p>
<p>Similar to when we accounted for trend, seasonality can be solved with a deterministic or stochastic solution.</p>
<p>Deterministic - Seasonal dummy variables, Fourier transformations, predictor variables</p>
<p>Stochastic - Seasonal differences</p>
<p>Once data is made stationary, we can model with traditional and seasonal ARIMA approaches. When we forecast our data we account for the deterministic or stochastic solution above and build that into our forecasts.</p>
</div>
<div id="seasonal-unit-root-testing" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Seasonal “Unit-Root” Testing<a href="seasonal-arima.html#seasonal-unit-root-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Similar to trend, we can perform statistical tests to try and evaluate whether we need to take a seasonal difference or perform more deterministic solutions. However, seasonal unit root tests have problems with large seasonal frequencies - values of S that are larger than 12. To counter these problems with seasonal unit roots we use measures of seasonal strength instead:</p>
<p><span class="math display">\[
F_S = \max{(0, 1 - \frac{Var(E_t)}{Var(S_t + E_t)})}
\]</span></p>
<p>where <span class="math inline">\(E_t\)</span> is the error component and <span class="math inline">\(S_t\)</span> is the seasonal component. These components both come from a time series decomposition of the data. If <span class="math inline">\(F_S &lt; 0.64\)</span> then no seasonal differencing would be recommended, while if <span class="math inline">\(F_S \ge 0.64\)</span> then take one seasonal difference.</p>
<p>The only downside of this approach is that if your data has any real amount of seasonality it would just recommend taking the differences without any notion of deterministic solutions. Therefore, this really isn’t an approach to compare whether you should use deterministic or stochastic solution for your specific problem. In practice, we typically model our data with both deterministic and stochastic solutions and compare the forecasts to see which was more accurate.</p>
<p>Let’s see how to evaluate this in each of our softwares!</p>
<div id="r" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> R<a href="seasonal-arima.html#r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R has this functionality built in with its unitroot_nsdiffs option inside of the features function. We just need to specify the variable we want to calculate this test on, which for us is the variable Passengers. The output reports the number of seasonal differences it suggests (either 1 or 0) based on the cut-off described above.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="seasonal-arima.html#cb2-1" tabindex="-1"></a>train <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="seasonal-arima.html#cb2-2" tabindex="-1"></a>  <span class="fu">features</span>(Passengers, unitroot_nsdiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   nsdiffs
##     &lt;int&gt;
## 1       1</code></pre>
</div>
<div id="python" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Python<a href="seasonal-arima.html#python" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Python doesn’t have a built in function at the time of writing this to calculate this. However, we can easily calculate this ourselves from the time series decomposition we have done in previous sections. Inside of our StatsForecast function we use the MSTL function with a frequency set to monthly data. This MSTL function calculates the STL version of the decomposition. We then use the fit function with the df = option to specify our training data we want to decompose. We can then use the .fitted_[0,0].model_ functions to print out each of the above components for each observation in our training data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="seasonal-arima.html#cb4-1" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb4-2"><a href="seasonal-arima.html#cb4-2" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> MSTL</span>
<span id="cb4-3"><a href="seasonal-arima.html#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="seasonal-arima.html#cb4-4" tabindex="-1"></a>dcmp <span class="op">=</span> StatsForecast(models <span class="op">=</span> [MSTL(season_length <span class="op">=</span> <span class="dv">12</span>)], freq <span class="op">=</span> <span class="st">&#39;M&#39;</span>)</span>
<span id="cb4-5"><a href="seasonal-arima.html#cb4-5" tabindex="-1"></a>dcmp.fit(df <span class="op">=</span> train_sf)</span></code></pre></div>
<pre><code>## StatsForecast(models=[MSTL])</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="seasonal-arima.html#cb6-1" tabindex="-1"></a>result <span class="op">=</span> dcmp.fitted_[<span class="dv">0</span>,<span class="dv">0</span>].model_</span>
<span id="cb6-2"><a href="seasonal-arima.html#cb6-2" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>##         data         trend     seasonal    remainder
## 0    34348.0  39019.258306 -4656.823649   -14.434657
## 1    33536.0  38883.031147 -5824.358016   477.326868
## 2    40578.0  38749.491951  1252.474783   576.033266
## 3    38267.0  38618.251802  -554.512182   203.260380
## 4    38249.0  38488.211305   388.631112  -627.842417
## ..       ...           ...          ...          ...
## 202  60341.0  62515.681097 -2946.195752   771.514655
## 203  60791.0  62606.870904 -1594.438482  -221.432422
## 204  57233.0  62699.163218 -6078.039540   611.876322
## 205  54140.0  62792.107128 -7499.634204 -1152.472924
## 206  67342.0  62885.168552  4003.645894   453.185554
## 
## [207 rows x 4 columns]</code></pre>
<p>Now that we have our components, we can calculate <span class="math inline">\(F_S\)</span> by hand. We just use the var function from numpy to calculate the variance.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="seasonal-arima.html#cb8-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-2"><a href="seasonal-arima.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="seasonal-arima.html#cb8-3" tabindex="-1"></a>FS <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (np.var(result[<span class="st">&#39;remainder&#39;</span>])<span class="op">/</span>(np.var(result[<span class="st">&#39;remainder&#39;</span>]) <span class="op">+</span> np.var(result[<span class="st">&#39;seasonal&#39;</span>])))</span>
<span id="cb8-4"><a href="seasonal-arima.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="seasonal-arima.html#cb8-5" tabindex="-1"></a>FS</span></code></pre></div>
<pre><code>## 0.9140123862305709</code></pre>
</div>
<div id="sas" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> SAS<a href="seasonal-arima.html#sas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>SAS doesn’t have a built in function at the time of writing this to calculate this. However, we can easily calculate this ourselves from the time series decomposition we have done in previous sections. By default SAS will provide the classical decomposition. In the PROC TIMESERIES procedure, we use the data =option to provide our training data and the plots = (series decomp) option to ask SAS for a plot of the original data series and a plot of the decomposition. The outdecomp option saves the dataset with teh decomposition of our time series. The ID statement is where we provide our date variable and specify our monthly seasonality with the interval = month option. Next, in the VAR statement we provide our target variable, Passengers.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="seasonal-arima.html#cb10-1" tabindex="-1"></a>proc timeseries data <span class="ot">=</span> work.train plots <span class="ot">=</span> (series decomp) outdecomp <span class="ot">=</span> decomp;</span>
<span id="cb10-2"><a href="seasonal-arima.html#cb10-2" tabindex="-1"></a>    id date interval <span class="ot">=</span> month;</span>
<span id="cb10-3"><a href="seasonal-arima.html#cb10-3" tabindex="-1"></a>    var Passengers;</span>
<span id="cb10-4"><a href="seasonal-arima.html#cb10-4" tabindex="-1"></a>run;</span></code></pre></div>
<p>Now that we have our components, we can calculate <span class="math inline">\(F_S\)</span> by hand. First, we need to combine our seasonal and error components represented in our data as SC and IC respectively. Once we combine these together in a DATA STEP we can use the PROC MEANS procedure to calculate the variance of each of them. We just use the var option in the PROC MEANS statement and name the variables in the VAR statement. From there we can use another DATA STEP to calculate the value of <span class="math inline">\(F_S\)</span> and print it out with the PROC PRINT procedure.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="seasonal-arima.html#cb11-1" tabindex="-1"></a>data decomp;</span>
<span id="cb11-2"><a href="seasonal-arima.html#cb11-2" tabindex="-1"></a>    set decomp;</span>
<span id="cb11-3"><a href="seasonal-arima.html#cb11-3" tabindex="-1"></a>    S_E <span class="ot">=</span> SC <span class="sc">+</span> IC;</span>
<span id="cb11-4"><a href="seasonal-arima.html#cb11-4" tabindex="-1"></a>run;</span>
<span id="cb11-5"><a href="seasonal-arima.html#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="seasonal-arima.html#cb11-6" tabindex="-1"></a>proc means data <span class="ot">=</span> decomp var;</span>
<span id="cb11-7"><a href="seasonal-arima.html#cb11-7" tabindex="-1"></a>    var IC S_E;</span>
<span id="cb11-8"><a href="seasonal-arima.html#cb11-8" tabindex="-1"></a>run;</span>
<span id="cb11-9"><a href="seasonal-arima.html#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a href="seasonal-arima.html#cb11-10" tabindex="-1"></a>data calculation;</span>
<span id="cb11-11"><a href="seasonal-arima.html#cb11-11" tabindex="-1"></a>    FS <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> (<span class="fl">0.0011888</span><span class="sc">/</span><span class="fl">0.0084828</span>);</span>
<span id="cb11-12"><a href="seasonal-arima.html#cb11-12" tabindex="-1"></a>run;</span>
<span id="cb11-13"><a href="seasonal-arima.html#cb11-13" tabindex="-1"></a></span>
<span id="cb11-14"><a href="seasonal-arima.html#cb11-14" tabindex="-1"></a>proc print data <span class="ot">=</span> calculation;</span>
<span id="cb11-15"><a href="seasonal-arima.html#cb11-15" tabindex="-1"></a>run;</span></code></pre></div>
<p>The tests above suggest taking a seasonal difference. However, let’s solve our problem with both a deterministic approach and stochastic approach to see which is better for our data.</p>
</div>
</div>
<div id="deterministic-solution" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Deterministic Solution<a href="seasonal-arima.html#deterministic-solution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Unlike trend, there are many different approaches to accounting for seasonality deterministically. The approaches we will discuss are seasonal dummy variables, Fourier transforms, and predictor variables.</p>
<p><strong>Seasonal Dummy Variables</strong></p>
<p>Seasonal dummy variables are exactly what their name implies. We will use a set of dummy variables to account for the seasonal effects in our dataset. For a time series with S periods within a season, there will be S-1 dummy variables - one for each period (and one accounted for with the intercept).</p>
<p>Since our US airlines dataset is monthly, we will build a dummy variable for each month and pick one to not include. For example, we could build the following model:</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1JAN + \beta_2FEB + \cdots + \beta_{11}NOV + e_t
\]</span></p>
<p>In the above model, we chose to leave out the month of December’s dummy variable since our model has an intercept. In fact, the intercept <span class="math inline">\(\beta_0\)</span> is the average effect of December. Each of the coefficients on the respective variables measures the average difference in effect from that month and December (our reference level).</p>
<p>Let’s see how to do this in each of our softwares!</p>
<div id="r-1" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> R<a href="seasonal-arima.html#r-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adding external variables to an ARIMA model in R is quite straightforward. By using the formula structure in the ARIMA function in the model function (from the fable package), we can add these dummy variables to our model as well as build out an automatic ARIMA model. We specify that the Month variable in our dataset is a categorical variable with the factor function. To prevent the model from automatically trying to take a seasonal difference we use the PDQ function where we specify the D = 0 option.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="seasonal-arima.html#cb12-1" tabindex="-1"></a>model_SD_ARIMA <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="seasonal-arima.html#cb12-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">factor</span>(Month) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>)))</span>
<span id="cb12-3"><a href="seasonal-arima.html#cb12-3" tabindex="-1"></a><span class="fu">report</span>(model_SD_ARIMA)</span></code></pre></div>
<pre><code>## Series: Passengers 
## Model: LM w/ ARIMA(1,1,1)(0,0,2)[12] errors 
## 
## Coefficients:
##          ar1      ma1    sma1    sma2  factor(Month)2  factor(Month)3
##       0.4437  -0.7884  0.2291  0.1213      -1128.4319       8309.2204
## s.e.  0.1350   0.0973  0.0684  0.0697        601.3847        733.8228
##       factor(Month)4  factor(Month)5  factor(Month)6  factor(Month)7
##            5714.8890       6702.4628        9450.040      11955.9752
## s.e.        802.3666        834.1741         849.269        854.2442
##       factor(Month)8  factor(Month)9  factor(Month)10  factor(Month)11
##           11632.3364       1024.3541        5202.9495        2791.6907
## s.e.        850.4283        836.4706         807.6305         748.6175
##       factor(Month)12  intercept
##             3925.0336   114.7323
## s.e.         615.1594    64.3365
## 
## sigma^2 estimated as 3535534:  log likelihood=-1837.63
## AIC=3709.26   AICc=3712.52   BIC=3765.84</code></pre>
<p>R found the “best” model based on automatic selection using seasonal dummy variables as the ARIMA model with one autoregressive (AR) term, one regular difference, one moving average (MA) term, and two seasonal moving average (SMA) terms. Seasonal AR and MA terms are discussed below in the seasonal ARIMA section.</p>
</div>
<div id="python-1" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Python<a href="seasonal-arima.html#python-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adding external variables to an ARIMA model in Python is quite straightforward. First, we use the get_dummies function from pandas to make our Month variable into dummy variables. By using the merge function on our training dataset we can add this new variable to our training data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="seasonal-arima.html#cb14-1" tabindex="-1"></a>d_X <span class="op">=</span> {<span class="st">&#39;unique_id&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;ds&#39;</span>: train.index, <span class="st">&#39;Month&#39;</span>: usair[<span class="st">&#39;Month&#39;</span>].head(n <span class="op">=</span> <span class="dv">207</span>)}</span>
<span id="cb14-2"><a href="seasonal-arima.html#cb14-2" tabindex="-1"></a>X_sf <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> d_X)</span>
<span id="cb14-3"><a href="seasonal-arima.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="seasonal-arima.html#cb14-4" tabindex="-1"></a>X_sf <span class="op">=</span> pd.get_dummies(X_sf, columns <span class="op">=</span> [<span class="st">&#39;Month&#39;</span>])</span>
<span id="cb14-5"><a href="seasonal-arima.html#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="seasonal-arima.html#cb14-6" tabindex="-1"></a>train_sf_X <span class="op">=</span> train_sf.merge(X_sf, how <span class="op">=</span> <span class="st">&#39;left&#39;</span>, on <span class="op">=</span> [<span class="st">&#39;unique_id&#39;</span>, <span class="st">&#39;ds&#39;</span>]) </span></code></pre></div>
<p>Now, in the AutoARIMA function, we can add these seasonal dummy variables to our model as well as build out an automatic ARIMA by just putting the training dataset with these new columns in the .fit function. This means we have to be careful about which datasets we use since Python automatically assumes any additional column (beyond unique_id, ds, and y) are predictor variables. We use the .fitted_[0][0].model_.get() and function to evaluate our model by asking for the order of the ARIMA model (arma), the coefficients in the ARIMA model (coef) and the AIC (aic). To prevent the model from automatically trying to take a seasonal difference we use the D = 0 option. To make sure it knows this data has possible seasonal correlations we also use the season_length = 12 option.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="seasonal-arima.html#cb15-1" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> AutoARIMA, ARIMA</span>
<span id="cb15-2"><a href="seasonal-arima.html#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="seasonal-arima.html#cb15-3" tabindex="-1"></a>model_SD_ARIMA <span class="op">=</span> StatsForecast(models <span class="op">=</span> [AutoARIMA(D <span class="op">=</span> <span class="dv">0</span>, season_length <span class="op">=</span> <span class="dv">12</span>)], freq <span class="op">=</span> <span class="st">&#39;M&#39;</span>)</span>
<span id="cb15-4"><a href="seasonal-arima.html#cb15-4" tabindex="-1"></a>model_SD_ARIMA.fit(df <span class="op">=</span> train_sf_X)</span></code></pre></div>
<pre><code>## StatsForecast(models=[AutoARIMA])</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="seasonal-arima.html#cb17-1" tabindex="-1"></a>model_SD_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 1, 0, 2, 12, 1, 0)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="seasonal-arima.html#cb19-1" tabindex="-1"></a>model_SD_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.37132542906435295, &#39;ma1&#39;: -0.7274857656037033, &#39;sma1&#39;: 0.24669635086070002, &#39;sma2&#39;: 0.14076605299826497, &#39;ex_1&#39;: -5545.23095703125, &#39;ex_2&#39;: -6631.3447265625, &#39;ex_3&#39;: 2788.095458984375, &#39;ex_4&#39;: 234.20970153808594, &#39;ex_5&#39;: 1250.2080078125, &#39;ex_6&#39;: 4022.0859375, &#39;ex_7&#39;: 6561.49462890625, &#39;ex_8&#39;: 6233.07861328125, &#39;ex_9&#39;: -4427.6884765625, &#39;ex_10&#39;: -241.98623657226562, &#39;ex_11&#39;: -2695.10693359375, &#39;ex_12&#39;: -1547.816162109375}</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="seasonal-arima.html#cb21-1" tabindex="-1"></a>model_SD_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 3712.0228454869493</code></pre>
<p>Python found the “best” model based on automatic selection using seasonal dummy variables as the ARIMA model with one autoregressive (AR) term, one regular difference, one moving average (MA) term, and two seasonal moving average (SMA) terms. Seasonal AR and MA terms are discussed below in the seasonal ARIMA section.</p>
</div>
<div id="sas-1" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> SAS<a href="seasonal-arima.html#sas-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adding external variables to an ARIMA model in SAS is quite straightforward. First, we use the DATA STEP to make our Month variable into dummy variables.</p>
<p>From there we use the PROC ARIMA procedure with this newly created dataset. With the IDENTIFY statement we give our target variable with the VAR option. We also include the CROSSCORR option with our all of our dummy variables we just calculated. Unfortunately, we cannot use the automatic selection techniques here since they will just be on the original target variable. We then use the ESTIMATE statement to define our model with only the seasonal dummy variables. The INPUT option is where we put our dummy variables into the actual model. We finish with the FORECAST statement with the LEAD option set to 0 to just give us fitted values from our training dataset. The OUT option at the very beginning of the procedure will save the model predictions and residuals which we will use in the next PROC ARIMA.</p>
<p>Since the PROC ARIMA procedure can only do automatic selection techniques on the variables in the IDENTIFY which don’t include the dummy variables yet, we have to use the residuals from our seasonal dummy variables model to put in another PROC ARIMA procedure to get an automatic selection for our model. First, we run the residuals through a Dickey-Fuller test using the STATIONARITY option with the ADF option inside of it to see if we need to difference. After looking at the results below we see we need to take a difference so we rerun the PROC ARIMA procedure with the additional IDENTIFY statement on the first difference of the residuals using the (1) notation. Then we can use the MINIC to do automatic selection.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="seasonal-arima.html#cb23-1" tabindex="-1"></a>data train_sd;</span>
<span id="cb23-2"><a href="seasonal-arima.html#cb23-2" tabindex="-1"></a>    set train;</span>
<span id="cb23-3"><a href="seasonal-arima.html#cb23-3" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">1</span> then Jan <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Jan<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-4"><a href="seasonal-arima.html#cb23-4" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">2</span> then Feb <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Feb<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-5"><a href="seasonal-arima.html#cb23-5" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">3</span> then Mar <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Mar<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-6"><a href="seasonal-arima.html#cb23-6" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">4</span> then Apr <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Apr<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-7"><a href="seasonal-arima.html#cb23-7" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">5</span> then May <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> May<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-8"><a href="seasonal-arima.html#cb23-8" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">6</span> then Jun <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Jun<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-9"><a href="seasonal-arima.html#cb23-9" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">7</span> then Jul <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Jul<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-10"><a href="seasonal-arima.html#cb23-10" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">8</span> then Aug <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Aug<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-11"><a href="seasonal-arima.html#cb23-11" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">9</span> then Sep <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Sep<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-12"><a href="seasonal-arima.html#cb23-12" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">10</span> then Oct <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Oct<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-13"><a href="seasonal-arima.html#cb23-13" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">11</span> then Nov <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Nov<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-14"><a href="seasonal-arima.html#cb23-14" tabindex="-1"></a>    <span class="cf">if</span> month<span class="ot">=</span><span class="dv">12</span> then Dec <span class="ot">=</span> <span class="dv">1</span>; <span class="cf">else</span> Dec<span class="ot">=</span><span class="dv">0</span>;</span>
<span id="cb23-15"><a href="seasonal-arima.html#cb23-15" tabindex="-1"></a>run;</span>
<span id="cb23-16"><a href="seasonal-arima.html#cb23-16" tabindex="-1"></a></span>
<span id="cb23-17"><a href="seasonal-arima.html#cb23-17" tabindex="-1"></a>proc arima data <span class="ot">=</span> train_sd out <span class="ot">=</span> train_sd_f ;</span>
<span id="cb23-18"><a href="seasonal-arima.html#cb23-18" tabindex="-1"></a>    identify var <span class="ot">=</span> Passengers nlag <span class="ot">=</span> <span class="dv">36</span> crosscorr <span class="ot">=</span> (JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV);</span>
<span id="cb23-19"><a href="seasonal-arima.html#cb23-19" tabindex="-1"></a>    estimate input <span class="ot">=</span> (JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV);</span>
<span id="cb23-20"><a href="seasonal-arima.html#cb23-20" tabindex="-1"></a>    forecast lead <span class="ot">=</span> <span class="dv">0</span>;</span>
<span id="cb23-21"><a href="seasonal-arima.html#cb23-21" tabindex="-1"></a>run;</span>
<span id="cb23-22"><a href="seasonal-arima.html#cb23-22" tabindex="-1"></a></span>
<span id="cb23-23"><a href="seasonal-arima.html#cb23-23" tabindex="-1"></a>proc arima data <span class="ot">=</span> train_sd_f;</span>
<span id="cb23-24"><a href="seasonal-arima.html#cb23-24" tabindex="-1"></a>    identify var <span class="ot">=</span> residual nlag <span class="ot">=</span> <span class="dv">36</span> stationarity<span class="ot">=</span>(<span class="at">adf =</span> <span class="dv">5</span>);</span>
<span id="cb23-25"><a href="seasonal-arima.html#cb23-25" tabindex="-1"></a>    identify var <span class="ot">=</span> <span class="fu">residual</span>(<span class="dv">1</span>) nlag <span class="ot">=</span> <span class="dv">36</span> minic P<span class="ot">=</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>) Q<span class="ot">=</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>);</span>
<span id="cb23-26"><a href="seasonal-arima.html#cb23-26" tabindex="-1"></a>run;</span></code></pre></div>
<div class="float">
<img src="9_b_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>The results from the MINIC selection gave us only an ARIMA (1,1,1) model. However, there appears to be spikes in our correlation plots below at seasonal lags (explained in the section below on seasonal ARIMA).</p>
<div class="float">
<img src="9_bb_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>Once we decide what model we would like to build, we can go back to the original PROC ARIMA procedure and add our autoregressive (AR) lags with the P option and our moving average (MA) terms with the Q option. We have a model with lags on the seasonal lags as well which is explained in the section below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="seasonal-arima.html#cb24-1" tabindex="-1"></a>proc arima data <span class="ot">=</span> train_sd out <span class="ot">=</span> train_sd_f ;</span>
<span id="cb24-2"><a href="seasonal-arima.html#cb24-2" tabindex="-1"></a>    identify var <span class="ot">=</span> <span class="fu">Passengers</span>(<span class="dv">1</span>) nlag <span class="ot">=</span> <span class="dv">36</span> crosscorr <span class="ot">=</span> (JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV);</span>
<span id="cb24-3"><a href="seasonal-arima.html#cb24-3" tabindex="-1"></a>    estimate input <span class="ot">=</span> (JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb24-4"><a href="seasonal-arima.html#cb24-4" tabindex="-1"></a>run;</span></code></pre></div>
<div class="float">
<img src="9_c_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<div class="float">
<img src="9_d_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>There are some advantages and disadvantages to the seasonal dummy variable approach. The advantages are that the model’s seasonal dummy variables have some nice interpretability. They tells us the average impact each seasonal component has on the target variable. It is also a rather straight-forward approach to implement. The main disadvantages however are that if your seasonal is especially long or complex, seasonal dummy variables are burdensome. Also, the constant effect of each season that is assumed may not be appropriate.</p>
</div>
</div>
<div id="fourier-transformations" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Fourier Transformations<a href="seasonal-arima.html#fourier-transformations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Harmonic regression using Fourier transforms is another approach to account for seasonality deterministically. Fourier showed that a series of sine and cosine terms of the right frequencies approximate periodic patterns in a data series. To do this, we add Fourier variables to a regression model to account for the seasonal pattern. The odd terms <span class="math inline">\(k=1,3,5\)</span> etc. are accounted for with sine variables:</p>
<p><span class="math display">\[
X_{k, t} = \sin(k \times \frac{2\pi t}{S})
\]</span></p>
<p>The even terms <span class="math inline">\(k = 2, 4, 6\)</span> etc. are accounted for with cosine variables:</p>
<p><span class="math display">\[
X_{k, t} = \cos(k \times \frac{2\pi t}{S})
\]</span></p>
<p>The goal is to find the right combination of sine and cosine terms that when blended together mimic the unique pattern in our data. The idea of adding these terms together to get a new unique wave is show below:</p>
<div class="float">
<img src="Fourier.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>In fact, if you add the same number of Fourier variables as you have seasonal dummy variables, you will get the same predictions. However, we typically do not need all of the Fourier variables, especially with large values of S. We need to decide how many of these values we need. One way to approach this is to build many models, while increasing the number of Fourier terms in the models and compare them all via a metric like BIC.</p>
<p>Let’s see how to do this in each of our softwares!</p>
<div id="r-2" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> R<a href="seasonal-arima.html#r-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adding external variables to an ARIMA model in R is quite straightforward. By using the formula structure in the ARIMA function in the model function, we can add these fourier variables to our model as well as build out an automatic ARIMA model. The fourier function in our formula will add the Fourier variables in pairs of sine and cosine functions with the K = option defining how many pairs of the Fourier variables to add. To prevent the model from automatically trying to take a seasonal difference we use the PDQ function where we specify the D = 0 option. We can use the glance function to quickly compare all these models.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="seasonal-arima.html#cb25-1" tabindex="-1"></a>model_F_ARIMA <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="seasonal-arima.html#cb25-2" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb25-3"><a href="seasonal-arima.html#cb25-3" tabindex="-1"></a>  <span class="st">`</span><span class="at">K = 1</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">fourier</span>(<span class="at">K=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>)),</span>
<span id="cb25-4"><a href="seasonal-arima.html#cb25-4" tabindex="-1"></a>  <span class="st">`</span><span class="at">K = 2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">fourier</span>(<span class="at">K=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>)),</span>
<span id="cb25-5"><a href="seasonal-arima.html#cb25-5" tabindex="-1"></a>  <span class="st">`</span><span class="at">K = 3</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">fourier</span>(<span class="at">K=</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>)),</span>
<span id="cb25-6"><a href="seasonal-arima.html#cb25-6" tabindex="-1"></a>  <span class="st">`</span><span class="at">K = 4</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">fourier</span>(<span class="at">K=</span><span class="dv">4</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>)),</span>
<span id="cb25-7"><a href="seasonal-arima.html#cb25-7" tabindex="-1"></a>  <span class="st">`</span><span class="at">K = 5</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">fourier</span>(<span class="at">K=</span><span class="dv">5</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>)),</span>
<span id="cb25-8"><a href="seasonal-arima.html#cb25-8" tabindex="-1"></a>  <span class="st">`</span><span class="at">K = 6</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">fourier</span>(<span class="at">K=</span><span class="dv">6</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="at">D =</span> <span class="dv">0</span>))</span>
<span id="cb25-9"><a href="seasonal-arima.html#cb25-9" tabindex="-1"></a>)</span>
<span id="cb25-10"><a href="seasonal-arima.html#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="seasonal-arima.html#cb25-11" tabindex="-1"></a><span class="fu">glance</span>(model_F_ARIMA)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   .model   sigma2 log_lik   AIC  AICc   BIC ar_roots   ma_roots  
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;list&gt;    
## 1 K = 1  5041124.  -1887. 3785. 3786. 3805. &lt;cpl [13]&gt; &lt;cpl [1]&gt; 
## 2 K = 2  5086926.  -1887. 3789. 3790. 3816. &lt;cpl [13]&gt; &lt;cpl [1]&gt; 
## 3 K = 3  4296120.  -1866. 3753. 3754. 3786. &lt;cpl [24]&gt; &lt;cpl [1]&gt; 
## 4 K = 4  4327984.  -1866. 3756. 3757. 3796. &lt;cpl [24]&gt; &lt;cpl [1]&gt; 
## 5 K = 5  3689835.  -1843. 3718. 3720. 3771. &lt;cpl [0]&gt;  &lt;cpl [27]&gt;
## 6 K = 6  3535544.  -1838. 3709. 3713. 3766. &lt;cpl [1]&gt;  &lt;cpl [25]&gt;</code></pre>
<p>Based on the results above, the model with all of the Fourier terms has the lowest values of AIC, AICc, and BIC. This model is the same as the model that we had with the seasonal dummy variables. We can see a plot of these different models below.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="seasonal-arima.html#cb27-1" tabindex="-1"></a>model_F_ARIMA <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="seasonal-arima.html#cb27-2" tabindex="-1"></a>  fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="seasonal-arima.html#cb27-3" tabindex="-1"></a>  <span class="fu">autoplot</span>(train, <span class="at">level =</span> <span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="seasonal-arima.html#cb27-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(.model), <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="seasonal-arima.html#cb27-5" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">&quot;none&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;none&quot;</span>, <span class="at">level =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="seasonal-arima.html#cb27-6" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb27-7"><a href="seasonal-arima.html#cb27-7" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">yearmonth</span>(<span class="st">&quot;2007 Jan&quot;</span>), <span class="at">y =</span> <span class="dv">4250</span>,</span>
<span id="cb27-8"><a href="seasonal-arima.html#cb27-8" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;AICc = &quot;</span>, <span class="fu">format</span>(AICc))),</span>
<span id="cb27-9"><a href="seasonal-arima.html#cb27-9" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">glance</span>(model_F_ARIMA)</span>
<span id="cb27-10"><a href="seasonal-arima.html#cb27-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-11"><a href="seasonal-arima.html#cb27-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">&quot;Comparison of Different Models&quot;</span>,</span>
<span id="cb27-12"><a href="seasonal-arima.html#cb27-12" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Passengers&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="python-2" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Python<a href="seasonal-arima.html#python-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adding external variables to an ARIMA model in Python is quite straightforward. First, we use the fourier function from the utils.feature_engineering package to make our Fourier variables. We need to specify the length of the season as well as how many pairs of sine and cosine terms to be created with the k = option.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="seasonal-arima.html#cb28-1" tabindex="-1"></a><span class="im">from</span> utilsforecast.feature_engineering <span class="im">import</span> fourier</span>
<span id="cb28-2"><a href="seasonal-arima.html#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="seasonal-arima.html#cb28-3" tabindex="-1"></a>train_sf_f, test_sf_f <span class="op">=</span> fourier(train_sf, freq<span class="op">=</span><span class="st">&#39;ME&#39;</span>, season_length <span class="op">=</span> <span class="dv">12</span>, k <span class="op">=</span> <span class="dv">6</span>, h <span class="op">=</span> <span class="dv">12</span>)</span></code></pre></div>
<p>Now that we have created our training data we can use a for loop to try out the six different models with up to six pairs of Fourier variables. We can compare these models based on AIC.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="seasonal-arima.html#cb29-1" tabindex="-1"></a>aic <span class="op">=</span> np.array([])</span>
<span id="cb29-2"><a href="seasonal-arima.html#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="seasonal-arima.html#cb29-3" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>):</span>
<span id="cb29-4"><a href="seasonal-arima.html#cb29-4" tabindex="-1"></a>  model_F_ARIMA <span class="op">=</span> StatsForecast(models <span class="op">=</span> [AutoARIMA(season_length <span class="op">=</span> <span class="dv">12</span>, D <span class="op">=</span> <span class="dv">0</span>)], freq <span class="op">=</span> <span class="st">&#39;M&#39;</span>)</span>
<span id="cb29-5"><a href="seasonal-arima.html#cb29-5" tabindex="-1"></a>  model_F_ARIMA.fit(df <span class="op">=</span> train_sf_f.iloc[:, <span class="dv">0</span>:<span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>i])</span>
<span id="cb29-6"><a href="seasonal-arima.html#cb29-6" tabindex="-1"></a>  aic <span class="op">=</span> np.append(aic, model_F_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>))</span></code></pre></div>
<pre><code>## StatsForecast(models=[AutoARIMA])
## StatsForecast(models=[AutoARIMA])
## StatsForecast(models=[AutoARIMA])
## StatsForecast(models=[AutoARIMA])
## StatsForecast(models=[AutoARIMA])
## StatsForecast(models=[AutoARIMA])
## StatsForecast(models=[AutoARIMA])</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="seasonal-arima.html#cb31-1" tabindex="-1"></a>  </span>
<span id="cb31-2"><a href="seasonal-arima.html#cb31-2" tabindex="-1"></a><span class="bu">print</span>(aic)</span></code></pre></div>
<pre><code>## [3811.43504347 3815.00601709 3794.76746678 3780.58680421 3741.98970672
##  3720.41333752 3711.34605279]</code></pre>
<p>Based on the results above, the model with all of the Fourier terms has the lowest values of AIC, AICc, and BIC. This model is the same as the model that we had with the seasonal dummy variables. We can build this final model below to see what the automatic ARIMA model is with these Fourier terms.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="seasonal-arima.html#cb33-1" tabindex="-1"></a>model_F_ARIMA <span class="op">=</span> StatsForecast(models <span class="op">=</span> [AutoARIMA(season_length <span class="op">=</span> <span class="dv">12</span>, D <span class="op">=</span> <span class="dv">0</span>)], freq <span class="op">=</span> <span class="st">&#39;M&#39;</span>)</span>
<span id="cb33-2"><a href="seasonal-arima.html#cb33-2" tabindex="-1"></a>model_F_ARIMA.fit(df <span class="op">=</span> train_sf_f)</span></code></pre></div>
<pre><code>## StatsForecast(models=[AutoARIMA])</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="seasonal-arima.html#cb35-1" tabindex="-1"></a>model_F_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 1, 0, 2, 12, 1, 0)</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="seasonal-arima.html#cb37-1" tabindex="-1"></a>model_F_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.3732468363982339, &#39;ma1&#39;: -0.7307059972352768, &#39;sma1&#39;: 0.24990579074901723, &#39;sma2&#39;: 0.1340925791781142, &#39;ex_1&#39;: -1257.8986624024692, &#39;ex_2&#39;: 304.52100293908734, &#39;ex_3&#39;: -2568.038612436736, &#39;ex_4&#39;: 385.81835392443463, &#39;ex_5&#39;: 2282.5552591547603, &#39;ex_6&#39;: -6944313.76512648, &#39;ex_7&#39;: -4356.104750276369, &#39;ex_8&#39;: 663.2591446039733, &#39;ex_9&#39;: 1280.8474981794134, &#39;ex_10&#39;: 202.15878511196934, &#39;ex_11&#39;: 283.18975372909335, &#39;ex_12&#39;: 415.4550326420687}</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="seasonal-arima.html#cb39-1" tabindex="-1"></a>model_F_ARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aic&quot;</span>)</span></code></pre></div>
<pre><code>## 3711.3460527885513</code></pre>
</div>
<div id="sas-2" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> SAS<a href="seasonal-arima.html#sas-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Adding external variables to an ARIMA model in SAS is quite straightforward. First, we use the DATA STEP to make our Fourier variables by calculating them by hand.</p>
<p>From there we use the PROC ARIMA procedure with this newly created dataset. With the IDENTIFY statement we give our target variable with the VAR option. We also include the CROSSCORR option with our all of our Fourier variables we just calculated. We then use the ESTIMATE statement to define our model with the Fourier variables in six different combinations where we add a new pair of sine and cosine functions with each new model. The INPUT option is where we put our Fourier variables into the actual model. We can add our autoregressive (AR) lags with the P option and our moving average (MA) terms with the Q option. We have a model with lags on the seasonal lags as well which is explained in the section below.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="seasonal-arima.html#cb41-1" tabindex="-1"></a>data train_f;</span>
<span id="cb41-2"><a href="seasonal-arima.html#cb41-2" tabindex="-1"></a>    set train;</span>
<span id="cb41-3"><a href="seasonal-arima.html#cb41-3" tabindex="-1"></a>    pi <span class="ot">=</span> <span class="fu">constant</span>(<span class="st">&#39;PI&#39;</span>);</span>
<span id="cb41-4"><a href="seasonal-arima.html#cb41-4" tabindex="-1"></a>    x1<span class="ot">=</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">1</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>); x2<span class="ot">=</span><span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">1</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb41-5"><a href="seasonal-arima.html#cb41-5" tabindex="-1"></a>    x3<span class="ot">=</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">2</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>); x4<span class="ot">=</span><span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">2</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb41-6"><a href="seasonal-arima.html#cb41-6" tabindex="-1"></a>    x5<span class="ot">=</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">3</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>); x6<span class="ot">=</span><span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">3</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb41-7"><a href="seasonal-arima.html#cb41-7" tabindex="-1"></a>    x7<span class="ot">=</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">4</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>); x8<span class="ot">=</span><span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">4</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb41-8"><a href="seasonal-arima.html#cb41-8" tabindex="-1"></a>    x9<span class="ot">=</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">5</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>); x10<span class="ot">=</span><span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">5</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb41-9"><a href="seasonal-arima.html#cb41-9" tabindex="-1"></a>    x11<span class="ot">=</span><span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">6</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>); x12<span class="ot">=</span><span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span><span class="dv">6</span><span class="sc">*</span>_n_<span class="sc">/</span><span class="dv">12</span>);</span>
<span id="cb41-10"><a href="seasonal-arima.html#cb41-10" tabindex="-1"></a>run;</span>
<span id="cb41-11"><a href="seasonal-arima.html#cb41-11" tabindex="-1"></a></span>
<span id="cb41-12"><a href="seasonal-arima.html#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="seasonal-arima.html#cb41-13" tabindex="-1"></a>proc arima data <span class="ot">=</span> train_f;</span>
<span id="cb41-14"><a href="seasonal-arima.html#cb41-14" tabindex="-1"></a>    identify var <span class="ot">=</span> Passengers nlag <span class="ot">=</span> <span class="dv">36</span> crosscorr <span class="ot">=</span> (x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12);</span>
<span id="cb41-15"><a href="seasonal-arima.html#cb41-15" tabindex="-1"></a>    estimate input <span class="ot">=</span> (x1 x2) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb41-16"><a href="seasonal-arima.html#cb41-16" tabindex="-1"></a>    estimate input <span class="ot">=</span> (x1 x2 x3 x4) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb41-17"><a href="seasonal-arima.html#cb41-17" tabindex="-1"></a>    estimate input <span class="ot">=</span> (x1 x2 x3 x4 x5 x6) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb41-18"><a href="seasonal-arima.html#cb41-18" tabindex="-1"></a>    estimate input <span class="ot">=</span> (x1 x2 x3 x4 x5 x6 x7 x8) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb41-19"><a href="seasonal-arima.html#cb41-19" tabindex="-1"></a>    estimate input <span class="ot">=</span> (x1 x2 x3 x4 x5 x6 x7 x8 x9 x10) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb41-20"><a href="seasonal-arima.html#cb41-20" tabindex="-1"></a>    estimate input <span class="ot">=</span> (x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12) p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>);</span>
<span id="cb41-21"><a href="seasonal-arima.html#cb41-21" tabindex="-1"></a>run;</span>
<span id="cb41-22"><a href="seasonal-arima.html#cb41-22" tabindex="-1"></a>quit;</span></code></pre></div>
<div class="float">
<img src="9_e_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>The results shown is the just from the model with the best AIC value.</p>
<p>Based on the results above, the model with all of the Fourier terms has the lowest value of AIC. This model is the same as the model that we had with the seasonal dummy variables.</p>
<p>There are some advantages and disadvantages of the Fourier term approach to accounting for seasonality. The main advantage is that Fourier terms can handle long and complex seasonality. In fact, for multiple seasons in a dataset, we can add more Fourier variables at different frequencies to account for this. The disadvantages of the Fourier approach are that the Fourier terms themselves are not really interpretable and that we need to use trial and error to find the “right” amount of variables to use.</p>
</div>
</div>
<div id="other-predictor-variables" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Other Predictor Variables<a href="seasonal-arima.html#other-predictor-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The last common approach to accounting for seasonality in data is to use other predictor variables that have a matching seasonality to use them in a model. Modeling these variables against the target variable might account for the seasonality in our dataset. An example of this might be outdoor temperature modeling energy usage because they have the same 24 hour cycle. This cycle might not match during certain times of the year as well as others which might need to be accounted for in modeling the seasonality.</p>
<p>There are some advantages and disadvantages of the external predictor variable approach to accounting for seasonality. The main advantage is that these variables can handle long and complex seasonality. In fact, for multiple seasons in a dataset, we can add more predictor variables to potentially account for this. There is also the potential of nice interpretability for these variables in the model. The disadvantages of the external predictor variable approach are that we need to use trial and error to find the “right” variables to use if there are even variables we can use in this context.</p>
</div>
<div id="stochastic-solution" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Stochastic Solution<a href="seasonal-arima.html#stochastic-solution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When a stochastic solution is best to solve seasonality, we need to take seasonal differences to account for the seasonality. A difference on a season is when we look at the difference between the current point and the same point in the previous season: <span class="math inline">\(Y_t - Y_{t-S}\)</span>. For our dataset, it can be thought of as the year over year change in our data.</p>
<p>Let’s look at a plot of the original data vs. the seasonally differenced data.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>There are some limitations to differencing. Differencing is hard to evaluate for long and complex seasons due to the statistical tests for stochastic differencing typically ended at a season length of 24. Therefore, long and/or complex seasons are typically best approached with deterministic solutions. In fact, it is hard to imagine a difference being very long in terms of time points logically. For example, if you had daily data and thought you had an annual season, it is hard to imagine there is an actual impact of noon on Jan 26 from last year on noon on Jan 26 of this year.</p>
<p>Prepare for Modeling</p>
<p>After we remove the seasonal effect through either deterministic or stochastic approaches we need to check to see if we have stationary data for modeling. Just because we remove the seasonality doesn’t mean the data is fully stationary. For this we would use the same techniques as we saw in the section of stationarity. For this example we will just use the differenced data from our stochastic solution, but the following should be done if you want to check the deterministic solutions as well.</p>
<p>Let’s see how to do this in our softwares!</p>
<div id="r-3" class="section level3 hasAnchor" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> R<a href="seasonal-arima.html#r-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R has this functionality built in with its unitroot_ndiffs option inside of the features function. We just need to specify the variable we want to calculate this test on, which for us is the seasonal difference on the variable Passengers. To get this variable we use the mutate function to create our seasonal difference of 12 lags. The output reports the number of differences it suggests based on the unit root test.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="seasonal-arima.html#cb42-1" tabindex="-1"></a>train <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="seasonal-arima.html#cb42-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pass_diff =</span> <span class="fu">difference</span>(Passengers, <span class="at">lag =</span> <span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="seasonal-arima.html#cb42-3" tabindex="-1"></a>  <span class="fu">features</span>(Pass_diff, unitroot_ndiffs)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   ndiffs
##    &lt;int&gt;
## 1      0</code></pre>
</div>
<div id="python-3" class="section level3 hasAnchor" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Python<a href="seasonal-arima.html#python-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Python has this functionality built in with its adfuller function inside of the statsmodels.tsa.stattools package. We just need to specify the variable we want to calculate this test on, which for us is the seasonal difference on the variable Passengers. To get this variable we use the shift function to create our seasonal difference of 12 lags.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="seasonal-arima.html#cb44-1" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb44-2"><a href="seasonal-arima.html#cb44-2" tabindex="-1"></a></span>
<span id="cb44-3"><a href="seasonal-arima.html#cb44-3" tabindex="-1"></a>train[<span class="st">&quot;Passengers_diff&quot;</span>] <span class="op">=</span> train[<span class="st">&quot;Passengers&quot;</span>] <span class="op">-</span> train[<span class="st">&quot;Passengers&quot;</span>].shift(<span class="dv">12</span>)</span></code></pre></div>
<pre><code>## &lt;string&gt;:2: SettingWithCopyWarning: 
## A value is trying to be set on a copy of a slice from a DataFrame.
## Try using .loc[row_indexer,col_indexer] = value instead
## 
## See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="seasonal-arima.html#cb46-1" tabindex="-1"></a>result <span class="op">=</span> adfuller(train.iloc[<span class="dv">12</span>:<span class="dv">207</span>][<span class="st">&quot;Passengers_diff&quot;</span>])</span>
<span id="cb46-2"><a href="seasonal-arima.html#cb46-2" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## (-3.1193806884272663, 0.0251517817351501, 15, 179, {&#39;1%&#39;: -3.4674201432469816, &#39;5%&#39;: -2.877826051844538, &#39;10%&#39;: -2.575452082332012}, 3265.477674996173)</code></pre>
</div>
<div id="sas-3" class="section level3 hasAnchor" number="5.6.3">
<h3><span class="header-section-number">5.6.3</span> SAS<a href="seasonal-arima.html#sas-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>SAS has this functionality built in with its STATIONARITY option inside of the IDENTIFY statement from the PROC ARIMA procedure. We just need to specify the variable we want to calculate this test on, which for us is the seasonal difference on the variable Passengers. To get this variable we use the (12) specification to create our seasonal difference of 12 lags.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="seasonal-arima.html#cb48-1" tabindex="-1"></a>proc arima data <span class="ot">=</span> train;</span>
<span id="cb48-2"><a href="seasonal-arima.html#cb48-2" tabindex="-1"></a>    identify var <span class="ot">=</span> <span class="fu">Passengers</span>(<span class="dv">12</span>) stationarity <span class="ot">=</span> (<span class="at">adf =</span> <span class="dv">5</span>);</span>
<span id="cb48-3"><a href="seasonal-arima.html#cb48-3" tabindex="-1"></a>run;</span></code></pre></div>
<div class="float">
<img src="9_k_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>Based on the results above, our differenced data is stationary. Once our data is made stationary by either deterministic or stochastic approaches, the remaining data or differences are modeled with seasonal ARIMA models. The key to these new seasonal ARIMA models is that there still might be effects at seasonal lags in the dataset, even though the main seasonality is accounted for.</p>
</div>
</div>
<div id="seasonal-arima-modeling" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> Seasonal ARIMA Modeling<a href="seasonal-arima.html#seasonal-arima-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When extending the ARIMA model framework to the seasonal ARIMA framework, we add another set of terms - P, D, Q, and S. Notice how these terms are capitalized.</p>
<p><span class="math display">\[
ARIMA(p, d, q)(P, D, Q)_S
\]</span></p>
<p>The terms represent the number of seasonal AR terms (<span class="math inline">\(P\)</span>), the number of seasonal MA terms (<span class="math inline">\(Q\)</span>), and the number of seasonal differences (<span class="math inline">\(D\)</span>). The length of the season is still defined as <span class="math inline">\(S\)</span>. Imagine we have an <span class="math inline">\(ARIMA(1,0,1)(2,1,0)_{12}\)</span> model. This would be the structure:</p>
<p><span class="math display">\[
Y_{t} - Y_{t-12} = W_t
\]</span></p>
<p><span class="math display">\[
W_t = \omega + \phi_1 W_{t-1} + \phi_2 W_{t-12} + \phi_3 W_{t-24} + \theta_1 e_{t-1} + e_t
\]</span></p>
<p>where <span class="math inline">\(W_t\)</span> is the seasonal difference from <span class="math inline">\(D = 1\)</span>. The regular AR term of <span class="math inline">\(p = 1\)</span> is represented by the first lag <span class="math inline">\(W_{t-1}\)</span>. The seasonal AR term of <span class="math inline">\(P = 2\)</span> is represented by the first two seasonal lags <span class="math inline">\(W_{t-12}\)</span> and <span class="math inline">\(W_{t-24}\)</span>. The regular MA term of <span class="math inline">\(q=1\)</span> is represented as the first error lag <span class="math inline">\(e_{t-1}\)</span>.</p>
<p>Seasonal ARIMA models have the same structure and approach as typical ARIMA models with AR and MA patterns in the ACF and PACF. The main difference is that the pattern is just on the seasonal lag instead of the individual lags. For example, if you had an <span class="math inline">\(ARIMA(0,0,0)(1,0,0)_{12}\)</span> model, then the ACF would have an exponentially decreasing pattern every 12 lags while the PACF only had a single spike at lag 12.</p>
<div class="float">
<img src="SeasonalAR.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>The pattern is the same, but it is only seen on the season since we are dealing with the seasonal lag.</p>
<p>The opposite would be true for an <span class="math inline">\(ARIMA(0,0,0)(0,0,1)_{12}\)</span> model. The PACF would have an exponentially decreasing pattern every 12 lags while the ACF only had a single spike at lag 12.</p>
<div class="float">
<img src="SeasonalMA.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>The pattern is the same, but it is only seen on the season since we are dealing with the seasonal lag. For our US airlines data we can observe the lag structure on the differenced data below.</p>
<pre><code>## Warning: Removed 12 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>From the above ACF and PACF plots we see a large spike in the PACF at lag 1 and an exponential decrease in the ACF within the first season. This would lend itself to a <span class="math inline">\(p = 1\)</span> (AR term at lag 1) with <span class="math inline">\(q = 0\)</span> (no MA term within a season). On the seasonal lags we see spikes at most of the seasons (12, 24, 36, etc.) in both plots. This kind of complicated pattern would lend itself to both a <span class="math inline">\(P =1\)</span> (seasonal AR term at lag 12) and <span class="math inline">\(Q = 1\)</span> (seasonal MA term at lag 12). Overall, for our data we can try the <span class="math inline">\(ARIMA(1,0,0)(1,1,1)_{12}\)</span> model based on these findings.</p>
<p>Let’s build this seasonal ARIMA model in each of our softwares!</p>
<div id="r-4" class="section level3 hasAnchor" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> R<a href="seasonal-arima.html#r-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In R we can build both a specific ARIMA model and automatically select an ARIMA model using the same ARIMA function inside of the model function. To specify the specific ARIMA model we want we use the pdq and PDQ functions in the formula framework to build the regular and seasonal lags respectively. In the pdq function we specify the <span class="math inline">\(p=1\)</span> piece along with the <span class="math inline">\(d=0\)</span> and <span class="math inline">\(q=0\)</span>. In the PDQ function we are specifying the <span class="math inline">\(P = 1\)</span>, <span class="math inline">\(D = 1\)</span>, and <span class="math inline">\(Q = 1\)</span> terms. To let R build its own ARIMA model through automatic selection we just use the ARIMA function on the Passengers variable without specifying the pdq and PDQ functions.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="seasonal-arima.html#cb51-1" tabindex="-1"></a>model_SARIMA <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="seasonal-arima.html#cb51-2" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb51-3"><a href="seasonal-arima.html#cb51-3" tabindex="-1"></a>    <span class="at">hand =</span> <span class="fu">ARIMA</span>(Passengers <span class="sc">~</span> <span class="fu">pdq</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)),</span>
<span id="cb51-4"><a href="seasonal-arima.html#cb51-4" tabindex="-1"></a>    <span class="at">auto =</span> <span class="fu">ARIMA</span>(Passengers)</span>
<span id="cb51-5"><a href="seasonal-arima.html#cb51-5" tabindex="-1"></a>  )</span></code></pre></div>
<p>With these models built we can investigate them one at a time. Below we use the select function to first select the model by built by hand and then view a summary of this model using the report function. We can isolate the same model and also use the gg_tsresiduals function to look at the residuals from this model up to lag 36 in the code below. Lastly, we look at the Ljung-Box test for white noise using the filter function to get the model we want and the features function with the ljung_box option. We have 3 degrees of freedom (dof = 3) because we have 3 terms we are estimating in our seasonal ARIMA model - <span class="math inline">\(p = 1\)</span>, <span class="math inline">\(P = 1\)</span>, and <span class="math inline">\(Q = 1\)</span>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="seasonal-arima.html#cb52-1" tabindex="-1"></a>model_SARIMA <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="seasonal-arima.html#cb52-2" tabindex="-1"></a>  <span class="fu">select</span>(hand) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="seasonal-arima.html#cb52-3" tabindex="-1"></a>  report</span></code></pre></div>
<pre><code>## Series: Passengers 
## Model: ARIMA(1,0,0)(1,1,1)[12] w/ drift 
## 
## Coefficients:
##          ar1    sar1     sma1  constant
##       0.7444  0.1721  -0.7755  319.7503
## s.e.  0.0487  0.1040   0.0753   38.5404
## 
## sigma^2 estimated as 3745598:  log likelihood=-1754.8
## AIC=3519.61   AICc=3519.93   BIC=3535.97</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="seasonal-arima.html#cb54-1" tabindex="-1"></a>model_SARIMA <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="seasonal-arima.html#cb54-2" tabindex="-1"></a>  <span class="fu">select</span>(hand) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="seasonal-arima.html#cb54-3" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>(<span class="at">lag =</span> <span class="dv">36</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="seasonal-arima.html#cb55-1" tabindex="-1"></a><span class="fu">augment</span>(model_SARIMA) <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="seasonal-arima.html#cb55-2" tabindex="-1"></a>  <span class="fu">filter</span>(.model <span class="sc">==</span> <span class="st">&quot;hand&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="seasonal-arima.html#cb55-3" tabindex="-1"></a>  <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag =</span> <span class="dv">36</span>, <span class="at">dof =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model lb_stat lb_pvalue
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 hand      37.4     0.275</code></pre>
<p>From the output above we can see that the estimation of the coefficients from our model summary and the residuals from the plot. We also have statistical white noise with our residuals based on the results from the Ljung-Box test.</p>
<p>Let’s use the same code as above to view the results from R’s automatically selected seasonal ARIMA model.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="seasonal-arima.html#cb57-1" tabindex="-1"></a>model_SARIMA <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="seasonal-arima.html#cb57-2" tabindex="-1"></a>  <span class="fu">select</span>(auto) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="seasonal-arima.html#cb57-3" tabindex="-1"></a>  report</span></code></pre></div>
<pre><code>## Series: Passengers 
## Model: ARIMA(1,0,1)(0,1,1)[12] w/ drift 
## 
## Coefficients:
##          ar1      ma1     sma1  constant
##       0.8801  -0.2962  -0.6785  179.8722
## s.e.  0.0454   0.0950   0.0600   34.0147
## 
## sigma^2 estimated as 3639496:  log likelihood=-1751.67
## AIC=3513.34   AICc=3513.66   BIC=3529.7</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="seasonal-arima.html#cb59-1" tabindex="-1"></a>model_SARIMA <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="seasonal-arima.html#cb59-2" tabindex="-1"></a>  <span class="fu">select</span>(auto) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="seasonal-arima.html#cb59-3" tabindex="-1"></a>  <span class="fu">gg_tsresiduals</span>(<span class="at">lag =</span> <span class="dv">36</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="seasonal-arima.html#cb60-1" tabindex="-1"></a><span class="fu">augment</span>(model_SARIMA) <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="seasonal-arima.html#cb60-2" tabindex="-1"></a>  <span class="fu">filter</span>(.model <span class="sc">==</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="seasonal-arima.html#cb60-3" tabindex="-1"></a>  <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag =</span> <span class="dv">36</span>, <span class="at">dof =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model lb_stat lb_pvalue
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 auto      29.4     0.648</code></pre>
<p>From the output above we can see that the estimation of the coefficients from our model summary as well as what model R selected automatically - <span class="math inline">\(ARIMA(1,0,1)(0,1,1)_{12}\)</span>. We also have statistical white noise with our residuals based on the results from the Ljung-Box test.</p>
<p>Let’s forecast both of these models using the the forecast function with the h = 12 option to forecast 12 months into the future. We also plot these two models’ forecasts against each other.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="seasonal-arima.html#cb62-1" tabindex="-1"></a>model_SARIMA_for <span class="ot">&lt;-</span> fabletools<span class="sc">::</span><span class="fu">forecast</span>(model_SARIMA, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb62-2"><a href="seasonal-arima.html#cb62-2" tabindex="-1"></a></span>
<span id="cb62-3"><a href="seasonal-arima.html#cb62-3" tabindex="-1"></a>model_SARIMA_for <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="seasonal-arima.html#cb62-4" tabindex="-1"></a>  <span class="fu">autoplot</span>(train) <span class="sc">+</span></span>
<span id="cb62-5"><a href="seasonal-arima.html#cb62-5" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">fitted</span>(model_SARIMA), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb62-6"><a href="seasonal-arima.html#cb62-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as_date</span>(<span class="st">&quot;2007-03-15&quot;</span>),<span class="at">color=</span><span class="st">&quot;orange&quot;</span>,<span class="at">linetype=</span><span class="st">&quot;longdash&quot;</span>)</span></code></pre></div>
<pre><code>## Plot variable not specified, automatically selected `.vars = .fitted`</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Let’s take both of these models to the test dataset to see which forecasts better since both of these were rather comparable on the training dataset. For this we use the accuracy function from the fabletools library.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="seasonal-arima.html#cb64-1" tabindex="-1"></a>fabletools<span class="sc">::</span><span class="fu">accuracy</span>(model_SARIMA_for, test)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 10
##   .model .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
##   &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 auto   Test   807. 1339. 1229.  1.20  1.89   NaN   NaN 0.446
## 2 hand   Test   752. 1280. 1162.  1.11  1.78   NaN   NaN 0.494</code></pre>
<p>Based on the output above it appears that the model built based on the ACF and PACF plots forecasts better than the automatically selected model. This isn’t always the case, but still a good example to show that automatic selection techniques are good starting points, but you should not be afraid to adjust them to see if you can get better models. This model was not as good as the previously built Holt-Winters exponentially smoothing model on the testing dataset, but again, this is not always the case.</p>
</div>
<div id="python-4" class="section level3 hasAnchor" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Python<a href="seasonal-arima.html#python-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Python we can build both a specific ARIMA model and automatically select an ARIMA model using the same StatsForecast function from the statsforecast package. To specify the specific ARIMA model we want we use the order and seasonal_order functions in the ARIMA function to build the regular and seasonal lags respectively. In the order function we specify the <span class="math inline">\(p=1\)</span> piece along with the <span class="math inline">\(d=0\)</span> and <span class="math inline">\(q=0\)</span>. In the seasonal_order function we are specifying the <span class="math inline">\(P = 1\)</span>, <span class="math inline">\(D = 1\)</span>, and <span class="math inline">\(Q = 1\)</span> terms along with the season length of 12 months (season_length = 12). We also include a drift or intercept terms in our model. To let Python build its own ARIMA model through automatic selection we just use the AutoARIMA function with only specifying the season length and drift. Then we have to tell the model we have a monthly frequency to our dataset with the freq = ‘ME’ option. Lastly, we just use the .fit function on our training dataset.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="seasonal-arima.html#cb66-1" tabindex="-1"></a>model_SARIMA <span class="op">=</span> StatsForecast(models <span class="op">=</span> [ARIMA(order <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), season_length <span class="op">=</span> <span class="dv">12</span>, seasonal_order <span class="op">=</span> (<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), include_drift <span class="op">=</span> <span class="va">True</span>), AutoARIMA(season_length <span class="op">=</span> <span class="dv">12</span>, allowdrift <span class="op">=</span> <span class="va">True</span>)], freq <span class="op">=</span> <span class="st">&#39;ME&#39;</span>)</span>
<span id="cb66-2"><a href="seasonal-arima.html#cb66-2" tabindex="-1"></a>model_SARIMA.fit(df <span class="op">=</span> train_sf)</span></code></pre></div>
<pre><code>## StatsForecast(models=[ARIMA,AutoARIMA])</code></pre>
<p>With these models built we can investigate them one at a time. Below we use the .fitted_[0][0] function to first select the model by built by hand since it was the first model built. We then use the .model_.get() function along with different inputs to view a summary of this model. Specifically we ask for the ARIMA structure (arma), coefficients (coef), and AICc (aicc) from the model. Lastly, we look at the Ljung-Box test for white noise using the residuals option to get the residuals we want and the acorr_ljungbox function for the test itself. We have 3 degrees of freedom (model_df = 3) because we have 3 terms we are estimating in our seasonal ARIMA model - <span class="math inline">\(p = 1\)</span>, <span class="math inline">\(P = 1\)</span>, and <span class="math inline">\(Q = 1\)</span>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="seasonal-arima.html#cb68-1" tabindex="-1"></a>model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 0, 1, 1, 12, 0, 1)</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="seasonal-arima.html#cb70-1" tabindex="-1"></a>model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.6391833439388491, &#39;sar1&#39;: 0.030766527668189745, &#39;sma1&#39;: -0.6771949561412464, &#39;drift&#39;: 123.67179487179487}</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="seasonal-arima.html#cb72-1" tabindex="-1"></a>model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;aicc&quot;</span>)</span></code></pre></div>
<pre><code>## 3528.358903437652</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="seasonal-arima.html#cb74-1" tabindex="-1"></a>sm.stats.acorr_ljungbox(model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">0</span>].model_.get(<span class="st">&quot;residuals&quot;</span>), lags <span class="op">=</span> [<span class="dv">36</span>], model_df <span class="op">=</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       lb_stat  lb_pvalue
## 36  72.651681   0.000083</code></pre>
<p>From the output above we can see that the estimation of the coefficients from our model summary. We also have statistical white noise with our residuals based on the results from the Ljung-Box test.</p>
<p>Let’s use the same code as above to view the results from Python’s automatically selected seasonal ARIMA model represented with the .fitted_[0][1] model.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="seasonal-arima.html#cb76-1" tabindex="-1"></a>model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;arma&quot;</span>)</span></code></pre></div>
<pre><code>## (1, 0, 0, 2, 12, 0, 1)</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="seasonal-arima.html#cb78-1" tabindex="-1"></a>model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;coef&quot;</span>)</span></code></pre></div>
<pre><code>## {&#39;ar1&#39;: 0.7259352846043337, &#39;sma1&#39;: -0.612998668446738, &#39;sma2&#39;: -0.06770550890976594}</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="seasonal-arima.html#cb80-1" tabindex="-1"></a>model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;aicc&quot;</span>)</span></code></pre></div>
<pre><code>## 3575.825387284918</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="seasonal-arima.html#cb82-1" tabindex="-1"></a>sm.stats.acorr_ljungbox(model_SARIMA.fitted_[<span class="dv">0</span>][<span class="dv">1</span>].model_.get(<span class="st">&quot;residuals&quot;</span>), lags <span class="op">=</span> [<span class="dv">36</span>], model_df <span class="op">=</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       lb_stat  lb_pvalue
## 36  52.813322   0.015734</code></pre>
<p>From the output above we can see that the estimation of the coefficients from our model summary as well as what model Python selected automatically - <span class="math inline">\(ARIMA(1,0,0)(0,1,2)_{12}\)</span>. We also do not have statistical white noise with our residuals based on the results from the Ljung-Box test.</p>
<p>Let’s forecast both of these models using the the forecast function with the h = 12 option to forecast 12 months into the future. We also plot these two models’ forecasts against each other.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="seasonal-arima.html#cb84-1" tabindex="-1"></a>model_SARIMA_for <span class="op">=</span> model_SARIMA.forecast(df <span class="op">=</span> train_sf, h <span class="op">=</span> <span class="dv">12</span>, level <span class="op">=</span> [<span class="dv">95</span>])</span>
<span id="cb84-2"><a href="seasonal-arima.html#cb84-2" tabindex="-1"></a></span>
<span id="cb84-3"><a href="seasonal-arima.html#cb84-3" tabindex="-1"></a>model_SARIMA.plot(train_sf, model_SARIMA_for)</span></code></pre></div>
<p>Let’s take both of these models to the test dataset to see which forecasts better since both of these were rather comparable on the training dataset.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="seasonal-arima.html#cb85-1" tabindex="-1"></a>error <span class="op">=</span> np.array(test[<span class="st">&#39;Passengers&#39;</span>]) <span class="op">-</span> np.array(model_SARIMA_for[<span class="st">&#39;AutoARIMA&#39;</span>])</span>
<span id="cb85-2"><a href="seasonal-arima.html#cb85-2" tabindex="-1"></a>MAPE <span class="op">=</span> np.mean(<span class="bu">abs</span>(error)<span class="op">/</span>test[<span class="st">&#39;Passengers&#39;</span>])<span class="op">*</span><span class="dv">100</span></span>
<span id="cb85-3"><a href="seasonal-arima.html#cb85-3" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Auto. MAE =&quot;</span>, np.mean(<span class="bu">abs</span>(error)), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Auto. MAPE =&quot;</span>, MAPE)</span></code></pre></div>
<pre><code>## Auto. MAE = 4475.8896484375 
## Auto. MAPE = 6.97691719464673</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="seasonal-arima.html#cb87-1" tabindex="-1"></a>error <span class="op">=</span> np.array(test[<span class="st">&#39;Passengers&#39;</span>]) <span class="op">-</span> np.array(model_SARIMA_for[<span class="st">&#39;ARIMA&#39;</span>])</span>
<span id="cb87-2"><a href="seasonal-arima.html#cb87-2" tabindex="-1"></a>MAPE <span class="op">=</span> np.mean(<span class="bu">abs</span>(error)<span class="op">/</span>test[<span class="st">&#39;Passengers&#39;</span>])<span class="op">*</span><span class="dv">100</span></span>
<span id="cb87-3"><a href="seasonal-arima.html#cb87-3" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Hand MAE =&quot;</span>, np.mean(<span class="bu">abs</span>(error)), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Hand MAPE =&quot;</span>, MAPE)</span></code></pre></div>
<pre><code>## Hand MAE = 1249.953125 
## Hand MAPE = 1.9164337911544131</code></pre>
<p>Based on the output above it appears that the model built based on the ACF and PACF plots forecasts better than the automatically selected model. This isn’t always the case, but still a good example to show that automatic selection techniques are good starting points, but you should not be afraid to adjust them to see if you can get better models. This model was not as good as the previously built Holt-Winters exponentially smoothing model on the testing dataset, but again, this is not always the case.</p>
</div>
<div id="sas-4" class="section level3 hasAnchor" number="5.7.3">
<h3><span class="header-section-number">5.7.3</span> SAS<a href="seasonal-arima.html#sas-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In SAS we can build ARIMA models in the PROC ARIMA procedure. We can look at the IDENTIFY statement to examine the target variable. Here we are specifying the seasonal difference of the target variable using the (12) at the end of the Passengers variable in the VAR option. The MINIC option will have SAS recommend a model based on lowest BIC. The P and Q options tell SAS the bounds on the models to test with the MINIC. When running the procedure we see SAS recommend an AR term of 1 and an MA term of 12.</p>
<p>Next, we use the ESTIMATE statements to build our models. The first estimate statement is the model we are developing by hand from looking at the ACF and PACF plots. In the P option we specify the <span class="math inline">\(p=1\)</span> and <span class="math inline">\(P = 1\)</span> lags by specifying the lags as (1)(12). In the Q option we specify the <span class="math inline">\(Q = 1\)</span> by specifying the lags as (12). The AR terms are specified in multiplicative format and not additive format ((1, 12)) as that is what is fit by default in R and Python. The difference between this is discussed in the section below. After the ESTIMATE statement we put a FORECAST statement with LEAD equaling 12 to forecast the next 12 months as well as the OUT option to save these forecasts.</p>
<p>The second estimate statement is the model we are developing automatically from the MINIC. In the P option we specify the <span class="math inline">\(p=1\)</span> lag by specifying the lag as (1). In the Q option we specify the <span class="math inline">\(Q = 1\)</span> by specifying the lags as (12). After the ESTIMATE statement we put a FORECAST statement with LEAD equaling 12 to forecast the next 12 months as well as the OUT option to save these forecasts.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="seasonal-arima.html#cb89-1" tabindex="-1"></a>proc arima data <span class="ot">=</span> train;</span>
<span id="cb89-2"><a href="seasonal-arima.html#cb89-2" tabindex="-1"></a>    identify var <span class="ot">=</span> <span class="fu">Passengers</span>(<span class="dv">12</span>) nlag <span class="ot">=</span> <span class="dv">36</span> minic P <span class="ot">=</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>) Q <span class="ot">=</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>);</span>
<span id="cb89-3"><a href="seasonal-arima.html#cb89-3" tabindex="-1"></a>    estimate p <span class="ot">=</span> (<span class="dv">1</span>)(<span class="dv">12</span>) q <span class="ot">=</span> (<span class="dv">12</span>);</span>
<span id="cb89-4"><a href="seasonal-arima.html#cb89-4" tabindex="-1"></a>    forecast lead <span class="ot">=</span> <span class="dv">12</span> id <span class="ot">=</span> date interval <span class="ot">=</span> month out <span class="ot">=</span> work.SARIMA_hand_f;</span>
<span id="cb89-5"><a href="seasonal-arima.html#cb89-5" tabindex="-1"></a>    estimate p <span class="ot">=</span> <span class="dv">1</span> q <span class="ot">=</span> (<span class="dv">12</span>);</span>
<span id="cb89-6"><a href="seasonal-arima.html#cb89-6" tabindex="-1"></a>    forecast lead <span class="ot">=</span> <span class="dv">12</span> id <span class="ot">=</span> date interval <span class="ot">=</span> month out <span class="ot">=</span> work.SARIMA_auto_f;</span>
<span id="cb89-7"><a href="seasonal-arima.html#cb89-7" tabindex="-1"></a>run;</span>
<span id="cb89-8"><a href="seasonal-arima.html#cb89-8" tabindex="-1"></a>quit;</span></code></pre></div>
<div class="float">
<img src="9_f_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<div class="float">
<img src="9_g_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<div class="float">
<img src="9_h_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<div class="float">
<img src="9_i_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>From the output above we can see that the estimation of the coefficients from our model summaries. We also have statistical white noise with our residuals from both models based on the results from the Ljung-Box test plots above as well.</p>
<p>We need to isolate just the forecasted observations from the code above. For that we use the DATA STEP to just look at the predicted values from the two previous models beyond the March, 2007 training observations with the WHERE statement. Next, we use the MERGE statement in another DATA STEP to merge the original test dataset with the predicted values from the above model. Lastly, we calculate the absolute error and absolute percentage error for each observation with our last DATA STEP. To get the average of these calculations, we throw our test dataset into the PROC MEANS procedure where we specify these variables with the VAR statement.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="seasonal-arima.html#cb90-1" tabindex="-1"></a>data SARIMA_hand_f;</span>
<span id="cb90-2"><a href="seasonal-arima.html#cb90-2" tabindex="-1"></a>    set SARIMA_hand_f;</span>
<span id="cb90-3"><a href="seasonal-arima.html#cb90-3" tabindex="-1"></a>    where date <span class="sc">&gt;</span> <span class="st">&#39;1mar2007&#39;</span>d;</span>
<span id="cb90-4"><a href="seasonal-arima.html#cb90-4" tabindex="-1"></a>    Predict_SARIMA_hand <span class="ot">=</span> Forecast;</span>
<span id="cb90-5"><a href="seasonal-arima.html#cb90-5" tabindex="-1"></a>    keep Predict_SARIMA_hand;</span>
<span id="cb90-6"><a href="seasonal-arima.html#cb90-6" tabindex="-1"></a>run;</span>
<span id="cb90-7"><a href="seasonal-arima.html#cb90-7" tabindex="-1"></a></span>
<span id="cb90-8"><a href="seasonal-arima.html#cb90-8" tabindex="-1"></a>data test;</span>
<span id="cb90-9"><a href="seasonal-arima.html#cb90-9" tabindex="-1"></a>    merge test SARIMA_hand_f;</span>
<span id="cb90-10"><a href="seasonal-arima.html#cb90-10" tabindex="-1"></a>run;</span>
<span id="cb90-11"><a href="seasonal-arima.html#cb90-11" tabindex="-1"></a></span>
<span id="cb90-12"><a href="seasonal-arima.html#cb90-12" tabindex="-1"></a>data SARIMA_auto_f;</span>
<span id="cb90-13"><a href="seasonal-arima.html#cb90-13" tabindex="-1"></a>    set SARIMA_auto_f;</span>
<span id="cb90-14"><a href="seasonal-arima.html#cb90-14" tabindex="-1"></a>    where date <span class="sc">&gt;</span> <span class="st">&#39;1mar2007&#39;</span>d;</span>
<span id="cb90-15"><a href="seasonal-arima.html#cb90-15" tabindex="-1"></a>    Predict_SARIMA_auto <span class="ot">=</span> Forecast;</span>
<span id="cb90-16"><a href="seasonal-arima.html#cb90-16" tabindex="-1"></a>    keep Predict_SARIMA_auto;</span>
<span id="cb90-17"><a href="seasonal-arima.html#cb90-17" tabindex="-1"></a>run;</span>
<span id="cb90-18"><a href="seasonal-arima.html#cb90-18" tabindex="-1"></a></span>
<span id="cb90-19"><a href="seasonal-arima.html#cb90-19" tabindex="-1"></a>data test;</span>
<span id="cb90-20"><a href="seasonal-arima.html#cb90-20" tabindex="-1"></a>    merge test SARIMA_auto_f;</span>
<span id="cb90-21"><a href="seasonal-arima.html#cb90-21" tabindex="-1"></a>run;</span>
<span id="cb90-22"><a href="seasonal-arima.html#cb90-22" tabindex="-1"></a></span>
<span id="cb90-23"><a href="seasonal-arima.html#cb90-23" tabindex="-1"></a>data test;</span>
<span id="cb90-24"><a href="seasonal-arima.html#cb90-24" tabindex="-1"></a>    set test;</span>
<span id="cb90-25"><a href="seasonal-arima.html#cb90-25" tabindex="-1"></a>    AE_SARIMA_hand <span class="ot">=</span> <span class="fu">abs</span>(Passengers <span class="sc">-</span> Predict_SARIMA_hand);</span>
<span id="cb90-26"><a href="seasonal-arima.html#cb90-26" tabindex="-1"></a>    APE_SARIMA_hand <span class="ot">=</span> <span class="fu">abs</span>(Passengers <span class="sc">-</span> Predict_SARIMA_hand)<span class="sc">/</span>Passengers<span class="sc">*</span><span class="dv">100</span>;</span>
<span id="cb90-27"><a href="seasonal-arima.html#cb90-27" tabindex="-1"></a>    AE_SARIMA_auto <span class="ot">=</span> <span class="fu">abs</span>(Passengers <span class="sc">-</span> Predict_SARIMA_auto);</span>
<span id="cb90-28"><a href="seasonal-arima.html#cb90-28" tabindex="-1"></a>    APE_SARIMA_auto <span class="ot">=</span> <span class="fu">abs</span>(Passengers <span class="sc">-</span> Predict_SARIMA_auto)<span class="sc">/</span>Passengers<span class="sc">*</span><span class="dv">100</span>;</span>
<span id="cb90-29"><a href="seasonal-arima.html#cb90-29" tabindex="-1"></a>run;</span>
<span id="cb90-30"><a href="seasonal-arima.html#cb90-30" tabindex="-1"></a></span>
<span id="cb90-31"><a href="seasonal-arima.html#cb90-31" tabindex="-1"></a>proc means data <span class="ot">=</span> test;</span>
<span id="cb90-32"><a href="seasonal-arima.html#cb90-32" tabindex="-1"></a>    var AE_SARIMA_hand APE_SARIMA_hand AE_SARIMA_auto APE_SARIMA_auto;</span>
<span id="cb90-33"><a href="seasonal-arima.html#cb90-33" tabindex="-1"></a>run;</span></code></pre></div>
<div class="float">
<img src="9_j_SAS.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>Based on the output above it appears that the model built based on the ACF and PACF plots forecasts better than the automatically selected model. This isn’t always the case, but still a good example to show that automatic selection techniques are good starting points, but you should not be afraid to adjust them to see if you can get better models. This model was not as good as the previously built Holt-Winters exponentially smoothing model on the testing dataset, but again, this is not always the case.</p>
</div>
</div>
<div id="multiplicative-vs.-additive" class="section level2 hasAnchor" number="5.8">
<h2><span class="header-section-number">5.8</span> Multiplicative vs. Additive<a href="seasonal-arima.html#multiplicative-vs.-additive" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To look at the mathematical difference between multiplicative and additive models we need to first need to define the backshift operator, <span class="math inline">\(B\)</span>. The backshift operator on a variable shifts the variable back in time. For example, <span class="math inline">\(B(Y_t) = Y_{t-1}\)</span>. This can be extended to any number of lags. For example, a two lagged backshift is <span class="math inline">\(B^2(Y_t) = B(Y_{t-1}) = Y_{t-2}\)</span>.</p>
<p>For additive seasonal terms the model is structured as the following:</p>
<p><span class="math display">\[
(1 - \phi_1 B - \phi_2B^{12})Y_t = e_t
\]</span></p>
<p>This can be factored out in the following way:</p>
<p><span class="math display">\[
Y_t -\phi_1 B(Y_t) - \phi_2 B^{12}(Y_t) = e_t
\]</span></p>
<p><span class="math display">\[
Y_t - \phi_1 Y_{t-1} - \phi_2 Y_{t-12} = e_t
\]</span></p>
<p><span class="math display">\[
Y_t = \phi_1 Y_{t-1} + \phi_2 Y_{t-12} + e_t
\]</span></p>
<p>However, the multiplicative seasonal terms the model is structured differently:</p>
<p><span class="math display">\[
(1 - \phi_1B)(1 - \phi_2 B^{12})Y_t = e_t
\]</span></p>
<p>This can be factored out in the following way:</p>
<p><span class="math display">\[
(1 - \phi_1 B - \phi_2 B^{12} - \phi_1 \phi_2 B^{13})Y_t = e_t
\]</span></p>
<p><span class="math display">\[
Y_t -\phi_1 B(Y_t) - \phi_2 B^{12}(Y_t) - \phi_1 \phi_2 B^{13}(Y_t) = e_t
\]</span></p>
<p><span class="math display">\[
Y_t - \phi_1 Y_{t-1} - \phi_2 Y_{t-12} - \phi_1 \phi_2 Y_{t-13}= e_t
\]</span></p>
<p><span class="math display">\[
Y_t = \phi_1 Y_{t-1} + \phi_2 Y_{t-12} + \phi_1 \phi_2 Y_{t-13} + e_t
\]</span></p>
<p>This effect on the <span class="math inline">\(13^{th}\)</span> lag is the multiplied impact from the first and twelfth lag. In fact, we can see this effect when we plot the ACF and PACF plots. In a dataset with an additive seasonal effect we only see the spike on the lag. However, with a multiplicative seasonal effect we typically see what we call “counter spikes” on one or both sides of the seasonal spike as the plot shows below.</p>
<div class="float">
<img src="AddvsMult.png" alt="SAS output" />
<div class="figcaption">SAS output</div>
</div>
<p>This multiplicative seasonal effect is the default for R and Python, but must be specified in SAS to get.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="arima.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/sjsimmo2/TimeSeries/edit/master/04-SeasonalARIMA.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/sjsimmo2/TimeSeries/blob/master/04-SeasonalARIMA.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
